/*! Copyright (c) 2019 WhatsApp Inc. All Rights Reserved. */
webpackJsonp([131],{bbjjjbicfb:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.intColorToHex=d;var n=i("dcaifjegcg"),o=u(n),a=u(i("bhggeigghg")),s=u(i("ddcfhecgai"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return i=r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,n.prop)(),r.name=(0,n.prop)(),r.color=(0,n.prop)(),r.count=(0,n.prop)(),r.stale=(0,n.session)(!0),r.hexColor=(0,n.derived)(r._hexColor,["color"]),c(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"initialize",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.labeltemColleciton=new s.default,this.triggerLabelUpdate(),this.listenTo(this,"change:name",this.triggerLabelUpdate),this.listenTo(this,"change:color",this.triggerLabelUpdate),this.listenTo(this,"change:count",this.triggerLabelUpdate)}},{key:"_hexColor",value:function(){if(this.color)return d(this.color)}},{key:"_find",value:function(e){return Promise.resolve({id:e})}},{key:"triggerLabelUpdate",value:function(){this.name&&a.default.Label.trigger("label_updated_"+this.id)}}]),t}();function d(e){return"#"+(parseInt(e,10)>>>0).toString(16).slice(-6)}l.Collection="Label",l.Proxy="label",t.default=(0,n.defineModel)(l)},bdfbccfifg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CACHE_POLICY_TYPE=void 0;var r,n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i("cccehdaiaf"),a=(r=o)&&r.__esModule?r:{default:r};var s=t.CACHE_POLICY_TYPE={LOAD:"LOAD",IMMEDIATE:"IMMEDIATE",NONE:"NONE"},u=function(e){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._collection=e,r._id=i,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"enableCaching",value:function(){}},{key:"disableCaching",value:function(){}},{key:"collection",get:function(){return this._collection}},{key:"id",get:function(){return this._id}}]),t}();u.policy=s.NONE,t.default=u},bdhgicebce:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticipantCollection=t.MsgInfoParticipant=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i("dcaifjegcg"),o=d(n),a=d(i("dhigahgdjb")),s=d(i("ccicaaeiaa")),u=d(i("fcedgihic")),c=d(i("ccgjijjbbj")),l=d(i("jccfhaecf"));function d(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g=function(e){function t(){var e,i,r;f(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return i=r=h(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,n.prop)(),r.t=(0,n.prop)(),r.contact=(0,n.session)(),h(r,i)}return p(t,o.default),r(t,[{key:"initialize",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.addChild("contact",a.default.gadd(this.id))}}]),t}();g.Collection="MsgInfoParticipant",g.Proxy="msgInfoParticipant",g.idClass=l.default;var y=t.MsgInfoParticipant=(0,n.defineModel)(g),v=t.ParticipantCollection=function(e){function t(){return f(this,t),h(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p(t,u.default),t}();v.model=y,v.comparator=function(e,t){return(0,s.default)(e.contact,t.contact)};var b=function(e){function t(){var e,i,r;f(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return i=r=h(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,n.prop)(),r.isPTT=(0,n.prop)(),r.playedRemaining=(0,n.prop)(0),r.readRemaining=(0,n.prop)(0),r.deliveryRemaining=(0,n.prop)(0),r.played=(0,n.collection)(v),r.read=(0,n.collection)(v),r.delivery=(0,n.collection)(v),r.settled=(0,n.derived)(r._settled,["isPTT","playedRemaining","readRemaining"]),h(r,i)}return p(t,o.default),r(t,[{key:"_settled",value:function(){return this.isPTT?!this.playedRemaining:!this.readRemaining}}]),t}();b.Collection="MsgInfo",b.Proxy="msgInfo",b.idClass=c.default,t.default=(0,n.defineModel)(b)},bdiiibjcij:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),o=c(i("eadfaddcj")),a=c(i("cbcbdjdah")),s=c(i("biecbbiiee")),u=c(i("cgcgbfbffj"));function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=l(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.hasDocBefore=!0,l(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),r(t,[{key:"delete",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.stopListening(),this.reset()}},{key:"queryDocs",value:function(e,t){var i=this;if(t)return this.queryDocBefore?this.queryDocBefore:(this.queryDocBefore=s.default.queryMedia(t.id.remote,o.default.MEDIA_QUERY_LIMIT,"before",t.id,"document").then(function(e){return(!e||e.length<o.default.MEDIA_QUERY_LIMIT)&&(i.hasDocBefore=!1),i.add(e.filter(function(e){return e.isDoc}),{at:0}),{length:e.length}}).catch(n.WapDrop,n.ProtoVersionUndefined,function(){}).catch(404,function(){}).finally(function(){i.queryDocBefore=null,i.trigger("query_doc_before")}),this.trigger("query_doc_before"),this.queryDocBefore);var r=e.msgs;if(0===this.length){if(!r||0===r.length)return this.hasDocBefore=!1,new Promise(function(e){e({eof:!0})});this.add(r.filter(function(e){return e.isDoc}),{at:0})}if(e.msgs.msgLoadState.noEarlierMsgs)return this.hasDocBefore=!1,new Promise(function(e){e({eof:!0})});if(this.length<=2*o.default.MEDIA_QUERY_LIMIT){var a=0===this.length?r.head():this.head();return this.queryDocs(e,a)}return new Promise(function(e){e({eof:!1})})}}]),t}();d.model=a.default,t.default=d},beahjdfigf:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,o.default)(e.contact,t.contact)};var r,n=i("ccicaaeiaa"),o=(r=n)&&r.__esModule?r:{default:r}},bechdajic:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DAYS_OF_WEEK=["sun","mon","tue","wed","thu","fri","sat"],t.BUSINESS_HOUR_MODES={OPEN_24H:"open_24h",SPECIFIC_HOURS:"specific_hours",APPOINTMENT_ONLY:"appointment_only"}},bechejbabh:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),o=l(i("ccaaiecfib")),a=l(i("ddeghajfaj")),s=l(i("ceddibdhdb")),u=l(i("cgcgbfbffj")),c=l(i("chajfbfiga"));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=d(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.checksum=void 0,r.flushCountsTimer=new s.default(function(){r.hasPendingCounts()&&r.flushCounts()}),r.sortQuickReply=function(e,t){return e.totalCount===t.totalCount?e.id<t.id?-1:1:e.totalCount>t.totalCount?-1:1},r.onCountsFlushed=function(e){var t=e.id,i=e.count,n=r.get(t);n&&(n.count=i,n.pendingCount=0)},d(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),r(t,[{key:"delete",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),delete this.checksum}},{key:"filterShortcuts",value:function(e){return this.filter(function(t){return t.shortcut.toLowerCase().startsWith(e.toLowerCase())}).sort(this.sortQuickReply)}},{key:"sync",value:function(e){o.default.supportsFeature(o.default.F.QUICK_REPLIES_QUERY)&&(this.synced()&&this.checksum===e?this.hasPendingCounts()&&this.flushCounts():this.findQuery({}))}},{key:"periodicFlush",value:function(){o.default.supportsFeature(o.default.F.QUICK_REPLIES_QUERY)&&this.flushCountsTimer.debounceAndCap(2e3,5e3)}},{key:"updateChecksum",value:function(e){this.checksum=e}},{key:"synced",value:function(){return void 0!==this.checksum}},{key:"hasPendingCounts",value:function(){return this.some(function(e){return e.pendingCount>0})}},{key:"getAllPendingCounts",value:function(){var e={};return this.forEach(function(t){var i=t.id,r=t.pendingCount;r>0&&(e[i]=r)}),e}},{key:"flushCounts",value:function(){var e=this,t=this.getAllPendingCounts();c.default.flushQuickReplyCounts(t).then(function(i){i.checksum&&e.updateChecksum(i.checksum),i.data.filter(function(e){var i=e.id;return void 0!==t[i]}).forEach(e.onCountsFlushed)}).catch(n.WapDrop,function(){})}},{key:"_findQuery",value:function(){var e=this,t=this.getAllPendingCounts();return c.default.queryQuickReplies(t).then(function(i){return i.checksum&&e.updateChecksum(i.checksum),i.data.filter(function(e){var i=e.id;return void 0!==t[i]}).forEach(e.onCountsFlushed),i.data})}},{key:"handle",value:function(e){e.checksum&&this.updateChecksum(e.checksum);var t=[],i=[];e.quickReplies.forEach(function(e){"delete"===e.type?t.push(e):i.push(e)}),this.remove(t.map(function(e){return e.id})),this.add(i,{merge:!0})}}]),t}();f.model=a.default,t.default=new f},bfgbdiffgd:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=y(i("bejjegijhj")),n=y(i("fcdbffdgh")),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},s=i("dcaifjegcg"),u=y(s),c=i("bjcgjfiffb"),l=i("ffgeceahe"),d=y(i("eadfaddcj")),f=y(i("bfbggcdbfb")),h=y(i("egjjcjcg")),p=y(i("chajfbfiga")),g=y(i("ccaaiecfib"));function y(e){return e&&e.__esModule?e:{default:e}}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var b={imageMaxKBytes:function(e){if("number"==typeof e&&e>0)return 1024*e},maxParticipants:function(e){if("number"==typeof e&&e>0)return e-1},media:m,maxFileSize:m,groupDescLength:function(e){if("number"==typeof e&&e>0)return e},restrictGroups:O,announceGroups:O,groupsV3:O,suspiciousLinks:O,googleMapsDoNotAuth:O,googleMapsKeyless:O,finalLiveLocation:O,statusRanking:O,stickers:O,frequentlyForwardedMessages:O,frequentlyForwardedGroupSetting:O},_=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=v(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.gifSearch=(0,s.prop)(d.default.SHOW_GIF_SEARCH),r.imageMaxEdge=(0,s.prop)(d.default.IMG_MAX_EDGE),r.imageMaxKBytes=(0,s.prop)(d.default.IMG_MAX_BYTES),r.maxParticipants=(0,s.prop)(d.default.MAX_GROUP_SIZE),r.maxSubject=(0,s.prop)(d.default.MAX_SUBJECT_LENGTH),r.media=(0,s.prop)(d.default.MAX_MEDIA_UPLOAD_SIZE),r.maxFileSize=(0,s.prop)(d.default.MAX_FILE_SIZE),r.notificationQuery=(0,s.prop)(d.default.USE_NOTIFICATION_QUERY),r.groupDescLength=(0,s.prop)(d.default.GROUP_DESCRIPTION_LENGTH),r.restrictGroups=(0,s.prop)(d.default.GROUPS_V3_RESTRICT_GROUPS),r.announceGroups=(0,s.prop)(d.default.GROUPS_V3_ANNOUNCE_GROUPS),r.groupsV3=(0,s.prop)(d.default.GROUPS_V3),r.fwdUiStartTs=(0,s.prop)(d.default.FWD_UI_START_TS),r.googleMapsDoNotAuth=(0,s.prop)(d.default.GOOGLE_MAPS_DO_NOT_AUTH),r.googleMapsKeyless=(0,s.prop)(d.default.GOOGLE_MAPS_KEYLESS),r.suspiciousLinks=(0,s.prop)(d.default.SUSPICIOUS_LINKS),r.finalLiveLocation=(0,s.prop)(d.default.FINAL_LIVE_LOCATION),r.statusRanking=(0,s.prop)(d.default.STATUS_RANKING),r.stickers=(0,s.prop)(d.default.STICKERS),r.multicastLimitGlobal=(0,s.prop)(d.default.MAX_FORWARD_COUNT_GLOBAL),r.frequentlyForwardedMessages=(0,s.prop)(d.default.FREQUENTLY_FORWARDED_MESSAGES),r.frequentlyForwardedThreshold=(0,s.prop)(d.default.FREQUENTLY_FORWARDED_THRESHOLD),r.frequentlyForwardedMax=(0,s.prop)(d.default.FREQUENTLY_FORWARDED_MAX),r.frequentlyForwardedGroupSetting=(0,s.prop)(d.default.FREQUENTLY_FORWARDED_GROUP_SETTING),r.wsOverride=(0,s.prop)(void 0),r.wsOverrideAttempts=(0,s.prop)(0),r.wsOverrideTimeout=(0,s.prop)(void 0),r.webRestoreFromCache=(0,s.prop)(d.default.WEB_RESTORE_FROM_CACHE),r.templateDocMimeTypes=(0,s.prop)(d.default.TEMPLATE_DOC_MIME_TYPES),v(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),o(t,[{key:"delete",value:function(){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.updateProps({})}},{key:"set",value:function(e,i,o){var s=this;if("string"==typeof e)"webRestoreFromCache"===e&&this.saveResumeProp(i),(0,l.setServerPropInElectron)(e,i);else{var u=e,c=i&&i.merge?(0,n.default)(u,r.default):u;Object.keys(c).forEach(function(e){var t=c[e];return"webRestoreFromCache"===e&&s.saveResumeProp(t),(0,l.setServerPropInElectron)(e,t)})}return a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e,i,o)}},{key:"updateProps",value:function(e){var t=this;for(var i in f.default.Global.webcBucket=e.bucket||null,this.__props.forEach(function(i){var r=e[i];void 0===r?r=t.getDefault(i):b[i]&&void 0===(r=b[i](r))&&(r=t.getDefault(i)),t.set(i,r)}),g.default.F)void 0!==e[i]&&g.default.setFeature(i,e[i])}},{key:"handlePayload",value:function(e){"number"==typeof e.status&&e.status>=400||this.updateProps(e)}},{key:"handle",value:function(e){var t=e.shift();this.handlePayload(t)}},{key:"fetch",value:function(){return p.default.queryServerProps().then(this.handlePayload.bind(this))}},{key:"getWebRestoreFromCache",value:function(){return this.webRestoreFromCache}},{key:"saveResumeProp",value:function(e){e!==c.INIT&&h.default.setWebRestoreFromCache(e)}},{key:"loadResumeProp",value:function(){var e=h.default.getWebRestoreFromCache();"boolean"==typeof e&&(this.webRestoreFromCache=e)}}]),t}();function m(e){if("number"==typeof e&&e>0)return 1024*e*1024}function O(e){if("number"==typeof e)return!!e}_.Proxy="serverProps";var P=(0,s.defineModel)(_);t.default=new P({id:"1"})},bgcdajbhif:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=T(i("bebajedcaf")),n=T(i("iidhbgeed")),o=T(i("chihjdheic")),a=T(i("dbafiicfja")),s=T(i("dgabgdahbi")),u=T(i("cbeddgjfaj")),c=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),l=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},d=T(i("cgcgbfbffj")),f=T(i("bjigbaghc")),h=T(i("eadfaddcj")),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),g=T(i("bdiiahhjbe")),y=T(i("biecbbiiee")),v=T(i("jcfjeeiii")),b=T(i("chajfbfiga")),_=T(i("bjebjijbfc")),m=T(i("beeieigghj")),O=i("dcbdjheea"),P=T(i("bfgbdiffgd")),E=T(i("ccaaiecfib")),j=T(i("bfbggcdbfb"));function T(e){return e&&e.__esModule?e:{default:e}}var M=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d.default),c(t,[{key:"delete",value:function(){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),delete this.checksum}},{key:"_find",value:function(e){return Promise.resolve({id:e})}},{key:"findQuery",value:function(e,i){var r=this;return l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"findQuery",this).call(this,e,i).then(function(e){return Promise.all(e.map(function(e){if(e){var t=0;return e.msgs.forEach(function(i){t<e._msgs.length&&e._msgs[t].id.toString()===i.id.toString()?++t:i.delete()}),e._msgs.length>0?r.addStatusMessages(e.id,e._msgs):Promise.resolve()}})).then(function(){return e})})}},{key:"_findQuery",value:function(e){var t=this;return b.default.statusQuery().then(function(e){return t.checksum=e.checksum,Promise.map(e.statuses,function(e){e.totalCount!==e._msgs.length&&e.totalCount<=20&&g.default.warn("Received "+e._msgs.length+" status V3 messages when total count is "+e.totalCount+" for "+e.id)();var t=e.pic;return t?m.default.createFromData(t,"image/jpeg").then(function(t){return e.pic=t,e}):e})})}},{key:"loadMore",value:function(e,t,i){return b.default.statusQuery(e,t,i&&i.id,"after").then(function(e){return e.status>=400?(g.default.error("model:statusv3:findQuery error "+e.status)(),Promise.reject(e.status)):(e.forEach(function(e){e.invis=!0}),g.default.log("model:statusv3:loadMore:"+e.length)(),y.default.processMultipleMessages((0,O.createWid)(h.default.STATUS_WID),e,{add:"after",isHistory:!0}))})}},{key:"sync",value:function(e){var t=this,i=window.performance.now();return!e||this.checksum&&this.checksum!==e?this.findQuery({},{set:this.hasSynced()}).catch(p.WapDrop,function(){}).finally(function(){t.trigger("sync")}).tap(function(e){var r=window.performance.now(),n=Math.round(r-i);t.logMetrics({type:"sync",syncTime:n}),t.forEach(function(e){e.msgs.length>e.totalCount&&g.default.log("Total count: "+e.totalCount+", msgs length: "+e.msgs.length)()})}):Promise.resolve(void 0)}},{key:"logMetrics",value:function(e){var t=void 0;t="sync"===e.type?new j.default.WebcStatusSync({webcStatusSyncT:e.syncTime}):new j.default.WebcStatusSession({webcStatusSessionId:e.sessionId});var i=this.filter(function(e){return!e.contact.isMe}),r=i.filter(function(e){return!e.contact.statusMute}),n=r.filter(function(e){return e.hasUnread}),o=r.filter(function(e){return!e.hasUnread}),a=i.filter(function(e){return e.contact.statusMute}),s=(0,u.default)(r.map(function(e){return e.unreadCount})),c=(0,u.default)(r.map(function(e){return e.readCount})),l=(0,u.default)(a.map(function(e){return e.totalCount}));t.webcStatusRecentItemCount=s,t.webcStatusRecentRowCount=n.length,t.webcStatusViewedItemCount=c,t.webcStatusViewedRowCount=o.length,t.webcStatusMutedItemCount=l,t.webcStatusMutedRowCount=a.length,t.commit()}},{key:"hasSynced",value:function(){return!!this.checksum}},{key:"handleUpdate",value:function(e,t,i){var r=e.id.fromMe?f.default.me:e.author;if(this.updateChecksum(t),this.hasSynced()){if(i)return!0;var n=this.get(r);if(n){var u=n.totalCount===n.msgs.length;if("revoke"===e.subtype){var c=(0,s.default)(n.msgs.toArray(),n.totalCount-n.unreadCount),l=(0,a.default)(c,function(e){return e.id.toString()}),d={totalCount:n.totalCount-1};(0,o.default)(l,function(t){return t===e.protocolMessageKey.toString()})||n.readKeys[e.protocolMessageKey.toString()]||(d.unreadCount=n.unreadCount-1),n.set(d)}else{var h={totalCount:n.totalCount+1};e.invis||(h.unreadCount=n.unreadCount+1),h.t=e.t,n.set(h)}return!u&&e.body&&m.default.createFromBase64Jpeg(e.body).then(function(e){n.pic=e}),u}return this.add({id:r,t:e.t,unreadCount:e.invis?0:1,totalCount:1}),!0}return!1}},{key:"handleScore",value:function(e,t){var i=this.get(e);i?i.score=t:g.default.log("models:statusV3:score:no_status:"+[e,t].join())()}},{key:"updateChecksum",value:function(e){e?this.hasSynced()&&(this.checksum=e):g.default.info("models:statusV3:no_checksum")()}},{key:"handle",value:function(e){var t=e.shift();if(Array.isArray(t))g.default.warn("models:statusV3:unexpected update")(t);else switch(t.type){case"read":this.updateChecksum(t.checksum);var i=this.get(t.chat);i?i.handleReadStatus(t.key):g.default.log("models:statusV3:read:no_status:"+[t.chat,t.key].join())(t);break;case"privacy":break;case"score":for(var r=0;r<t.scores.length;r++){var n=t.scores[r],o=n.jid,a=n.score;this.handleScore(o,a)}this.sort();break;default:g.default.warn("models:statusV3:unknown:"+t.type,t)()}}},{key:"addStatusMessages",value:function(e,t){return y.default.processMultipleMessages((0,O.createWid)(h.default.STATUS_WID),t,{add:"after",isHistory:!0})}},{key:"getUnexpired",value:function(e){var t=this.filter(function(e){return e.totalCount>0&&_.default.globalUnixTime()-e.t<=86400&&e.contact.isMyContact&&!e.contact.isMe});return e?(0,n.default)(t,function(e){return e.unreadCount>0}):(0,n.default)(t,function(e){return 0===e.unreadCount})}},{key:"getMyStatus",value:function(){var e=this.filter(function(e){return e.contact.isMe});return(0,r.default)(e)?void 0:_.default.globalUnixTime()-e[0].t>86400?void 0:e[0]}}]),t}();M.model=v.default,M.comparator=function(e,t){return P.default.statusRanking&&E.default.supportsFeature(E.default.F.STATUS_RANKING)&&e.score!==t.score?t.score-e.score:t.t-e.t},t.default=new M},bgdcgdigif:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CALL_TYPES=void 0;var r,n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i("dcaifjegcg"),a=(r=o)&&r.__esModule?r:{default:r},s=i("cgejjichfa");function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}t.CALL_TYPES={VOICE:"VOICE",VIDEO:"VIDEO"};var c=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,a=Array(n),c=0;c<n;c++)a[c]=arguments[c];return i=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.callId=(0,o.session)(),r.state=(0,o.session)(s.CALL_UI_STATES.NONE),r.from=(0,o.session)(),r.to=(0,o.session)(),r.type=(0,o.session)(),r.muted=(0,o.session)(),r.peerMuted=(0,o.session)(),r.speaker=(0,o.session)(),r.outgoing=(0,o.session)(),r.startTime=(0,o.session)(),r.showFullscreenCallView=(0,o.session)(!1),r.showCallStatusBar=(0,o.session)(!1),r.externalInputAvailable=(0,o.session)(),r.interrupted=(0,o.session)(),r.peerBusy=(0,o.session)(),r.peerVideoState=(0,o.session)(),r.voipWindowId=(0,o.session)(),u(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"onStateChange",value:function(){}},{key:"onAudioOutputChange",value:function(){}},{key:"overrideOutputRoute",value:function(e){return Promise.resolve()}}]),t}();c.Proxy="callUi",t.default=c},bgfcjjddjf:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=a(i("chghgadcbg")),o=a(i("cgcgbfbffj"));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.listenTo(e,"add",e.blockContact),e.listenTo(e,"remove",e.unblockContact),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"blockContact",value:function(e){e.contact().isContactBlocked=!0}},{key:"unblockContact",value:function(e){e.contact().isContactBlocked=!1}}]),t}();s.model=n.default,t.default=new s},bhggeigghg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={}},biaifggagf:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=b(i("gcfidijgh")),n=b(i("fcdbffdgh")),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),s=i("cgejjichfa"),u=i("dbdaeccafe"),c=b(i("daejhdfjb")),l=b(i("hgeacfdgi")),d=b(i("bdiiahhjbe")),f=b(i("cgcgbfbffj")),h=i("bhgjacgcdd"),p=b(h),g=i("ddcbacabaj"),y=b(g),v=b(i("ccaaiecfib"));function b(e){return e&&e.__esModule?e:{default:e}}function _(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var m=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=_(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.pendingOffers={},r.pendingVoipCapChecks={},_(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f.default),a(t,[{key:"handleQuery",value:function(e){return Promise.resolve()}},{key:"handle",value:function(e){var t=this,i=e.shift();if(i.data&&i.data[0]){var r=y.default.parseCallSignalingMsg(i);if(!r)return;var n={};v.default.supportsFeature(v.default.F.DESKTOP_VOIP_VOICE_CALL)&&(Array.isArray(i.data[0])&&(i.data=i.data[0]),(0,g.base64DecodeRecursively)(i.data),n={peer_jid:r.peer_jid,payload:i.data,peer_platform:r.peer_platform,peer_app_version:r.peer_version,epoch_msec:r.t?String(1e3*r.t):void 0,elapsed_msec:r.e?String(1e3*r.e):void 0,is_offline:i.data[1].offline});var a=r.call_id,c=void 0,f=null,b=null,_=null;switch(r.type){case u.TYPE.OFFER:if(c=s.CALL_STATES.INCOMING_RING,f=r.isVideoCall,b=r.isGroupCall,_=r.t,p.default.isInitialized()){this.pendingVoipCapChecks[a]=(0,h.checkVoipCapability)(o({},r));var m=i.data[2].find(function(e){return"enc"===e[0]});this.pendingOffers[a]=Promise.sit("receivedKey",function(e){return y.default.receiveCallOfferKey(e,m),i}).endWithControls("receivedKey")}break;case u.TYPE.OFFER_RECEIPT:c=s.CALL_STATES.CONNECTING;break;case u.TYPE.PREACCEPT:c=s.CALL_STATES.OUTGOING_RING;break;case u.TYPE.ACCEPT_RECEIPT:case u.TYPE.ACCEPT:c=s.CALL_STATES.ACTIVE;break;case u.TYPE.REJECT:c=s.CALL_STATES.REJECTED,l.default.callId===a&&p.default.endCall(),this.cleanupPendingOffer(a);break;case u.TYPE.TERMINATE:c=s.CALL_STATES.ENDED,l.default.callId===a&&p.default.endCall(),this.cleanupPendingOffer(a)}this.pendingVoipCapChecks[a]?this.pendingVoipCapChecks[a].then(function(e){var o=void 0;o=!b&&(f?e&&v.default.supportsFeature(v.default.F.DESKTOP_VOIP_VIDEO_CALL):e),t.processIncomingCall(a,i.from,c,{isVideo:f,isGroupCall:b,canHandleLocally:o,offerTime:_}),o&&t.pendingOffers[a]&&v.default.supportsFeature(v.default.F.DESKTOP_VOIP_VOICE_CALL)?t.pendingOffers[a].then(function(){p.default.handleIncomingSignalingMessage(r,n)}):t.cleanupPendingOffer(a)}).finally(function(){delete t.pendingVoipCapChecks[a]}):this.pendingOffers[a]?(this.processIncomingCall(a,i.from,c),v.default.supportsFeature(v.default.F.DESKTOP_VOIP_VOICE_CALL)&&this.pendingOffers[a].then(function(){p.default.handleIncomingSignalingMessage(r,n)})):(this.processIncomingCall(a,i.from,c,{isVideo:f,isGroupCall:b,canHandleLocally:!1,offerTime:_}),p.default.isInitialized()&&v.default.supportsFeature(v.default.F.DESKTOP_VOIP_VOICE_CALL)&&p.default.handleIncomingSignalingMessage(r,n))}else{var O=void 0;switch(i.type){case"offer_key":var P=this.pendingOffers[i.id];P?P.control.receivedKey(i.key):d.default.warn("received offer_key: no pending offer")();break;case"accept":O=s.CALL_STATES.ACTIVE,this.cleanupPendingOffer(i.id);break;case"reject":O=s.CALL_STATES.REJECTED,this.cleanupPendingOffer(i.id);break;case"terminate":O=s.CALL_STATES.ENDED,this.cleanupPendingOffer(i.id)}this.processIncomingCall(i.id,void 0,O)}}},{key:"processIncomingCall",value:function(e,t,i,o){var a=o;if(i){var s={id:e};null!=t&&(s.peerJid=t),a&&(a=(0,n.default)(a,function(e){return null==e}),(0,r.default)(s,a)),this.add(s,{merge:!0}),this.assertGet(e).setState(i)}}},{key:"cleanupPendingOffer",value:function(e){delete this.pendingOffers[e]}}]),t}();m.model=c.default,t.default=new m},biecbbiiee:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MsgCollection=void 0;var r=j(i("diibgbjaeh")),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=E(i("cajijabhgb")),s=E(i("ebggjhghhi")),u=j(i("cgcgbfbffj")),c=j(i("eadfaddcj")),l=j(i("bdiiahhjbe")),d=j(i("cbcbdjdah")),f=j(i("ccgjijjbbj")),h=j(i("cahfddcdga")),p=i("eacidghfgh"),g=j(p),y=j(i("bhggeigghg")),v=j(i("chajfbfiga")),b=j(i("jccfhaecf")),_=i("hjbbdjjdf"),m=i("dcbdjheea"),O=i("dfjijdgbhd"),P=i("bfababcidc");function E(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function j(e){return e&&e.__esModule?e:{default:e}}var T=t.MsgCollection=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.lastReceivedReceipt={},e.lastReceivedPaymentTransaction={},e.preAck={},e.pendingAdd={},e.ftsCache={},e.keysForResyncReceipts=void 0,e.listenTo(g.default,"change:stream",function(){g.default.stream===p.STREAM.DISCONNECTED&&(this.preAck={})}),e.listenTo(e,"remove",e.removeFromCollection),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),o(t,[{key:"removeFromCollection",value:function(e){e.chat&&e.chat.removeFromCollection(e)}},{key:"_findQuery",value:function(e,t){var i=this,r=void 0;switch(e.direction){case"before":case"after":r=e.direction;break;default:r="before"}var n={add:r,isHistory:!0};return(0,P.msgFindQuery)(r,e,n,t,this.get(e)).then(function(t){if(t.status>=400)return l.default.error("model:Msg:findQuery error "+t.status)(),Promise.reject(t.status);return t.forEach(function(e){e.invis=!0}),l.default.log("model:Msg:findQuery:got:"+t.length+":"+e.direction)(),i.processMultipleMessages(e.remote,t,n,function(){var t=i.get(e),r=y.default.Chat.get(e.remote);return t?t.msgChunk:r?r.msgs:void 0})})}},{key:"getStarred",value:function(e,t,i,r){var n=this,o={count:"number"!=typeof t||isNaN(t)?c.default.PAGE_SIZE:t,chat:e||void 0,remote:i&&i.remote,id:i&&i.id,fromMe:i&&i.fromMe,participant:i&&i.participant,media:r?"gif":void 0},a={add:"search"};return(0,P.msgFindQuery)("star",o,a).then(function(e){var t=e.status;return e.status>=400?(499===t?l.default.log("model:Msg:getStarred error 499 (unimplemented)")():l.default.error("model:Msg:getStarred error "+t)(),Promise.reject(t)):n.processMultipleMessages(void 0,e,a)})}},{key:"queryVCard",value:function(e){var t=this;return(0,P.queryVCard)(e).then(function(e){return 499===e.status?(l.default.log("model:Msg:queryVCard error 499 (unimplemented)")(),Promise.reject(new a.E499)):t.processMultipleMessages(void 0,e,{add:"search"})})}},{key:"incrementalStarredUpdate",value:function(e){return this.processMultipleMessages(void 0,e,{add:"search"})}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments[2],n=this,o=arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=e+"__"+(a.label||a.kind||"");if(1!==t||o)return this._search(e,t,i,o,a.label,a.kind);var u=this.ftsCache[s];if(u)return u;var l=this._search(e,t,i,o,a.label,a.kind);this.ftsCache[s]=l;var d=function(){n.ftsCache[s]=null};return(0,r.default)(d,c.default.FTS_TTL),l.catch(d),l}},{key:"_search",value:function(e,t,i,r,n,o){var s=this,u={searchTerm:e,page:t&&(0,_.isNumber)(t)?t:1,count:i&&(0,_.isNumber)(i)?i:c.default.PAGE_SIZE,remote:r,label:n,kind:o},d={add:"search"};return(0,P.msgFindQuery)("search",u,d).then(function(e){if(404===e.status)return Promise.reject(new a.E404);if(e.status>=400)return l.default.error("model:Msg:search error "+e.status)(),Promise.reject(e.status);var t=Array.isArray(e)?e:e.messages,i=!!Array.isArray(e)||e.eof;return Promise.props({messages:s.processMultipleMessages(void 0,t,d),eof:i})})}},{key:"queryMedia",value:function(e,t,i,r,n){var o=this,a={remote:e,count:t&&(0,_.isNumber)(t)?t:c.default.PAGE_SIZE,id:r&&r.id,fromMe:r&&r.fromMe,participant:r&&r.participant,direction:i||"before",media:n},s={add:"search"};return(0,P.msgFindQuery)("media",a,s).then(function(e){return e.status>=400?(l.default.error("model:Msg:media error "+e.status)(),Promise.reject(e.status)):n?o.processMultipleMessages(void 0,e,{add:"search"}):Promise.props({docCount:e.docCount,linkCount:e.linkCount,mediaCount:e.mediaCount,messages:o.processMultipleMessages(void 0,e.messages,s)})})}},{key:"getContext",value:function(e,t,i){var r=this,n=this.get(e);if(n)return Promise.all([(0,P.msgFindQuery)("before",e,{add:"before",isHistory:!0},i),(0,P.msgFindQuery)("after",e,{add:"after",isHistory:!0},i)]).spread(function(i,o){return Array.isArray(i)&&Array.isArray(o)?(n.search=!1,Promise.all([r.processMultipleMessages(e.remote,i,{add:"before",isHistory:!0},t),r.processMultipleMessages(e.remote,o,{add:"after",isHistory:!0},t)])):(l.default.error("model:msg:getContext fetch error",i,o)(),Promise.reject(i.status||o.status))});var o={add:"after",isHistory:!0};return(0,P.msgFindQuery)("after",e,o,i).then(function(i){return Array.isArray(i)?b.default.isStatusV3(i[0].id.remote)?Promise.reject("statusV3, stop querying before the msg"):r.processMultipleMessages(e.remote,i,o,t):(l.default.error("model:msg:getContext:after fetch error",i)(),Promise.reject(i.status))}).then(function(t){var n=(0,h.default)(t[0]),o=n.id.clone();o.count=e.count+1;var a={add:"before",isHistory:!0};return Promise.all([(0,P.msgFindQuery)("before",o,a,i).then(function(t){if(!Array.isArray(t))return l.default.error("model:msg:getContext:before fetch error",t)(),Promise.reject(t.status);if(!t[t.length-1].id.equals(e))return l.default.error("model:msg:getContext:before ctx message mismatch",t)(),Promise.reject(405);return r.processMultipleMessages(e.remote,t,a,function(){return n.msgChunk})}),Promise.resolve(t)])})}},{key:"_hasSynced",value:function(){return s.waitForBBEvent(this,c.default.COLLECTION_HAS_SYNCED)}},{key:"delete",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.lastReceivedReceipt={},this.lastReceivedPaymentTransaction={},this.preAck={}}},{key:"getKeysForResyncReceipts",value:function(){var e=[],t=n({},this.lastReceivedReceipt,this.lastReceivedPaymentTransaction);for(var i in t){var r=(0,m.createWid)(i),o=y.default.Chat.get(r),a=void 0;if(o&&(a=o.getFirstMsgWithStatus()),a){var s=a.id;s.t=this.lastReceivedReceipt[r]||a.t||0,s.payT=this.lastReceivedPaymentTransaction[r],e.push(s)}else l.default.error("Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: "+r.toString())()}return e}},{key:"setKeysForResyncReceipts",value:function(e){this.keysForResyncReceipts=e}},{key:"resetKeysForResyncReceipts",value:function(){this.keysForResyncReceipts=void 0}},{key:"resyncReceipts",value:function(){var e=this;l.default.log("Msg:resyncReceipts")();var t=this.keysForResyncReceipts||this.getKeysForResyncReceipts();return 0===t.length?Promise.resolve():v.default.resyncReceipts(t).then(function(t){Array.isArray(t)?(l.default.log("Msg:resyncReceipts success")(),(y.default.Chat.promises.initializeRestFromTabletCache?y.default.Chat.promises.initializeRestFromTabletCache:Promise.resolve()).then(function(){t.forEach(function(t){e.updateLastReceipt(t.id,t.t),e.updateLastTransactionTime(t.id,t.payT),t.acks.forEach(function(i){if(4===i.length){var r=new f.default({fromMe:i[1],remote:t.id,id:i[0],participant:i[2]}),n=e.get(r);n&&n.updateAck(i[3])}else l.default.error("Msg:resyncReceipts invalid response: "+JSON.stringify(i))()}),t.msgs.length>0&&e.processMultipleMessages(t.id,t.msgs,{update:!0,isHistory:!1}).catch(a.LogoutDrop,function(){})})})):l.default.error("Msg:resyncReceipts error",t)()}).catch(a.LogoutDrop,a.EphemeralDrop,a.BrowserReplacedDrop,function(){}).catch(function(e){throw l.default.error("Msg:resyncReceipts dropped "+String(e)+" "+(e?e.stack:"no stack"))(),new Error("Msg:resyncReceipts dropped")}).finally(function(){e.resetKeysForResyncReceipts()})}},{key:"updateLastReceipt",value:function(e,t){var i=this.lastReceivedReceipt[e];t&&(!i||t>i)&&(this.lastReceivedReceipt[e]=t)}},{key:"updateLastTransactionTime",value:function(e,t){var i=this.lastReceivedPaymentTransaction[e];t&&(!i||t>i)&&(this.lastReceivedPaymentTransaction[e]=t)}},{key:"processMultipleMessages",value:function(e,t,i,r){var n=this,o=function(){return(0,O._processMultipleMessages)(e,t,i,r)};if(e){var a=void 0,s=this.pendingAdd[e];return(a=s?s.then(o):o()).finally(function(){e&&n.pendingAdd[e]===a&&(n.pendingAdd[e]=null)}).catch(function(){}),this.pendingAdd[e]=a}return o()}},{key:"markAllAsStale",value:function(){this.forEach(function(e){return e.unset("recvFresh")})}}]),t}();T.model=d.default,t.default=new T},biedfadfag:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=a(i("diafggiefe")),o=a(i("cgcgbfbffj"));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"toArray",value:function(){var e=this;return function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"filter",this).call(this,function(t){return t.old&&e.remove(t),t})}}]),t}();s.model=n.default,t.default=s},bieicghjif:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=v(i("ddhijeejag")),a=i("dcaifjegcg"),s=v(a),u=v(i("dbdfbgehgj")),c=v(i("gbfffciea")),l=v(i("bjigbaghc")),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),f=v(i("gabccaieg")),h=v(i("bdiiahhjbe")),p=v(i("chajfbfiga")),g=v(i("jccfhaecf")),y=i("ccihhdchab");function v(e){return e&&e.__esModule?e:{default:e}}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var _=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),s=0;s<n;s++)o[s]=arguments[s];return i=r=b(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,a.prop)(),r.duration=(0,a.prop)(),r.participants=(0,a.collection)(f.default),r.active=(0,a.session)(!1),r.keepAliveTimer=(0,a.session)(),r.stopPromise=(0,a.session)(),b(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),r(t,[{key:"initialize",value:function(){var e=this;n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.listenTo(this.participants,"remove reset",function(){e.hasParticipants()||e.delete()});var i=u.default.get(this.id);i&&!i.liveLocation&&(i.liveLocation=this)}},{key:"delete",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.stopViewingMap(),this.participants.delete(),this.getCollection().remove(this.id);var e=u.default.get(this.id);e&&(e.liveLocation=void 0)}},{key:"hasParticipants",value:function(){return this.participants.length>0}},{key:"startViewingMap",value:function(){this.active||(this.active=!0,this._updateLiveLocations(),this._startKeepAlive())}},{key:"stopViewingMap",value:function(){this.active&&(this.active=!1,this._pauseLiveLocations(),this._stopKeepAlive())}},{key:"userHasLiveLocation",value:function(e){return!!this.participants.get(e)}},{key:"iHaveLiveLocation",value:function(){return this.userHasLiveLocation(l.default.me)}},{key:"stopMyLiveLocation",value:function(e){var t=this;if(!this.iHaveLiveLocation())return Promise.reject(new d.ActionError);if(this.stopPromise)return this.stopPromise;var i=this.stopPromise=p.default.disableLiveLocation(this.id),r=new y.ActionType(l10n.t("action_live_location_stopping")),n=e||(0,y.genId)(),a=i.then(function(e){return 200===e.status?new y.ActionType(l10n.t("action_live_location_stopped")):e.status>=400?new y.ActionType(l10n.t("action_live_location_stop_failed")):void 0}).catch(function(e){return h.default.error("models:liveLocation:disableLiveLocation dropped")(e),new y.ActionType(l10n.t("action_live_location_stop_failed"),l10n.t("action_try_again"),t.stopMyLiveLocation.bind(t,n))});return c.default.openToast(o.default.createElement(y.ActionToast,{id:n,initialAction:r,pendingAction:a})),i.then(function(e){if(200===e.status&&!e._duplicate){var i=t.participants.get(l.default.me);i&&i.disable()}}).finally(function(){t.stopPromise=null})}},{key:"_updateLiveLocations",value:function(){this.update().catch(function(){})}},{key:"_pauseLiveLocations",value:function(){p.default.unsubscribeLiveLocation(this.id).catch(d.WapDrop,function(){})}},{key:"_sendKeepAlive",value:function(){p.default.subscribeLiveLocation(this.id,!1).catch(d.WapDrop,function(){})}},{key:"_startKeepAlive",value:function(){if(!this.keepAliveTimer){var e=this.duration;e&&(this.keepAliveTimer=window.setInterval(this._sendKeepAlive.bind(this),1e3*e))}}},{key:"_stopKeepAlive",value:function(){this.keepAliveTimer&&(window.clearInterval(this.keepAliveTimer),this.keepAliveTimer=null)}}]),t}();_.Collection="LiveLocation",_.Proxy="liveLocation",_.idClass=g.default,t.default=(0,a.defineModel)(_)},biheibdage:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ATTACH_MEDIA_STATE=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=i("dcaifjegcg"),a=p(o),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),u=p(i("cieaaiahhf")),c=i("cgffhfegce"),l=p(i("bdiiahhjbe")),d=p(i("beeieigghj")),f=i("ddgbhifaji"),h=i("cbcbdjdah");function p(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var y={READY:"ready",PROCESSING:"processing",ERROR:"error"};t.ATTACH_MEDIA_STATE=y;var v=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,a=Array(n),s=0;s<n;s++)a[s]=arguments[s];return i=r=g(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,o.prop)(),r.file=(0,o.prop)(),r.uiProcessed=(0,o.prop)(),r.fileOrigin=(0,o.prop)(),r.state=(0,o.session)(),r.mediaPrep=(0,o.session)(),r.mimetype=(0,o.session)(),r.processPromise=(0,o.session)(),r.exception=(0,o.session)(),r.chat=(0,o.session)(),r.caption=(0,o.session)(),r.type=(0,o.session)(h.TYPE.UNKNOWN),r.preview=(0,o.session)(),r.fullPreview=(0,o.session)(),r.fullPreviewSize=(0,o.session)(),r.filename=(0,o.session)(),r.pdfPages=(0,o.session)(),r.isGif=(0,o.session)(),r.gifAttribution=(0,o.session)(),r.previewable=(0,o.derived)(r._previewable,["preview","fullPreview","type","filename","fullPreviewSize","mimetype"]),g(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),r(t,[{key:"_previewable",value:function(){if(!this.type||!this.mimetype||!this.fullPreview)return!1;switch(this.type){case h.TYPE.DOCUMENT:return!!this.filename;case h.TYPE.IMAGE:case h.TYPE.VIDEO:return!(!this.fullPreviewSize||!this.preview);case h.TYPE.AUDIO:case h.TYPE.PTT:case h.TYPE.UNKNOWN:return!0;default:throw new Error("Unsupported attach media type "+this.type)}}},{key:"initialize",value:function(){if(n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),!(this.file instanceof Promise))throw new Error("cannot process non-promise file");this.processFile(this.file)}},{key:"processFile",value:function(e){this.state=y.PROCESSING,this.processPromise=this._processFilePromiseHelper(e)}},{key:"_processFilePromiseHelper",value:function(e){var t=this;return e.then(function(e){t.set(e);var i={},r=e.file,n=e.isGif,o=e.gifAttribution;n?(i.asGif=n,i.gifAttribution=o):e.type===c.FILETYPE.DOCUMENT&&(i.asDocument=!0);var a=d.default.createFromData(r,r.type),s=(0,f.prepRawMedia)(a,i);return t.set({mediaPrep:s}),s.waitForPrep().then(function(e){var i=e.documentPreview,r=window.URL.createObjectURL(e.mediaBlob),n={file:e.mediaBlob,fullPreview:r,type:e.type,filename:e.filename,mimetype:e.mimetype,preview:e.preview,state:y.READY,isGif:e.isGif,fullPreviewSize:void 0,pdfPages:void 0};e.fullWidth&&e.fullHeight&&(n.fullPreviewSize={height:e.fullHeight,width:e.fullWidth}),e.type===h.TYPE.IMAGE&&(n.preview=r),e.type===h.TYPE.DOCUMENT&&i&&(n.fullPreview=i.url,n.preview=i.thumbUrl,n.fullPreviewSize={height:i.height,width:i.width},n.pdfPages=i.pdfPages),t.set(n),l.default.assert(t.previewable,"AttachMedia processFile","Invariant violated, processed file is not previewable")()})}).catch(s.InvalidMediaFileType,s.InvalidImageFileType,function(i){return t._processFilePromiseHelper(e.then(function(e){return e.type=c.FILETYPE.DOCUMENT,e}))}).catch(u.default,s.MediaFileFailedLoad,s.MediaFileEmpty,function(e){return t.set({exception:e,state:y.ERROR}),t}).catch(function(e){return t.set({exception:new s.InvalidMediaFileType,state:y.ERROR}),t})}},{key:"sendToChat",value:function(e,t){if(!this.mediaPrep)throw new Error("MediaPrep not available");if(this.state===y.ERROR)throw new Error(this.exception);if(!(this.state!==y.PROCESSING||this.previewable&&t.addEvenWhilePreparing))throw new Error("Media still processing");if(this.state!==y.READY){var i={mimetype:this.mimetype};switch(this.type){case h.TYPE.VIDEO:i.isGif=this.isGif,i.gifAttribution=this.gifAttribution;case h.TYPE.IMAGE:i.width=this.fullPreviewSize.width,i.height=this.fullPreviewSize.height,i.body=this.preview,t.placeholderProps=i;break;case h.TYPE.DOCUMENT:i.pageCount=this.pdfPages,i.filename=this.filename,i.body=this.preview,t.placeholderProps=i;break;case h.TYPE.AUDIO:case h.TYPE.PTT:}this.mediaPrep.sendToChat(e,t)}else this.mediaPrep.sendToChat(e,t)}},{key:"getFileType",value:function(){if(!(this.file instanceof Blob||this.file instanceof File))throw new Error("expected file to be a Blob or File");return(0,c.typeFromMimetype)(this.file.type)}},{key:"delete",value:function(){this.fullPreview&&window.URL.revokeObjectURL(this.fullPreview),n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this)}}]),t}();v.Proxy="attachMedia",t.default=(0,o.defineModel)(v)},bijffg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=j(i("cjjebecgeb")),n=j(i("jdjcgjgea")),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=E(i("ddhijeejag")),s=E(i("cajijabhgb")),u=j(i("bbjjjbicfb")),c=j(i("cgcgbfbffj")),l=j(i("chajfbfiga")),d=j(i("bhggeigghg")),f=j(i("bdiiahhjbe")),h=j(i("egjjcjcg")),p=j(i("bjigbaghc")),g=j(i("bgabgddgch")),y=E(i("ebggjhghhi")),v=j(i("eacidghfgh")),b=j(i("gbfffciea")),_=i("ccihhdchab"),m=i("hciaejfjd"),O=i("bddhdheedf"),P=j(i("bfbggcdbfb"));function E(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function j(e){return e&&e.__esModule?e:{default:e}}var T=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.checksum=void 0,e.listenTo(e,"remove",e.handleRemove),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.default),o(t,[{key:"addNewLabel",value:function(e,t){(0,O.logLabelOperationEvent)(P.default.LABEL_OPERATIONS.ADD,1,P.default.LABEL_TARGETS.LABEL);var i=l.default.createLabel(e,t),r=new _.ActionType(l10n.t("action_adding_new_label",{labelName:e})),n=(0,_.genId)(),o=i.then(function(t){return 200===t.status?new _.ActionType(l10n.t("action_new_label_added",{labelName:e})):new _.ActionType(l10n.t("action_new_label_add_failed",{labelName:e}))}).catch(function(t){return f.default.error("addingNewLabel dropped")(t),new _.ActionType(l10n.t("action_new_label_add_failed",{labelName:e}))});return b.default.openToast(a.createElement(_.ActionToast,{id:n,initialAction:r,pendingAction:o})),i}},{key:"addOrRemoveLabels",value:function(e,t){var i=l.default.addOrRemoveLabels(e,t),r=new _.ActionType(l10n.t("action_add_remove_labels",{count:e.length,_plural:e.length})),n=(0,_.genId)(),o=i.then(function(t){return 200===t.status?new _.ActionType(l10n.t("action_add_remove_labels_sucess",{count:e.length,_plural:e.length})):new _.ActionType(l10n.t("action_add_remove_labels_failed"))}).catch(function(e){return f.default.error("addingNewLabel dropped")(e),new _.ActionType(l10n.t("action_add_remove_labels_failed"))});return b.default.openToast(a.createElement(_.ActionToast,{id:n,initialAction:r,pendingAction:o})),i}},{key:"deleteLabel",value:function(e){(0,O.logLabelOperationEvent)(P.default.LABEL_OPERATIONS.DELETE,1,P.default.LABEL_TARGETS.LABEL);var t=l.default.deleteLabel(e),i=this.assertGet(e).name,r=new _.ActionType(l10n.t("action_deleting_label",{labelName:i})),n=(0,_.genId)(),o=t.then(function(e){return 200===e.status?new _.ActionType(l10n.t("action_delete_label_sucess",{labelName:i})):new _.ActionType(l10n.t("action_delete_label_failed",{labelName:i}))}).catch(function(e){return f.default.error("addingNewLabel dropped")(e),new _.ActionType(l10n.t("action_delete_label_failed",{labelName:i}))});return b.default.openToast(a.createElement(_.ActionToast,{id:n,initialAction:r,pendingAction:o})),t}},{key:"updateLabel",value:function(e,t,i){(0,O.logLabelOperationEvent)(P.default.LABEL_OPERATIONS.EDIT,1,P.default.LABEL_TARGETS.LABEL);var r=l.default.editLabel(e,i,t),n=new _.ActionType(l10n.t("action_label_update_color")),o=(0,_.genId)(),s=r.then(function(e){return 200===e.status?new _.ActionType(l10n.t("action_label_update_color_succeeded")):new _.ActionType(l10n.t("action_label_update_color_failed"))}).catch(function(e){return f.default.error("addingNewLabel dropped")(e),new _.ActionType(l10n.t("action_label_update_color_failed"))});return b.default.openToast(a.createElement(_.ActionToast,{id:o,initialAction:n,pendingAction:s})),r}},{key:"getNewLabelColor",value:function(){return l.default.queryNextLabelColor().then(function(e){return e.labelColors[0].color}).catch(function(e){})}},{key:"getLabelColorPalette",value:function(){return this.labelColorPalette=this.labelColorPalette||h.default.getSmbLabelPalette(),this.labelColorPalette&&this.labelColorPalette.waVersion===p.default.phone.wa_version?Promise.resolve(this.labelColorPalette.colors):this._getColorPaletteLoop().then(function(e){var t=e.labelColors.map(function(e){return e.color});return h.default.setSmbLabelPalette({colors:t,waVersion:p.default.phone.wa_version}),t}).catch(function(){})}},{key:"_getColorPaletteLoop",value:function(){return Promise.loop(function(e,t,i){var r=Promise.delay(g.default.expBackoff(i,12e4,1e3,.1));return("CONNECTED"===v.default.stream?Promise.resolve():y.waitForBBEvent(v.default,"change:stream",function(){return"CONNECTED"===v.default.stream})).then(function(){return l.default.queryLabelPalette().then(function(t){e(t)})}).catch(function(e){return!(e instanceof Promise.CancellationError)},function(e){return i>3||404===e?(f.default.error("labels:loadLabelPalette:error "+String(e))(),404===e?Promise.reject(new s.E404):Promise.reject(new s.GaveUpRetry("Gave up loading label palette "+i+" tries"))):r})},0)}},{key:"handleRemove",value:function(e){e.labeltemColleciton.toArray().forEach(function(e){var t=e.parentId,i=e.parentType,r=e.labelId,o=d.default[i].get(t);o&&(o.labels=(0,n.default)(o.labels,function(e){return e!==r}))})}},{key:"onResume",value:function(){var e=this;this.filter(function(e){return e.hasObservers()}).forEach(function(t){e.find(t.id).catch(s.WapDrop,function(){})})}},{key:"delete",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),delete this.checksum}},{key:"sync",value:function(e){if(!e||this.checksum!==e)return this.findQuery({})}},{key:"handle",value:function(e){if(e.checksum&&this.updateChecksum(e.checksum),e.labels&&e.labels[0]&&e.labels[0].labelUpdates){var t=void 0;return e.labels[0].labelUpdates.forEach(function(e){e.collection.forEach(function(i){"Msg"!==i&&"Chat"!==i||(t=!0);var n=e.id,o=d.default[i].get(e.id);o&&(o.labels&&o.labels.forEach(function(t){(0,r.default)(e.labels,t)||(0,m.removeLabelFromCollection)(n,t,i)}),o.labels=e.labels)})}),void(t&&this.trigger("bulk_msg_chat_label_change"))}var i=[],n=[];e.labels.forEach(function(e){"delete"===e.type?i.push(e.label):n.push(e.label)}),this.remove(i.map(function(e){return e.id})),this.add(n,{merge:!0})}},{key:"_findQuery",value:function(){var e=this;return l.default.queryLabels().then(function(t){return t.checksum&&e.updateChecksum(t.checksum),t.labels})}},{key:"_find",value:function(e){return this._findQuery()}},{key:"updateChecksum",value:function(e){this.checksum=e}}]),t}();T.model=u.default,T.staleCollection=!0,T.resumeOnAvailable=!0,t.default=new T},bjcgjfiffb:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NO_DEFAULT_VALUE=t.Attr=t.INIT=void 0;var r=d(i("hajciceai")),n=d(i("bebajedcaf")),o=d(i("eicihhaba")),a=d(i("bcdejiigcg")),s=d(i("bbfdjfific")),u=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.prop=function(){return{default:arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,type:g.PROPS}},t.session=function(){return{default:arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,type:g.SESSION}},t.derived=function(e,t){return{fn:e,deps:t,type:g.DERIVED}},t.collection=function(e){return{val:e,type:g.COLLECTION}},t.convert=function(e){var t=new e({},{_internalInitializationDoNotUse:!0}),i={name:e.name||"Unknown",props:{},session:{},derived:{},collections:{},isIdType:e.isIdType};e.Collection&&(i.Collection=e.Collection);e.idClass&&(i.idClass=e.idClass);e.idWhitelist&&(i.idWhitelist=e.idWhitelist);var r=new Set(["constructor"]),n=new Set(["collection","parent","__changes","__fired","__initialized"]);(function(e){var t=[];for(var i in e)"function"!=typeof e[i]&&t.push([i,e[i]]);return t})(t).forEach(function(t){var o=u(t,2),s=o[0],c=o[1];if(!n.has(s))switch(c.type){case g.PROPS:i.props[s]=y(c);break;case g.SESSION:i.session[s]=y(c);break;case g.DERIVED:i.derived[s]=(0,a.default)(c,"type"),r.add(c.fn.name);break;case g.COLLECTION:i.collections[s]=c.val;break;default:throw new Error("Invalid defineModel Class type for "+e.name+":"+s+".")}});var o=function(e){var t={},i=Object.getPrototypeOf({}),r=e;Object.getOwnPropertyNames(r).forEach(function(e){"function"==typeof r[e]&&(t[e]=r[e])});for(;(r=Object.getPrototypeOf(r))&&r!==i;)Object.getOwnPropertyNames(r).forEach(function(e){e in t||(t[e]=r[e])});return t}(t);return r.forEach(function(e){delete o[e]}),Object.assign(i,o),i},t.stateExtend=function(e,t){var i=t.name;delete t.name;var s=function(e,t){return function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i;return e}({},t,function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(e))[t]}(e,i),u=s.prototype,l=u.__props=[],d=u.__session=[],p=u.__derived=[],g=u._collections={},y=u._definition={},_=u._derived={};(0,o.default)(t.props,function(e,t){l.push(t),b(u,t,e,h.PROP)}),(0,o.default)(t.session,function(e,t){d.push(t),b(u,t,e,h.SESSION)}),(0,o.default)(t.derived,function(e,t){p.push(t),function(e,t,i){var r=v(t),n=i.fn;e._definition[t]=e._derived[t]={sk:r,evt:"change:"+t,attr:h.DERIVED,fn:n,deps:i.deps},Object.defineProperty(e,t,{get:function(){var e=this[r];if(e!==f)return e;var t=n.call(this);return this[r]=t,t},set:function(){throw new TypeError("'"+t+"' is a derived property, it can't be set directly.")}})}(u,t,e)}),(0,o.default)(t.collections,function(e,t){g[t]=e}),Object.assign(u,(0,a.default)(t,["props","session","derived","collections"]));var m=l.concat(d),O=m.length;Object.defineProperties(u,{attributes:{get:function(){for(var e={},t=0;t<O;++t)e[m[t]]=this[m[t]];return e}},isState:{get:function(){return!0},set:function(){throw new Error("attempt to set isState")}}});for(var P={},E=0;E<O;E++){var j=m[E];"default"in y[j]&&(P[j]=f)}(0,n.default)(P)||(u.__defaults=P);if(p.length){var T=[],M={},S={};(0,o.default)(_,function(e,t){S[t]=!0,(0,o.default)(e.deps,function(e){S[e]=!0,(M[e]||(M[e]=[])).push(t),T.push([t,e])})}),T.length&&(u._deps=M,u._topo=c.default.array((0,r.default)(S),T).reverse())}return s};var c=d(i("baejaciba")),l=i("hjbbdjjdf");function d(e){return e&&e.__esModule?e:{default:e}}var f=t.INIT={sentinel:"DEFAULT VALUE PLACEHOLDER"},h=t.Attr={PROP:"PROP",SESSION:"SESSION",DERIVED:"DERIVED"},p=t.NO_DEFAULT_VALUE=Symbol("NO_DEFAULT_VALUE"),g={PROPS:"Props",SESSION:"Session",DERIVED:"Derived",COLLECTION:"Collection"};function y(e){var t=e.default;return t===p?{}:{default:t}}function v(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"__x_")+e}function b(e,t,i,r){if(!(0,s.default)(i))throw new Error("Invalid Prop/Session definition.");var n={sk:v(t),evt:"change:"+t,attr:r};void 0!==i.default&&(n.default=i.default),e._definition[t]=n;var o=(0,l.isFunction)(n.default);if(n.default&&!o){if(Array.isArray(n.default))throw new Error("Do not return mutable types as default values as they are shared. Type: Array provided.");if((0,s.default)(n.default))throw new Error("Do not return mutable types as default values as they are shared. Type: $FlowFixMeObjectType provided.")}var a=n.sk;Object.defineProperty(e,t,{set:function(e){this.set(t,e)},get:function(){var e=this[a];return e!==f?e:o?this[a]=n.default():n.default}})}},bjfecgfdgj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=g(i("hhegggegb")),n=g(i("eaaagccfda")),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),s=i("cgcgbfbffj"),u=g(s),c=g(i("djegeegcbf")),l=g(i("ccaaiecfib")),d=g(i("bdiiahhjbe")),f=g(i("dghggcieid")),h=g(i("chajfbfiga")),p=i("hjbbdjjdf");function g(e){return e&&e.__esModule?e:{default:e}}var y=100,v=36,b=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.dirty=!1,e._throttledSync=(0,r.default)(function(e){e.sync()},v,{leading:!1}),e.listenTo(e,"change:weight change:length",(0,n.default)(e._sortTrimScale,y)),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),o(t,[{key:"_sortTrimScale",value:function(){var e=this.length;if(e){this.sort(),e>v&&this.remove(this.models.slice(v));var t=this.head(),i=this.last();t&&i&&t.weight<10&&i.weight>.01||this.forEach(function(t,i){t.weight=1+(e-i)/e*3})}}},{key:"delete",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.dirty=!1,this._throttledSync.cancel()}},{key:"sync",value:function(){var e=this;return this.findQuery({},{set:!0}).finally(function(){e.dirty=!1}).catch(a.WapDrop,function(){}).catch(p.isString,function(){})}},{key:"_findQuery",value:function(){return l.default.supportsFeature(l.default.F.RECENT_EMOJI_SYNC)?h.default.recentEmojiQuery(this.dirty?this.toArray():void 0).then(function(e){return Array.isArray(e)?(e.forEach(function(e){e.id=c.default.normalizeEmoji(e.id)}),Promise.resolve(e)):(d.default.error("models:recentEmoji:findQuery error",e)(),Promise.reject("recent emoji fetch error"))}):Promise.reject("gk recent emoji sync unsupported")}},{key:"throttledSync",value:function(){l.default.supportsFeature(l.default.F.RECENT_EMOJI_SYNC)&&(d.default.log("models:RecentEmoji:throttledSync dirty: "+String(this.dirty))(),this._throttledSync(this))}},{key:"increment",value:function(e){var t=c.default.skinToneEmojis[e]||e;this.get(t)||this.add({id:t,weight:0}),this.forEach(function(e){var i=e.weight;e.id===t?i+=1:i*=.9,e.weight=Math.round(1e3*i)/1e3}),this.dirty=!0,this.throttledSync()}}]),t}();b.cachePolicy={id:"recent_emoji_collection",policy:s.CACHE_POLICY.LOAD,delay:2e3},b.comparator=function(e,t){return e.weight>t.weight?-1:1},b.model=f.default,t.default=new b},bjgdagjjci:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=i("dcaifjegcg"),a=p(o),s=p(i("djheacfeif")),u=p(i("bjebjijbfc")),c=p(i("bjigbaghc")),l=p(i("dhigahgdjb")),d=p(i("jccfhaecf")),f=i("dfdhiegfdi"),h=i("hjbbdjjdf");function p(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var y=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,a=Array(n),s=0;s<n;s++)a[s]=arguments[s];return i=r=g(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,o.prop)(),r.msg=(0,o.prop)(),r.lat=(0,o.prop)(),r.lng=(0,o.prop)(),r.accuracy=(0,o.prop)(),r.speed=(0,o.prop)(),r.degrees=(0,o.prop)(),r.sequence=(0,o.prop)(),r.comment=(0,o.prop)(),r.expiration=(0,o.prop)(),r.lastUpdated=(0,o.prop)(),r.contact=(0,o.session)(),r.expireTimerId=(0,o.session)(),r.disabled=(0,o.session)(!1),r.isMe=(0,o.derived)(r._isMe,["id"]),r.valid=(0,o.derived)(r._valid,["lat","lng"]),g(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),r(t,[{key:"_isMe",value:function(){return this.id.equals(c.default.me)}},{key:"_valid",value:function(){return t=this.lat,(0,h.isNumber)(t)&&t>=-90&&t<=90&&(e=this.lng,(0,h.isNumber)(e)&&e>=-180&&e<=180);var e,t}},{key:"initialize",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.addChild("contact",l.default.gadd(this.id)),(0,f.addLiveLocation)(this.contact,this),this.listenTo(this,"change:expiration",this._setExpireTimer),this._setExpireTimer()}},{key:"delete",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this._disableMsg(),(0,f.removeLiveLocation)(this.contact,this),this._clearExpireTimer()}},{key:"remainingTime",value:function(){return this.expiration-u.default.globalUnixTime()}},{key:"elapsedTime",value:function(){return u.default.globalUnixTime()-this.lastUpdated}},{key:"disable",value:function(){this.disabled=!0}},{key:"_disableMsg",value:function(){var e=this.msg;e&&(e.shareDuration=u.default.globalUnixTime()-e.t-1)}},{key:"_setExpireTimer",value:function(){this.expiration&&(this.remainingTime()<=0?this._expire():this.expireTimerId=s.default.setGlobalTimeout(this._expire.bind(this),1e3*this.expiration,this.expireTimerId))}},{key:"_clearExpireTimer",value:function(){s.default.clearTimeout(this.expireTimerId),this.expireTimerId=null}},{key:"_expire",value:function(){this.disable()}}]),t}();y.Proxy="liveLocationParticipant",y.idClass=d.default,t.default=(0,o.defineModel)(y)},bjigbaghc:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORMS=void 0;var r=g(i("eaaagccfda")),n=g(i("cfjdfebffb")),o=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.getPlatformTypeForLastSession=function(){return v};var s=i("dcaifjegcg"),u=g(s),c=g(i("eadfaddcj")),l=g(i("ccaaiecfib")),d=g(i("fffdgbfji")),f=g(i("bdiiahhjbe")),h=g(i("bfbggcdbfb")),p=g(i("egjjcjcg"));function g(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var v=void 0;var b=t.PLATFORMS={ANDROID:"android",BB:"bb",BBX:"bbx",IPAD:"ipad",IPHONE:"iphone",IPOD:"ipod",S40:"s40",SMBA:"smba",SMBI:"smbi",SYMBIAN:"symbian",WP7:"wp7"},_=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=y(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,s.prop)(),r.ref=(0,s.prop)(),r.refTTL=(0,s.prop)(),r.refId=(0,s.prop)(),r.wid=(0,s.prop)(),r.connected=(0,s.prop)(),r.me=(0,s.prop)(),r.protoVersion=(0,s.prop)(),r.clientToken=(0,s.prop)(),r.serverToken=(0,s.prop)(),r.secret=(0,s.prop)(),r.isResponse=(0,s.prop)(),r.battery=(0,s.prop)(),r.plugged=(0,s.prop)(),r.lc=(0,s.prop)(),r.lg=(0,s.prop)(),r.locales=(0,s.prop)(),r.is24h=(0,s.prop)(),r.platform=(0,s.prop)(),r.phone=(0,s.prop)(),r.tos=(0,s.prop)(),r.smbTos=(0,s.prop)(0),r.pushname=(0,s.prop)(),r.blockStoreAdds=(0,s.session)(!1),r.refExpiry=(0,s.derived)(r._refExpiry,["ref","refTTL"]),r.locale=(0,s.derived)(r._locale,["lg","lc"]),r.localesList=(0,s.derived)(r._localesList,["locales","lg","lc"]),r.allLocales=(0,s.derived)(r._allLocales,["localesList"]),r.allLanguages=(0,s.derived)(r._allLanguages,["localesList"]),r.platformField=(0,s.derived)(r._platformField,["platform"]),r.tosShowCallNotification=(0,s.derived)(r._tosShowCallNotification,["tos"]),r.isSMB=(0,s.derived)(r._isSMB,["platform"]),y(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),a(t,[{key:"_refExpiry",value:function(){return Date.now()+this.refTTL}},{key:"_locale",value:function(){return this.formatLocale(this.lg,this.lc)}},{key:"_localesList",value:function(){return this.locales&&this.locales.length?this.locales.split(",").map(function(e){var t=e.split("-"),i=o(t,2),r=i[0],n=i[1];return r?[r,n]:null}).filter(function(e){return!!e}):this.lg?[[this.lg,this.lc]]:[]}},{key:"_allLocales",value:function(){var e=this;return(0,n.default)(this.localesList.map(function(t){var i=o(t,2),r=i[0],n=i[1];return e.formatLocale(r,n)}))}},{key:"_allLanguages",value:function(){return(0,n.default)(this.localesList.map(function(e){var t=o(e,2),i=t[0];t[1];return i}))}},{key:"_platformField",value:function(){return"wp7"===this.platform?h.default.PLATFORM_TYPE.WP:this.platform&&h.default.PLATFORM_TYPE[this.platform.toUpperCase()]||h.default.PLATFORM_TYPE.UNKNOWN}},{key:"_tosShowCallNotification",value:function(){return this.tos<2}},{key:"_isSMB",value:function(){return this.platform===b.SMBA||this.platform===b.SMBI}},{key:"initialize",value:function(){var e=this;u.default.prototype.initialize.call(this),this.listenTo(this,"change:locale",function(e,t){d.default.setLocale(t,c.default.L10N_PRIORITY.PHONE)}),this.listenTo(this,"change:plugged",(0,r.default)(function(){h.default.Global.webcPhoneCharging=e.plugged},5e3,{leading:!0})),this.listenTo(this,"change:phone",function(){!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.mcc,i=e.mnc;t&&"string"==typeof t&&(t=parseInt(t,10));i&&"string"==typeof i&&(i=parseInt(i,10));h.default.Global.set({mcc:t||null,mnc:i||null,webcPhoneDeviceManufacturer:e.device_manufacturer||null,webcPhoneDeviceModel:e.device_model||null,webcPhoneOsBuildNumber:e.os_build_number||null,webcPhoneOsVersion:e.os_version||null,webcPhoneAppVersion:e.wa_version||null})}(e.phone)}),this.listenTo(this,"change:me",this.updateVoipAvailability),this.listenTo(l.default,l.default.FEATURE_CHANGE_EVENT,this.updateVoipAvailability),this.listenTo(this,"change:platform",this.handlePlatformChange)}},{key:"delete",value:function(){p.default.setPushname(),p.default.setVersion(),this.clear()}},{key:"canSetMyPushname",value:function(){return!this.isSMB}},{key:"updateVoipAvailability",value:function(){var e=i("bhgjacgcdd").default;(l.default.supportsFeature(l.default.F.VOIP_INDIVIDUAL_OUTGOING)||l.default.supportsFeature(l.default.F.VOIP_INDIVIDUAL_INCOMING))&&(this.me?e.init():e.cleanup())}},{key:"handlePlatformChange",value:function(){f.default.log("Conn: platform change: "+this.platform)(),this.platform&&(v=p.default.getLastMobilePlatform(),p.default.setLastMobilePlatform(this.platform))}},{key:"formatLocale",value:function(e,t){return e?t?e.toLowerCase()+"-"+t.toUpperCase():e.toLowerCase():null}}]),t}();_.Proxy="conn";var m=(0,s.defineModel)(_);t.default=new m({id:"1"})},caedaejadb:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),o=c(i("eadfaddcj")),a=c(i("cbcbdjdah")),s=c(i("biecbbiiee")),u=c(i("cgcgbfbffj"));function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=l(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.hasLinkBefore=!0,l(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),r(t,[{key:"delete",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.stopListening(),this.reset()}},{key:"queryLinks",value:function(e,t){var i=this;if(t)return this.queryLinkBefore?this.queryLinkBefore:(this.queryLinkBefore=s.default.queryMedia(t.id.remote,o.default.MEDIA_QUERY_LIMIT,"before",t.id,"url").then(function(e){return(!e||e.length<o.default.MEDIA_QUERY_LIMIT)&&(i.hasLinkBefore=!1),i.add(e,{at:0}),i.createLinksAndAddMsgs(e),{length:e.length}}).catch(n.WapDrop,n.ProtoVersionUndefined,function(){}).catch(404,function(){}).finally(function(){i.queryLinkBefore=null,i.trigger("query_link_before")}),this.trigger("query_link_before"),this.queryLinkBefore);var r=e.msgs.getModelsArray();if(0===this.length){if(!r||0===r.length)return this.hasLinkBefore=!1,new Promise(function(e){e({eof:!0})});this.add(r.filter(function(e){return e.getLinks().length>0}),{at:0}),this.createLinksAndAddMsgs(r)}if(e.msgs.msgLoadState.noEarlierMsgs)return this.hasLinkBefore=!1,new Promise(function(e){e({eof:!0})});if(this.length<=2*o.default.MEDIA_QUERY_LIMIT){var a=0===this.length?e.msgs.head():this.head();return this.queryLinks(e,a)}return new Promise(function(e){e({eof:!1})})}},{key:"createLinksAndAddMsgs",value:function(e){var t=this,i=[];Promise.loop(function(t,r,n){e.length===n&&t();var o=e[n];o.getLinks().length&&i.push(o)}).then(function(){t.add(i),t.trigger("query_link_before")})}}]),t}();d.model=a.default,d.comparator=function(e,t){return e.t-t.t},t.default=d},cbcbdjdah:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE=void 0;var r=z(i("dcdehfghdi")),n=z(i("diifagijfe")),o=z(i("bfhjejbhhd")),a=z(i("bcdejiigcg")),s=z(i("djfhiaaehb")),u=z(i("bhaghghai")),c=z(i("bebajedcaf")),l=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),f=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},h=i("eadfaddcj");Object.defineProperty(t,"TYPE",{enumerable:!0,get:function(){return h.MSG_TYPE}}),t.createProductInquiry=function(e,t,i){var r=Z({ack:0,id:new A.default({id:"product_inquiry",remote:t,fromMe:!0}),from:t,t:_.default.globalUnixTime(),type:h.MSG_TYPE.PRODUCT,title:e.name,description:e.description,businessOwnerJid:t.toString({legacy:!0}),productId:e.id.toString(),url:e.url,productImageCount:e.productImageCollection.length,body:i.preview&&i.preview._b64,currencyCode:e.currency,priceAmount1000:e.priceAmount1000});return r.mediaData.set(i),r};var p=W(i("ddgbhifaji")),g=i("dcaifjegcg"),y=z(g),v=z(i("daffbcegjj")),b=z(h),_=z(i("bjebjijbfc")),m=z(i("gbfffciea")),O=z(i("bjigbaghc")),P=z(i("bjgiedaj")),E=z(i("djegeegcbf")),j=z(i("ccaaiecfib")),T=W(i("dbcedfihd")),M=z(i("bdiiahhjbe")),S=z(i("bffjfbgbg")),C=z(i("bfbggcdbfb")),w=z(i("bfgbdiffgd")),k=z(i("bhggeigghg")),A=z(i("ccgjijjbbj")),I=W(i("ccbagdhfbb")),L=W(i("ebggjhghhi")),R=z(i("jccfhaecf")),N=z(i("cfejjfjhca")),D=z(i("cgfjebhhej")),F=z(i("djbfhebjhe")),G=z(i("hciaejfjd")),U=z(i("cijheiibhg")),x=i("chhhffajfi"),Y=i("bcjidabgad"),B=i("hjbbdjjdf"),V=i("bdgehigfig"),q=i("cefjgcjhgf"),H=i("dffjhcaahi"),K=i("beadfddidc");function W(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function z(e){return e&&e.__esModule?e:{default:e}}function J(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var Q=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=J(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,g.prop)(),r.body=(0,g.prop)(),r.type=(0,g.prop)(),r.subtype=(0,g.prop)(),r.t=(0,g.prop)(),r.notifyName=(0,g.prop)(),r.from=(0,g.prop)(),r.to=(0,g.prop)(),r.author=(0,g.prop)(),r.self=(0,g.prop)("in"),r.ack=(0,g.prop)(),r.invis=(0,g.prop)(),r.isNewMsg=(0,g.prop)(),r.star=(0,g.prop)(!1),r.recvFresh=(0,g.prop)(),r.caption=(0,g.prop)(),r.clientUrl=(0,g.prop)(),r.loc=(0,g.prop)(),r.lat=(0,g.prop)(),r.lng=(0,g.prop)(),r.isLive=(0,g.prop)(),r.accuracy=(0,g.prop)(),r.speed=(0,g.prop)(),r.degrees=(0,g.prop)(),r.comment=(0,g.prop)(),r.sequence=(0,g.prop)(),r.shareDuration=(0,g.prop)(),r.finalLat=(0,g.prop)(),r.finalLng=(0,g.prop)(),r.finalAccuracy=(0,g.prop)(),r.finalThumbnail=(0,g.prop)(),r.finalSpeed=(0,g.prop)(),r.finalDegrees=(0,g.prop)(),r.finalTimeOffset=(0,g.prop)(),r.directPath=(0,g.prop)(),r.mimetype=(0,g.prop)(),r.duration=(0,g.prop)(),r.filehash=(0,g.prop)(),r.uploadhash=(0,g.prop)(),r.size=(0,g.prop)(),r.filename=(0,g.prop)(),r.streamingSidecar=(0,g.prop)(),r.mediaKey=(0,g.prop)(),r.pageCount=(0,g.prop)(),r.isGif=(0,g.prop)(),r.gifAttribution=(0,g.prop)(),r.streamable=(0,g.prop)(),r.width=(0,g.prop)(),r.height=(0,g.prop)(),r.canonicalUrl=(0,g.prop)(),r.matchedText=(0,g.prop)(),r.thumbnail=(0,g.prop)(),r.richPreviewType=(0,g.prop)(),r.title=(0,g.prop)(),r.description=(0,g.prop)(),r.businessOwnerJid=(0,g.prop)(),r.productId=(0,g.prop)(),r.currencyCode=(0,g.prop)(),r.priceAmount1000=(0,g.prop)(),r.retailerId=(0,g.prop)(),r.url=(0,g.prop)(),r.productImageCount=(0,g.prop)(),r.recipients=(0,g.prop)(),r.broadcast=(0,g.prop)(),r.quotedMsg=(0,g.prop)(),r.quotedStanzaID=(0,g.prop)(),r.quotedRemoteJid=(0,g.prop)(),r.quotedParticipant=(0,g.prop)(),r.mentionedJidList=(0,g.prop)(),r.footer=(0,g.prop)(),r.buttons=(0,g.prop)(),r.multicast=(0,g.prop)(),r.urlText=(0,g.prop)(),r.urlNumber=(0,g.prop)(),r.clearMedia=(0,g.prop)(),r.vcardList=(0,g.prop)(),r.protocolMessageKey=(0,g.prop)(),r.templateParams=(0,g.prop)(),r.textColor=(0,g.prop)(),r.backgroundColor=(0,g.prop)(),r.font=(0,g.prop)(),r.isForwarded=(0,g.prop)(!1),r.forwardingScore=(0,g.prop)(),r.labels=(0,g.prop)(),r.currency=(0,g.prop)(),r.amount1000=(0,g.prop)(),r.receiverJid=(0,g.prop)(),r.paymentStatus=(0,g.prop)(),r.paymentNoteMsg=(0,g.prop)(),r.paymentTransactionTimestamp=(0,g.prop)(),r.paymentRequestMessageKey=(0,g.prop)(),r._currencyCodeIso4217=(0,g.prop)(),r._paymentRequestFrom=(0,g.prop)(),r._paymentExpiryTimestamp=(0,g.prop)(),r.promises=(0,g.session)(function(){return{}}),r.local=(0,g.session)(),r.search=(0,g.session)(),r.msgChunk=(0,g.session)(),r.phoneUploading=(0,g.session)(),r.startOfDay=(0,g.session)(),r.startOfDaySkew=(0,g.session)(),r._quotedMsgObj=(0,g.session)(),r.isQuotedMsgAvailable=(0,g.session)(!0),r.senderObj=(0,g.session)(),r.mediaData=(0,g.session)(),r.inviteCode=(0,g.prop)(),r.inviteCodeExp=(0,g.prop)(),r.inviteGrp=(0,g.prop)(),r.inviteGrpName=(0,g.prop)(),r.inviteGrpJpegThum=(0,g.prop)(),r._links=(0,g.session)(function(){return[]}),r.linksIndexParsed=(0,g.session)(0),r.chat=(0,g.derived)(r._chat),r.hasTemplateButtons=(0,g.derived)(r._hasTemplateButtons,["buttons"]),r.isQuickReply=(0,g.derived)(r._isQuickReply,["buttons"]),r.isFutureproof=(0,g.derived)(r._isFutureproof,["type","subtype"]),r.isGroupMsg=(0,g.derived)(r._isGroupMsg),r.isStatusV3=(0,g.derived)(r._isStatusV3),r.isPSA=(0,g.derived)(r._isPSA),r.isRTL=(0,g.derived)(r._isRTL,["dir"]),r.isProductInquiry=(0,g.derived)(r._isProductInquiry),r.statusV3TextBg=(0,g.derived)(r._statusV3TextBg),r.isSentByMe=(0,g.derived)(r._isSentByMe),r.isSentByMeFromWeb=(0,g.derived)(r._isSentByMeFromWeb,["isUserCreatedType"]),r.isNotification=(0,g.derived)(r._isNotification,["type"]),r.isGroupNotification=(0,g.derived)(r._isGroupNotification,["type"]),r.isBroadcastNotification=(0,g.derived)(r._isBroadcastNotification,["type"]),r.isBizNotification=(0,g.derived)(r._isBizNotification,["type","subtype"]),r.isProduct=(0,g.derived)(r._isProduct,["type"]),r.isValidAlbumAsset=(0,g.derived)(r._isValidAlbumAsset,["type","isNotification","caption","isForwarded","isRevoked","isGif"]),r.isValidGroupedSticker=(0,g.derived)(r._isValidGroupedSticker,["type","isNotification","isForwarded","isRevoked"]),r.isMedia=(0,g.derived)(r._isMedia,["type"]),r.isDoc=(0,g.derived)(r._isDoc,["type"]),r.isMMS=(0,g.derived)(r._isMMS,["type"]),r.isRevoked=(0,g.derived)(r._isRevoked,["type"]),r.numTimesForwarded=(0,g.derived)(r._numTimesForwarded,["isForwarded","forwardingScore"]),r.isFrequentlyForwarded=(0,g.derived)(r._isFrequentlyForwarded,["numTimesForwarded"]),r.eventType=(0,g.derived)(r._eventType,["type","invis","isNewMsg"]),r.sender=(0,g.derived)(r._sender),r.text=(0,g.derived)(r._text,["type","body","caption","comment","isLive","paymentNoteMsg","subtype"]),r.containsEmoji=(0,g.derived)(r._containsEmoji,["text"]),r.isFailed=(0,g.derived)(r._isFailed,["isSentByMe","ack"]),r.vcard=(0,g.derived)(r._vcard,["type","body"]),r.isUnsentMedia=(0,g.derived)(r._isUnsentMedia,["ack","isMMS","isSentByMe"]),r.dir=(0,g.derived)(r._dir,["type","text","subtype"]),r.rtl=(0,g.derived)(r._rtl,["type","text","subtype"]),r.linkPreview=(0,g.derived)(r._linkPreview,["matchedText","body","title","description"]),r.isGroupsV4InviteExpired=(0,g.derived)(r._isGroupsV4InviteExpired,["type","inviteCode","inviteCodeExp"]),r.isPersistent=(0,g.derived)(r._isPersistent),r.isUnreadType=(0,g.derived)(r._isUnreadType,["type"]),r.isUserCreatedType=(0,g.derived)(r._isUserCreatedType,["type"]),r.initialPageSize=(0,g.derived)(r._initialPageSize,["isFrequentlyForwarded"]),J(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,y.default),d(t,[{key:"_chat",value:function(){return k.default.Chat.get(this.id.remote)}},{key:"_hasTemplateButtons",value:function(){return(0,K.shouldEnableHsm)()&&Array.isArray(this.buttons)&&this.buttons.length>0}},{key:"_isQuickReply",value:function(){return(0,K.shouldEnableHsm)()&&this.hasTemplateButtons&&null!=this.buttons&&"quick_reply"===this.buttons[0].subtype}},{key:"_isFutureproof",value:function(){return this.type===h.MSG_TYPE.UNKNOWN||this.type===h.MSG_TYPE.PAYMENT&&"futureproof"===this.subtype}},{key:"_isGroupMsg",value:function(){return R.default.isGroup(this.from)||R.default.isGroup(this.to)}},{key:"_isStatusV3",value:function(){return R.default.isStatusV3(this.id.remote)}},{key:"_isPSA",value:function(){return R.default.isPSA(this.id.remote)}},{key:"_isRTL",value:function(){return"rtl"===this.dir||void 0===this.dir&&l10n.isRTL()}},{key:"_isProductInquiry",value:function(){return this.id&&this.id.id===b.default.PRODUCT_INQUIRY_TYPE}},{key:"_statusV3TextBg",value:function(){if(!this.isStatusV3)return null;var e=this.backgroundColor;return e?"rgba("+(e>>16&255)+", "+(e>>8&255)+", "+(255&e)+", "+(e>>24&255)+")":null}},{key:"_isSentByMe",value:function(){return"in"!==this.id.self&&!this.isNotification&&R.default.equals(this.from,O.default.me)}},{key:"_isSentByMeFromWeb",value:function(){return this.id.fromMe&&this.local&&this.isUserCreatedType}},{key:"_isNotification",value:function(){switch(this.type){case h.MSG_TYPE.GROUP_NOTIFICATION:case h.MSG_TYPE.GP2:case h.MSG_TYPE.BROADCAST_NOTIFICATION:case h.MSG_TYPE.NOTIFICATION:case h.MSG_TYPE.NOTIFICATION_TEMPLATE:case h.MSG_TYPE.E2E_NOTIFICATION:case h.MSG_TYPE.CALL_LOG:return!0;default:return!1}}},{key:"_isGroupNotification",value:function(){switch(this.type){case h.MSG_TYPE.GROUP_NOTIFICATION:case h.MSG_TYPE.GP2:return!0;default:return!1}}},{key:"_isBroadcastNotification",value:function(){return this.type===h.MSG_TYPE.BROADCAST_NOTIFICATION}},{key:"_isBizNotification",value:function(){if(this.type===h.MSG_TYPE.NOTIFICATION_TEMPLATE)switch(this.subtype){case"verified_initial_unknown":case"verified_initial_low":case"verified_initial_high":case"verified_transition_any_to_none":case"verified_transition_any_to_high":case"verified_transition_high_to_low":case"verified_transition_high_to_unknown":case"verified_transition_unknown_to_low":case"verified_transition_low_to_unknown":case"verified_transition_none_to_low":case"verified_transition_none_to_unknown":case"biz_verified_transition_top_to_bottom":case"biz_verified_transition_bottom_to_top":case"biz_intro_top":case"biz_intro_bottom":case"biz_name_change":case"biz_move_to_consumer_app":case"biz_two_tier_migration_top":case"biz_two_tier_migration_bottom":return!0;default:return!1}return!1}},{key:"_isProduct",value:function(){return"product"===this.type}},{key:"_isValidAlbumAsset",value:function(){return!(this.type!==b.default.MSG_TYPE.IMAGE&&this.type!==b.default.MSG_TYPE.VIDEO||this.isNotification||this.caption||this.isForwarded||this.isRevoked||this.isGif)}},{key:"_isValidGroupedSticker",value:function(){return this.type===b.default.MSG_TYPE.STICKER&&!this.isNotification&&!this.isForwarded&&!this.isRevoked}},{key:"_isMedia",value:function(){return["image","video","audio","product"].includes(this.type)||(0,K.shouldEnableHsm)()&&"template"===this.type&&("image"===this.subtype||"video"===this.subtype)}},{key:"_isDoc",value:function(){return"document"===this.type||(0,K.shouldEnableHsm)()&&"template"===this.type&&"document"===this.subtype}},{key:"_isMMS",value:function(){return I.typeIsMMS(this.type,this.subtype)}},{key:"_isRevoked",value:function(){return this.type===h.MSG_TYPE.REVOKED}},{key:"_numTimesForwarded",value:function(){return this.forwardingScore?this.forwardingScore||0:this.isForwarded?1:0}},{key:"_isFrequentlyForwarded",value:function(){return this.numTimesForwarded>=b.default.FREQUENTLY_FORWARDED_SENTINEL}},{key:"_eventType",value:function(){if(!this.isNewMsg)return"i";var e=this.eventTypeFromMsgType();return this.invis?"i"===e?"i":"n":e}},{key:"_sender",value:function(){return this.isSentByMe?this.from:this.isGroupMsg||this.isStatusV3?this.author:this.from}},{key:"_text",value:function(){switch(this.type){case h.MSG_TYPE.CHAT:return this.body;case h.MSG_TYPE.IMAGE:case h.MSG_TYPE.VIDEO:return this.caption;case h.MSG_TYPE.LOCATION:return this.isLive?this.comment:(0,K.shouldEnableHsm)()?this.caption:void 0;case h.MSG_TYPE.PAYMENT:var e=this.paymentNoteMsg;return e?e.body:void 0;case h.MSG_TYPE.GROUPS_V4_INVITE:return this.comment;case h.MSG_TYPE.PRODUCT:return this.getProductInfoText();case h.MSG_TYPE.HSM:return this.body;case h.MSG_TYPE.TEMPLATE:if((0,K.shouldEnableHsm)())return"text"===this.subtype?this.body:this.caption;case h.MSG_TYPE.TEMPLATE_BUTTON_REPLY:return this.body;default:return}}},{key:"_containsEmoji",value:function(){var e=this.text;return!!e&&E.default.containsEmoji(e)}},{key:"_isFailed",value:function(){return this.isSentByMe&&this.ack<0}},{key:"_vcard",value:function(){if(this.type===h.MSG_TYPE.VCARD)try{return D.default.parse(this.body)}catch(e){return}}},{key:"_isUnsentMedia",value:function(){return this.ack<1&&this.isMMS&&this.isSentByMe}},{key:"_dir",value:function(){return this.type===h.MSG_TYPE.VCARD?this.subtype?v.default.dir(this.subtype):void 0:this.text?v.default.dir(this.text):void 0}},{key:"_rtl",value:function(){return this.type===h.MSG_TYPE.VCARD?!!this.subtype&&"rtl"===v.default.dir(this.subtype):!!this.text&&"rtl"===v.default.dir(this.text)}},{key:"_linkPreview",value:function(){return(0,B.isString)(this.matchedText)&&(!(0,c.default)(this.title)||!(0,c.default)(this.description))&&this.body.includes(this.matchedText)}},{key:"_isGroupsV4InviteExpired",value:function(){if(this.type!==b.default.MSG_TYPE.GROUPS_V4_INVITE)return!1;if(!this.inviteCode)return!0;var e=(new Date).getTime()/1e3;return parseInt(e,10)>=parseInt(this.inviteCodeExp,10)}},{key:"_isPersistent",value:function(){return this.type===h.MSG_TYPE.E2E_NOTIFICATION&&"encrypt"===this.subtype}},{key:"_isUnreadType",value:function(){return[h.MSG_TYPE.CHAT,h.MSG_TYPE.IMAGE,h.MSG_TYPE.VIDEO,h.MSG_TYPE.AUDIO,h.MSG_TYPE.PTT,h.MSG_TYPE.DOCUMENT,h.MSG_TYPE.VCARD,h.MSG_TYPE.LOCATION,h.MSG_TYPE.CIPHERTEXT,h.MSG_TYPE.OVERSIZED,h.MSG_TYPE.MULTI_VCARD,h.MSG_TYPE.REVOKED,h.MSG_TYPE.UNKNOWN,h.MSG_TYPE.STICKER,h.MSG_TYPE.PRODUCT,h.MSG_TYPE.GROUPS_V4_INVITE].includes(this.type)}},{key:"_isUserCreatedType",value:function(){return[h.MSG_TYPE.PROTOCOL,h.MSG_TYPE.CHAT,h.MSG_TYPE.LOCATION,h.MSG_TYPE.VCARD,h.MSG_TYPE.MULTI_VCARD,h.MSG_TYPE.IMAGE,h.MSG_TYPE.VIDEO,h.MSG_TYPE.AUDIO,h.MSG_TYPE.PTT,h.MSG_TYPE.DOCUMENT,h.MSG_TYPE.STICKER,h.MSG_TYPE.PRODUCT,h.MSG_TYPE.GROUPS_V4_INVITE].includes(this.type)}},{key:"_initialPageSize",value:function(){return this.isFrequentlyForwarded?b.default.FREQUENTLY_FORWARDED_INITIAL_PAGE_SIZE:b.default.INITIAL_PAGE_SIZE}},{key:"initialize",value:function(){var e=this;if(f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.sender)this.addChild("senderObj",k.default.Contact.gadd(this.sender));else switch(this.type){case h.MSG_TYPE.NOTIFICATION:case h.MSG_TYPE.NOTIFICATION_TEMPLATE:case h.MSG_TYPE.GROUP_NOTIFICATION:case h.MSG_TYPE.GP2:case h.MSG_TYPE.BROADCAST_NOTIFICATION:case h.MSG_TYPE.E2E_NOTIFICATION:case h.MSG_TYPE.CALL_LOG:case h.MSG_TYPE.PROTOCOL:break;default:M.default.log("msg:msg with no sender id:"+this.id.toString()+", from:"+this.from.toString()+", author:"+(this.author&&this.author.toString())+", type:"+this.type)()}this.mentionedJidList=this.mentionedJidList||[],this.mentionedJidList.forEach(function(e){return k.default.Contact.gadd(e)});var i,r=this.getCollection();(i=r.preAck[this.id])&&(M.default.log("Msg:initialize updating msg with out of order ack",i)(),this.updateAck(i.ack),delete r.preAck[this.id]),this.type===h.MSG_TYPE.CIPHERTEXT&&this.listenToOnce(this,"change:type",this.onCiphertextDecrypted),this._mediaObject=void 0,I.typeIsMMS(this.type,this.subtype)&&(this._createMediaDataChild(),p.registerMsg(this)),this.isSentByMeFromWeb&&(this.promises.sendPromise=Promise.sit("settled").finally(function(){e.promises.sendPromise=null}).endWithControls("settled")),this.isLive&&k.default.LiveLocation.processMsg(this,!1),O.default.isSMB&&(this.addLabelsToCollection(),this.listenTo(this,"change:labels",this.addLabelsToCollection)),w.default.getWebRestoreFromCache()&&!j.default.supportsFeature(j.default.F.MODEL_STORAGE)&&this.listenTo(this,"change:ack",this.onAckChange)}},{key:"getLinks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.initialPageSize+1,t=this.text;if(!t)return this._links;if(this.linksIndexParsed>=e)return this._links;var i=(0,x.firstNCodepoints)(t,e),r=T.findLinks(i,!1,this.sender);if(t.length>e&&r.length>0){var n=r[r.length-1];n.index+(0,x.numCodepoints)(n.url)===e&&(r=T.findLinks(t,!1,this.sender))}return this.linksIndexParsed=e,this._links=r}},{key:"getGalleryLinks",value:function(){return(0,u.default)(this.getLinks(),"href").filter(function(e){return e.isHttp})}},{key:"getSuspiciousLinks",value:function(){return this.getLinks().filter(function(e){return e.suspiciousCharacters&&e.suspiciousCharacters.size})}},{key:"addLabelsToCollection",value:function(){(0,G.default)(this.id.toString(),this.labels,"Msg")}},{key:"_createMediaDataChild",value:function(){this.addChild("mediaData",new S.default)}},{key:"hasSymbol",value:function(){return["image","video","audio","ptt","location","vcard","multi_vcard","document","ciphertext","oversized","unknown","call_log","revoked","sticker","payment","groups_v4_invite","product"].includes(this.type)||"template"===this.type&&"text"!==this.subtype}},{key:"mayFail",value:function(){return this.isSentByMe&&this.ack<1}},{key:"isUnsentPhoneMsg",value:function(){return!this.local&&this.isSentByMe&&this.ack<1}},{key:"canReply",value:function(){return this.chat.canSend&&!this.mayFail()&&!this.isNotification&&this.type!==h.MSG_TYPE.UNKNOWN&&this.type!==h.MSG_TYPE.CIPHERTEXT&&this.type!==h.MSG_TYPE.OVERSIZED&&this.type!==h.MSG_TYPE.REVOKED&&j.default.supportsFeature(j.default.F.REPLIES_OUT)}},{key:"canPrivateReply",value:function(){return!this.mayFail()&&!this.isNotification&&this.type!==h.MSG_TYPE.UNKNOWN&&this.type!==h.MSG_TYPE.CIPHERTEXT&&this.type!==h.MSG_TYPE.OVERSIZED&&this.type!==h.MSG_TYPE.REVOKED&&j.default.supportsFeature(j.default.F.REPLIES_OUT)&&!this.isSentByMe&&this.isGroupMsg&&j.default.supportsFeature(j.default.F.PRIVATE_REPLY)}},{key:"canPrivateReplyInRestrictedGrp",value:function(){return!!this.chat.isAnnounceGrpRestrict&&!this.chat.isReadOnly&&j.default.supportsFeature(j.default.F.PRIVATE_REPLY)&&j.default.supportsFeature(j.default.F.REPLIES_OUT)&&!this.mayFail()&&!this.isSentByMe&&!this.isNotification&&this.type!==h.MSG_TYPE.UNKNOWN&&this.type!==h.MSG_TYPE.CIPHERTEXT&&this.type!==h.MSG_TYPE.OVERSIZED&&this.type!==h.MSG_TYPE.REVOKED}},{key:"canForward",value:function(){if(this.type===h.MSG_TYPE.CIPHERTEXT)return!1;if(this.type===h.MSG_TYPE.OVERSIZED)return!1;if(this.type===h.MSG_TYPE.REVOKED)return!1;if(this.type===h.MSG_TYPE.UNKNOWN)return!1;if(this.type===h.MSG_TYPE.PAYMENT)return!1;if(this.type===h.MSG_TYPE.GROUPS_V4_INVITE)return!1;if(this.type===h.MSG_TYPE.LOCATION&&this.isLive)return!1;if(this.ack<1&&this.isSentByMe)return!1;if(this.isMMS){var e=this.mediaData;if(!p.canSendType(e.type))return!1;if(e.mediaStage===S.default.STAGE.ERROR_MISSING)return!1;if(e.mediaStage===S.default.STAGE.ERROR_UNSUPPORTED)return!1;if(this.isUnsentMedia)return!1}return!0}},{key:"canQuickForward",value:function(){return this.canForward()&&!this.isFrequentlyForwarded&&0===this.getSuspiciousLinks().length&&this.type!==b.default.MSG_TYPE.PTT&&this.type!==b.default.MSG_TYPE.STICKER&&(this.isMMS||this.linkPreview||this.type===b.default.MSG_TYPE.LOCATION)}},{key:"canStar",value:function(){return!(this.isNotification||this.isFutureproof||this.type===h.MSG_TYPE.REVOKED||this.ack<1&&this.isSentByMe)}},{key:"isGroupLeave",value:function(){return"gp2"===this.type&&("leave"===this.subtype||"remove"===this.subtype)&&R.default.equals((0,s.default)(this.recipients),O.default.me)}},{key:"isTrusted",value:function(){return!!R.default.equals(this.sender,O.default.me)||(!(!this.senderObj||!this.senderObj.isMyContact)||(this.isGroupMsg?this.chat.isTrusted():this.chat.notSpam))}},{key:"getWAids",value:function(){return this.type!==h.MSG_TYPE.VCARD?null:D.default.vcardWAids(this.vcard)}},{key:"getVCardThumbnailWAid",value:function(){if(this.type!==h.MSG_TYPE.VCARD)return null;var e=this.getWAids();if(e){var t=D.default.thumbnailWAid(e);return t||(e.length?e[0]:void 0)}}},{key:"getLocObject",value:function(){var e=this.loc;if(e){var t=e.split("\n"),i=l(t,2),r=i[0],n=i[1];return{name:r,addr:void 0===n?null:n}}return null}},{key:"resumeRemoteUpload",value:function(){var e=this;return this.isUnsentPhoneMsg()&&!this.phoneUploading&&((0,V.sendMsgRecord)(this).then(function(t){"success"!==t&&(e.phoneUploading=!1)}),this.phoneUploading=!0),this.downloadMedia(!0)}},{key:"forceDownloadMedia",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.downloadMedia(!0,e)}},{key:"forceRMR",value:function(){return Promise.reject(new Error("unimplemented forceRMR"))}},{key:"isForcingRMR",value:function(){return!1}},{key:"cancelDownload",value:function(){p.cancelDownloadMsg(this)}},{key:"resumeUpload",value:function(){M.default.assert(this.mediaData.mediaStage===S.default.STAGE.NEED_UPLOAD,"resume-non-need-upload","resumeUpload called while state was "+this.mediaData.mediaStage)(),p.resumeUploadMsg(this)}},{key:"cancelUpload",value:function(){p.cancelUploadMsg(this)}},{key:"logInitialRender",value:function(){var e=this;if(this.isMMS&&this.mediaData&&!this.isStatusV3&&!this._renderEvent){var t=this._renderEvent=new C.default.WebcMediaRender({messageMediaType:this.getWamMediaType(),webcChatType:this.chat.getWebcChatType(),webcChatPosition:this.chat.initialIndex,webcBrowserNetworkType:(0,Y.getEffectiveNetworkType)(),webcMessageT:this.t});this.msgChunk===this.chat.msgs&&(t.webcMessageIndex=this.msgChunk.length-this.msgChunk.indexOf(this)-1);this.listenToAndRun(this.mediaData,"change:mediaStage",function i(){switch(e.mediaData.mediaStage){case S.default.STAGE.INIT:case S.default.STAGE.PREPARING:case S.default.STAGE.FETCHING:case S.default.STAGE.DECRYPTING:case S.default.STAGE.REMOTE_UPLOADING:case S.default.STAGE.REUPLOADING:case S.default.STAGE.UPLOADING:case S.default.STAGE.SENDING:return;case S.default.STAGE.RESOLVED:t.webcMediaStage=C.default.WEBC_MEDIA_STAGE_TYPE.RESOLVED;break;case S.default.STAGE.NEED_POKE:t.webcMediaStage=C.default.WEBC_MEDIA_STAGE_TYPE.NEEDS_RMR;break;default:t.webcMediaStage=C.default.WEBC_MEDIA_STAGE_TYPE.OTHER}e._logStorageEstimate(t).finally(function(){t.commit(),e.stopListening(e.mediaData,"change:mediaStage",i)})})}}},{key:"downloadMedia",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isRevoked)return Promise.resolve();if(M.default.assert(this.isMMS,"media-fault","downloadMedia called on non-mms msg")(),this.isUnsentPhoneMsg()){var r=this.promises.waitForPhoneUpload;return r||(r=this.promises.waitForPhoneUpload=L.waitForBBEvent(this.mediaData,"change:mediaStage change:filehash",function(){return!!e.mediaData.filehash&&!e.isUnsentPhoneMsg()}).then(function(){e.promises.waitForPhoneUpload=null})),r.then(function(){return e.downloadMedia(t,i)})}var n=p.downloadMsg(this,t);if(i){var o=performance.now(),a=new C.default.WebcMediaRmr({messageMediaType:this.getWamMediaType(),webcChatType:this.chat.getWebcChatType(),webcChatPosition:this.chat.initialIndex,webcBrowserNetworkType:(0,Y.getEffectiveNetworkType)(),webcMessageT:this.t,webcMediaSize:this.size});this.msgChunk===this.chat.msgs&&(a.webcMessageIndex=this.msgChunk.length-this.msgChunk.indexOf(this)-1),n.then(function(){return a.webcMediaRmrT=Math.ceil(performance.now()-o),e._logStorageEstimate(a)}).catch(function(){a.webcMediaRmrT=Math.ceil(performance.now()-o),a.webcMediaRmrError=!0}).finally(function(){return a.commit()})}return n}},{key:"applyUpdate",value:function(e){var t=this;return e.type&&this.type!==e.type&&I.typeIsMMS(e.type)?(this.type!==h.MSG_TYPE.CIPHERTEXT&&M.default.assert(!1,"invalid-type-update","updated "+this.id.toString()+" from "+this.type+" to "+String(e.type))(),this._createMediaDataChild(),p.registerMsgEarly(this,e),p.prepareMsg(this).then(function(){return(0,H.updateLocal)(t.id,e)}).then(function(){t.set(e)}).catch(function(e){M.default.assert(!1,"preregister-error","error = "+String(e))(e)})):(0,H.updateLocal)(this.id,e).then(function(){(t.set(e),t.isLive&&k.default.LiveLocation.processMsg(t,!0),t.paymentTransactionTimestamp)&&t.getCollection().updateLastTransactionTime(t.id.remote,t.paymentTransactionTimestamp)}).catch(function(e){M.default.assert(!1,"msg:applyUpdate: failed to update locally")(e)})}},{key:"waitForPrep",value:function(){return I.typeIsMMS(this.type,this.subtype)?p.prepareMsg(this):Promise.resolve()}},{key:"delete",value:function(){f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),k.default.AllStarredMsgs.remove(this),this.isLive&&k.default.LiveLocation.removeMsg(this),this.getCollection().remove(this.id),this.msgChunk&&this.msgChunk.remove(this.id),I.typeIsMMS(this.type)&&p.deregisterMsg(this);var e=k.default.Chat.get(this.id.remote);if(e&&(e.unreadMsgAnchor===this&&(e.unreadMsgAnchor=void 0),e.lastReceivedKey===this.id)){var i=void 0,r=e.getLastReceivedMsg();r&&(i=r.id),(0,q.setLastReceivedKey)(e.id,i).then(function(){e.lastReceivedKey=i})}}},{key:"quotedMsgObj",value:function(){if(!this.quotedMsg)return null;if(this._quotedMsgObj){var e=this.getCollection();return I.getOriginalQuotedMsgIfPossible(this._quotedMsgObj,e)}var t=!this.quotedParticipant||R.default.equals(this.quotedParticipant,O.default.me),i=t?"out":"in",r=this.quotedRemoteJid?this.quotedRemoteJid:this.id.remote,n={id:this.quotedStanzaID,from:t?O.default.me:r,to:t?r:O.default.me,self:i,author:this.quotedParticipant,remote:r};if(!(R.default.isGroup(n.from)||R.default.isGroup(n.to))&&!R.default.isStatusV3(r)||R.default.equals(O.default.me,this.quotedParticipant)||(n.participant=this.quotedParticipant),Object.assign(n,this.quotedMsg),!n)return n;this._quotedMsgObj=I.createQuotedMsg(n);var o=this.getCollection();return I.getOriginalQuotedMsgIfPossible(this._quotedMsgObj,o)}},{key:"getQuotedMsgAdminGroupJid",value:function(){return!this.quotedMsg&&this.quotedRemoteJid}},{key:"msgContextInfo",value:function(e){var t=(0,a.default)(this.toJSON(),["id","t","notifyName","from","to","author","self","ack","invis","isNewMsg","star","recvFresh","recipients","broadcast","quotedMsg","quotedStanzaID","quotedRemoteJid","quotedParticipant","senderObj","multicast"]),i=void 0;return e&&!this.id.remote.equals(e)&&(i=this.id.remote),{quotedMsg:t,quotedParticipant:this.sender,quotedStanzaID:this.id.id,quotedRemoteJid:i}}},{key:"displayName",value:function(e,t){if(!this.sender)return"";if(this.sender.equals(O.default.me))return l10n.t("web_you");var i=this.senderObj,r=e?i.shortName:void 0;if(r)return r;if(i.name)return i.name;var n=t&&this.notifyName?" ~"+this.notifyName:"";return l10n.isRTL()?l10n.embedLTR((0,F.default)(this.sender))+n:(0,F.default)(this.sender)+n}},{key:"isQuoted",value:function(e){var t=this.quotedMsgObj();return!!t&&t.sender.equals(e)}},{key:"isMentioned",value:function(e){return(0,o.default)(this.mentionedJidList,function(t){return t.equals(e)})>-1}},{key:"mentionMap",value:function(){if(!j.default.supportsFeature(j.default.F.MENTIONS_IN))return null;if(!(0,n.default)(this.mentionedJidList))return null;var e={};return this.mentionedJidList.forEach(function(t){e["@"+(R.default.user(t)||"")]=k.default.Contact.gadd(t)}),e}},{key:"updateAck",value:function(e){var t=this.ack;(0,B.isNumber)(e)&&(void 0===t||e>t)?this.ack=e:-1===e&&0===this.ack&&(this.ack=-1,this.phoneUploading=!1)}},{key:"avParams",value:function(){return p.mediaMetadata(this)}},{key:"resend",value:function(){return this.isFailed?(this.ack=0,this.isMMS?this.resumeRemoteUpload():(0,V.sendMsgRecord)(this)):Promise.resolve()}},{key:"onCiphertextDecrypted",value:function(){if(!this.isStatusV3){var e=this.chat,t=e.msgs.length,i=e.msgs.indexOf(this);-1!==i&&t-i<=10&&m.default.alertNewMsg(this)}}},{key:"onAckChange",value:function(){this.chat&&w.default.getWebRestoreFromCache()&&!j.default.supportsFeature(j.default.F.MODEL_STORAGE)&&this.chat.trigger("change:msg:ack")}},{key:"eventTypeFromMsgType",value:function(){var e=this.type,t=this.subtype,i=void 0,r=void 0;return e===h.MSG_TYPE.GP2||e===h.MSG_TYPE.GROUP_NOTIFICATION?"subject"===t?i="n":"add"===t||"invite"===t?(r=(0,s.default)(this.recipients),i=R.default.equals(r,O.default.me)?"s":"i"):"remove"===t?(r=(0,s.default)(this.recipients),i=R.default.equals(r,O.default.me)?"n":"i"):i="create"===t?"n":"i":i=e===h.MSG_TYPE.BROADCAST_NOTIFICATION||e===h.MSG_TYPE.NOTIFICATION||e===h.MSG_TYPE.E2E_NOTIFICATION?"create"===t?"n":"i":e===h.MSG_TYPE.GROUPS_V4_INVITE&&this.from===O.default.me?"i":e===h.MSG_TYPE.CALL_LOG?"n":this.broadcast||e===h.MSG_TYPE.REVOKED?"i":this.isPSA?2===this.ack?"d":"a":e===h.MSG_TYPE.CIPHERTEXT||e===h.MSG_TYPE.OVERSIZED?"a":e===h.MSG_TYPE.NOTIFICATION_TEMPLATE?"i":"d",i}},{key:"canRevoke",value:function(){return j.default.supportsFeature(j.default.F.REVOKE)&&this.id.fromMe&&this.isUserCreatedType&&(!R.default.isBroadcast(this.id.remote)||"iphone"===O.default.platform)&&!this.broadcast&&Math.trunc(+new Date/1e3)-this.t<=b.default.REVOKE_WINDOW&&!this.isUnsentPhoneMsg()&&!this.isUnsentMedia}},{key:"revoke",value:function(e){var t=this;I.typeIsMMS(this.type)&&p.deregisterMsg(this),this.chat&&this.chat.removeFromCollection(this);var i=this.getCollection(),n=this.id;this.msgChunk&&this.msgChunk.replaceId(n,e),i.replaceId(n,e);var o={id:e,type:h.MSG_TYPE.REVOKED,body:void 0,caption:void 0,clientUrl:void 0,loc:void 0,lat:void 0,lng:void 0,isLive:void 0,accuracy:void 0,speed:void 0,degrees:void 0,comment:void 0,sequence:void 0,shareDuration:void 0,finalLat:void 0,finalLng:void 0,finalAccuracy:void 0,finalThumbnail:void 0,finalSpeed:void 0,finalDegrees:void 0,finalTimeOffset:void 0,title:void 0,description:void 0,canonicalUrl:void 0,matchedText:void 0,thumbnail:void 0,richPreviewType:void 0,quotedMsg:void 0,quotedStanzaID:void 0,quotedRemoteJid:void 0,quotedParticipant:void 0,mediaData:void 0,mentionedJidList:void 0,vcardList:void 0,star:!1};return(0,H.updateLocal)(this.id,o).then(function(){if(t.set(o),t.trigger("change:msgKey",{newKey:e,oldKey:n}),t.chat&&t.chat.updateMediasCountOnMsg(t,!0),t.chat&&n.equals(t.chat.lastReceivedKey)&&(t.chat.lastReceivedKey=e),t.isLive&&k.default.LiveLocation.removeMsg(t),R.default.isBroadcast(n.remote)){var a=I.getBroadcastFanoutKeys(n),s=I.getBroadcastFanoutKeys(e);if(!a||!s||a.length!==s.length)return void M.default.log("cannot fanout revoke: "+String(a)+" "+String(s))(a,s);(0,r.default)(a,s).forEach(function(e){var t=i.get(e[0]);t&&t.revoke(e[1])})}})}},{key:"getWamMessageType",value:function(){return this.isStatusV3?C.default.MESSAGE_TYPE.STATUS:this.isGroupMsg?C.default.MESSAGE_TYPE.GROUP:R.default.isBroadcast(this.id.remote)?C.default.MESSAGE_TYPE.BROADCAST:C.default.MESSAGE_TYPE.INDIVIDUAL}},{key:"getWamMediaType",value:function(){switch(this.type){case h.MSG_TYPE.IMAGE:return C.default.MEDIA_TYPE.PHOTO;case h.MSG_TYPE.VIDEO:return this.mediaData.isGif?C.default.MEDIA_TYPE.GIF:C.default.MEDIA_TYPE.VIDEO;case h.MSG_TYPE.AUDIO:return C.default.MEDIA_TYPE.AUDIO;case h.MSG_TYPE.PTT:return C.default.MEDIA_TYPE.PTT;case h.MSG_TYPE.DOCUMENT:return C.default.MEDIA_TYPE.DOCUMENT;case h.MSG_TYPE.UNKNOWN:return C.default.MEDIA_TYPE.FUTURE;case h.MSG_TYPE.LOCATION:return this.isLive?C.default.MEDIA_TYPE.LIVE_LOCATION:C.default.MEDIA_TYPE.LOCATION;case h.MSG_TYPE.VCARD:return C.default.MEDIA_TYPE.CONTACT;case h.MSG_TYPE.MULTI_VCARD:return C.default.MEDIA_TYPE.CONTACT_ARRAY;case h.MSG_TYPE.CHAT:return this.linkPreview?C.default.MEDIA_TYPE.URL:C.default.MEDIA_TYPE.NONE;case h.MSG_TYPE.STICKER:return C.default.MEDIA_TYPE.STICKER;case h.MSG_TYPE.PRODUCT:return C.default.MEDIA_TYPE.PRODUCT_IMAGE;default:return C.default.MEDIA_TYPE.NONE}}},{key:"sendRevoke",value:function(e){var t=this;if(!j.default.supportsFeature(j.default.F.REVOKE))return Promise.reject("revoke feature unsupported");if(!this.id.fromMe)return Promise.reject("revoking received message");var i=new A.default({id:(0,N.default)(),remote:this.id.remote,fromMe:!0}),r={id:i,to:this.id.remote,t:this.t,type:h.MSG_TYPE.PROTOCOL,subtype:"revoke",protocolMessageKey:this.id,clearMedia:!!e,local:!0};return(0,V.sendMsgRecord)(Z(r)).then(function(e){if("success"===e){var r=Math.trunc(Date.now()/1e3-t.t);return new C.default.SendRevokeMessage({messageType:t.getWamMessageType(),messageMediaType:t.getWamMediaType(),revokeSendDelay:r}).commit(),t.revoke(i).then(function(){return"success"})}return Promise.reject("dropped")})}},{key:"showForwarded",value:function(){var e=w.default.fwdUiStartTs;return this.numTimesForwarded>0&&e>0&&e<this.t&&!this.isRevoked}},{key:"getForwardingScoreWhenForwarded",value:function(){if(!w.default.frequentlyForwardedMessages)return this.numTimesForwarded;var e=this.numTimesForwarded+(this.id.fromMe?0:1);return e>=w.default.frequentlyForwardedThreshold?b.default.FREQUENTLY_FORWARDED_SENTINEL:e}},{key:"getProductInfoText",value:function(){var e=this.title,t=this.description,i=this.currencyCode,r=this.priceAmount1000;e="*"+e+"*";var n=i&&r?P.default.format(i,r):null;e=e.length>b.default.MAX_REPLY_PRODUCT_TITLE_LENGTH?(0,x.firstNCodepoints)(e,b.default.MAX_REPLY_PRODUCT_TITLE_LENGTH)+"...":e,t=t&&t.length>b.default.MAX_REPLY_PRODUCT_DESC_LENGTH?(0,x.firstNCodepoints)(t,b.default.MAX_REPLY_PRODUCT_DESC_LENGTH)+"...":t;var o=void 0;return n?o=n:t&&(o=t),o?e+"\n"+o:e}},{key:"_logStorageEstimate",value:function(e){return(0,U.default)().then(function(t){t&&(e.webcBrowserStorageQuotaBytes=t.quota,e.webcBrowserStorageQuotaUsedBytes=t.usage)})}}]),t}();Q.Collection="Msg",Q.Proxy="msg",Q.idClass=A.default;var X=(0,g.defineModel)(Q);function Z(e){return new X(e)}t.default=X},cbeabehaca:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(i("jdjcgjgea")),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=u(i("cahfddcdga")),a=u(i("bdiiahhjbe")),s=u(i("jccfhaecf"));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._map={},this.length=0}return n(e,[{key:"put",value:function(t){var i=e.getSidelistHash(t);if(i&&!this._map[i]){if(this._map[i]){var r=this._map[i];r instanceof s.default?this._map[i]=[r,t.id]:r instanceof Array&&r.push(t.id)}else this._map[i]=t.id;this.length++}}},{key:"remove",value:function(t){var i=e.getSidelistHash(t);if(i&&this._map[i]){var n=(0,o.default)(this._map[i]);n instanceof s.default?delete this._map[i]:n instanceof Array&&(0,r.default)(n,function(e){return e.equals(t.id)}),this.length++}}},{key:"get",value:function(e){var t=this._map[e];return t instanceof s.default?[t]:t}},{key:"clear",value:function(){this._map={},this.length=0}}],[{key:"getSidelistHash",value:function(e){return e.isUser?"string"==typeof e.userhash&&e.userhash.slice?e.userhash.slice(0,4):(a.default.error("Store:Contact can't call slice on contact.userhash")(e.userhash),null):null}}]),e}();t.default=c},cbgifejihh:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceSentMessage=function(e,t){return new d({deviceSentMessage:new d.DeviceSentMessage({destinationJid:t.toString({legacy:!0}),message:e})})},t.createMsgProtobuf=function(e,t){var i=function(e){var t=e.id,i=e.toJSON();delete i.status,delete i.mimetype,delete i.height,delete i.width,delete i.recipients,delete i.chat,delete i.broadcast,delete i.ack,delete i.invis,delete i.filehash,delete i.recvFresh,delete i.mediaData,n.default.isHttp(e.clientUrl)||delete i.clientUrl;for(var a in i)null==i[a]&&delete i[a];"chat"!==i.type||"url"!==i.subtype||o.default.supportsFeature(o.default.F.URL)||delete i.subtype;i.quotedMsg&&!o.default.supportsFeature(o.default.F.REPLIES_OUT)&&(delete i.quotedMsg,delete i.quotedStanzaID,delete i.quotedRemoteJid,delete i.quotedParticipant);i.mentionedJidList&&!o.default.supportsFeature(o.default.F.MENTIONS_OUT)&&delete i.mentionedJidList;var s=r.default.get(t.remote);s&&(i.conversionTuple=s.toJSON());return i}(e),a=void 0;if(i.quotedMsg){var s=i.quotedMsg.mentionedJidList,u=Array.isArray(s)&&s.length>0?{mentionedJid:s.map(g)}:void 0;u&&(u=new f(u)),a={stanzaId:i.quotedStanzaID,remoteJid:g(i.quotedRemoteJid),participant:g(i.quotedParticipant),quotedMessage:p(i.quotedMsg,{duration:i.quotedMsg.duration,directPath:i.quotedMsg.directPath,encFilehash:i.quotedMsg.uploadhash,filehash:i.quotedMsg.filehash,height:i.quotedMsg.height,mediaKey:i.quotedMsg.mediaKey,mimetype:i.quotedMsg.mimetype,url:i.quotedMsg.clientUrl,width:i.quotedMsg.width},u)}}else i.quotedRemoteJid&&(a={remoteJid:g(i.quotedRemoteJid)});if(i.mentionedJidList&&i.mentionedJidList.length>0){var c=i.mentionedJidList;(a=a||{}).mentionedJid=c.map(g)}i.conversionTuple&&(a=a||{},Object.assign(a,i.conversionTuple));i.isForwarded&&((a=a||{}).isForwarded=i.isForwarded);i.forwardingScore&&((a=a||{}).forwardingScore=i.forwardingScore);a&&(a=new f(a));return p(i,t,a)},t.createMessageKey=function(e){return new h({remoteJid:g(e.to),fromMe:!0,id:e.id.id})},t.mediaTypeFromProtobuf=function e(t){if(t.deviceSentMessage){var i=t.deviceSentMessage.message;return i?e(i):null}return t.imageMessage?"image":t.stickerMessage?"sticker":t.locationMessage?"livelocation":t.contactMessage?"vcard":t.contactsArrayMessage?"contact_array":t.imageMessage?"image":t.documentMessage?"document":t.audioMessage?t.audioMessage.ptt?"ptt":"audio":t.videoMessage?t.videoMessage.gifPlayback?"gif":"video":null};var r=u(i("ccbihadedf")),n=u(i("edbaidcaf")),o=u(i("ccaaiecfib")),a=u(i("jccfhaecf")),s=i("hjbbdjjdf");function u(e){return e&&e.__esModule?e:{default:e}}var c=i("hgjcbccfg"),l=i("bgiachiigg"),d=l.Message,f=l.ContextInfo,h=i("bfifcddbbg").MessageKey;function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=new d,n=e.mimetype||t.mimetype||void 0,o=t.duration;switch(e.type){case"chat":"url"===e.subtype||e.quotedMsg||e.quotedRemoteJid||Array.isArray(e.mentionedJidList)&&e.mentionedJidList.length>0||e.conversionTuple||e.isForwarded||e.forwardingScore||e._isPaymentNoteMsg?r.extendedTextMessage=new d.ExtendedTextMessage({text:e.body,matchedText:e.matchedText,canonicalUrl:e.canonicalUrl,description:e.description,title:e.title,jpegThumbnail:y(e.thumbnail),previewType:e.richPreviewType,contextInfo:i}):r.conversation=e.body;break;case"groups_v4_invite":r.groupInviteMessage=new d.GroupInviteMessage({inviteCode:e.inviteCode,inviteExpiration:parseInt(e.inviteCodeExp,10),groupJid:e.inviteGrp,groupName:e.inviteGrpName,caption:e.comment,jpegThumbnail:y(e.inviteGrpJpegThum)});break;case"sticker":r.stickerMessage=new d.StickerMessage({url:t.url,mimetype:t.mimetype,directPath:t.directPath||void 0,fileSha256:y(t.filehash),fileEncSha256:y(t.encFilehash),mediaKey:y(t.mediaKey),fileLength:(0,s.isNumber)(e.size)?e.size:void 0,height:e.height,width:e.width,pngThumbnail:y(e.pngThumbnail),contextInfo:i});break;case"location":var a=new d.LocationMessage({degreesLatitude:parseFloat(e.lat)||void 0,degreesLongitude:parseFloat(e.lng)||void 0,jpegThumbnail:y(e.body),contextInfo:i});if(e.loc&&(0,s.isString)(e.loc)&&e.clientUrl){var u=e.loc.split("\n");a.name=u[0],a.address=u[1],a.url=e.clientUrl}r.locationMessage=a;break;case"vcard":r.contactMessage=new d.ContactMessage({displayName:e.subtype,vcard:e.body,contextInfo:i});break;case"multi_vcard":r.contactsArrayMessage=new d.ContactsArrayMessage({displayName:e.subtype,contacts:e.vcardList.map(function(e){return new d.ContactMessage(e)}),contextInfo:i});break;case"image":r.imageMessage=new d.ImageMessage({url:t.url,mimetype:n,caption:e.caption,directPath:t.directPath||void 0,fileSha256:y(t.filehash),fileEncSha256:y(t.encFilehash),height:t.height,width:t.width,fileLength:(0,s.isNumber)(e.size)?e.size:void 0,mediaKey:y(t.mediaKey),jpegThumbnail:y(e.body),contextInfo:i});break;case"product":r.productMessage=new d.ProductMessage({product:new d.ProductMessage.ProductSnapshot({productImage:new d.ImageMessage({url:t.url,mimetype:n,caption:e.caption,directPath:t.directPath||void 0,fileSha256:y(t.filehash),fileEncSha256:y(t.encFilehash),height:t.height,width:t.width,fileLength:(0,s.isNumber)(e.size)?e.size:void 0,mediaKey:y(t.mediaKey),jpegThumbnail:y(e.body)}),productId:e.productId,title:e.title,description:e.description,currencyCode:e.currencyCode,priceAmount1000:e.priceAmount1000||void 0,retailerId:e.retailerId,url:e.url,productImageCount:e.productImageCount}),businessOwnerJid:e.businessOwnerJid,contextInfo:i});break;case"document":var c=new d.DocumentMessage({url:t.url,mimetype:n,title:e.caption,directPath:t.directPath||void 0,fileSha256:y(t.filehash),fileEncSha256:y(t.encFilehash),fileName:t.filename,fileLength:(0,s.isNumber)(e.size)?e.size:void 0,mediaKey:y(t.mediaKey),jpegThumbnail:y(e.body),contextInfo:i});(0,s.isNumber)(e.pageCount)&&!isNaN(e.pageCount)&&(c.pageCount=e.pageCount),r.documentMessage=c;break;case"ptt":case"audio":o=(0,s.isString)(o)?parseInt(o,10):o,r.audioMessage=new d.AudioMessage({url:t.url,mimetype:n,directPath:t.directPath||void 0,fileSha256:y(t.filehash),fileEncSha256:y(t.encFilehash),seconds:o,ptt:"ptt"===e.type,fileLength:(0,s.isNumber)(e.size)?e.size:void 0,mediaKey:y(t.mediaKey),contextInfo:i,streamingSidecar:e.streamingSidecar});break;case"video":o=(0,s.isString)(o)?parseInt(o,10):o,r.videoMessage=new d.VideoMessage({url:t.url,mimetype:n,directPath:t.directPath||void 0,fileSha256:y(t.filehash),fileEncSha256:y(t.encFilehash),height:t.height,width:t.width,seconds:o,caption:e.caption,fileLength:(0,s.isNumber)(e.size)?e.size:void 0,mediaKey:y(t.mediaKey),jpegThumbnail:y(e.body),gifPlayback:e.isGif,gifAttribution:e.gifAttribution,contextInfo:i,streamingSidecar:e.streamingSidecar});break;case"protocol":if("revoke"===e.subtype){var l=e.protocolMessageKey;r.protocolMessage=new d.ProtocolMessage({type:d.ProtocolMessage.TYPE.REVOKE,key:new h({remoteJid:g(l.remote),fromMe:l.fromMe,id:l.id,participant:g(l.participant)})})}break;case"payment":var f={};f.stanzaId=e.quotedStanzaID,f.mentionedJid=e.mentionedJidList&&e.mentionedJidList.map(g),f.isForwarded=e.isForwarded,f.forwardingScore=e.forwardingScore,f.participant=g(e.quotedParticipant),e.quotedMsg&&(f.quotedMessage=p(e.quotedMsg));var v=e.paymentNoteMsg?p(Object.assign(e.paymentNoteMsg,{_isPaymentNoteMsg:!0}),f):void 0;switch(e.subtype){case"send":var b=e.paymentRequestMessageKey?new h({fromMe:e.paymentRequestMessageKey.fromMe,remoteJid:g(e.paymentRequestMessageKey.remote),id:e.paymentRequestMessageKey.id,participant:g(e.paymentRequestMessageKey.participant)}):void 0;r.sendPaymentMessage=new d.SendPaymentMessage({requestMessageKey:b,noteMessage:v});break;case"request":r.requestPaymentMessage=new d.RequestPaymentMessage({amount1000:e.amount1000,expiryTimestamp:e._paymentExpiryTimestamp,requestFrom:e._paymentRequestFrom,currencyCodeIso4217:e._currencyCodeIso4217,noteMessage:v})}}return r}function g(e){return e instanceof a.default?e.toString({legacy:!0}):(0,s.isString)(e)?e.replace(/@c.us$/,"@s.whatsapp.net"):void 0}function y(e){return e?c.decode(e):void 0}},ccbagdhfbb:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=y(i("chihjdheic")),n=y(i("cgjajaggch")),o=y(i("dfaadfeedd")),a=y(i("bhehgiigij")),s=y(i("dbafiicfja"));t.typeIsMMS=function(e,t){if((0,g.shouldEnableHsm)()&&"template"===e)return"text"!==t;return v[e]||!1},t.msgMatchesType=function(e,t){switch(t){case"text":return e.type===u.default.MSG_TYPE.CHAT&&"url"!==e.subtype;case"image":return e.type===u.default.MSG_TYPE.IMAGE;case"video":return e.type===u.default.MSG_TYPE.VIDEO&&!e.isGif;case"gif":return e.type===u.default.MSG_TYPE.VIDEO&&e.isGif;case"audio":return e.type===u.default.MSG_TYPE.AUDIO;case"ptt":return e.type===u.default.MSG_TYPE.PTT;case"document":return e.type===u.default.MSG_TYPE.DOCUMENT;case"location":return e.type===u.default.MSG_TYPE.LOCATION;case"vcard":return e.type===u.default.MSG_TYPE.VCARD||e.type===u.default.MSG_TYPE.MULTI_VCARD;case"url":return e.type===u.default.MSG_TYPE.CHAT&&"url"===e.subtype;case"sticker":return e.type===u.default.MSG_TYPE.STICKER;case"template":return!!(0,g.shouldEnableHsm)()&&e.type===u.default.MSG_TYPE.TEMPLATE;case void 0:default:return!1}},t.createQuotedMsg=function(e){if(!e)return null;var t=new d.default({from:e.from,to:e.to,id:e.id,participant:e.participant,selfDir:e.self});return e.id=t,new f.default.Msg.constructor.model(e)},t.getOriginalQuotedMsgIfPossible=function(e,t){if(!e)return e;var i=t.get(e.id);return i&&!i.isRevoked?i:e},t.getBroadcastFanoutKeys=b,t.broadcastFanout=function(e){var t=void 0;if(!e.invis){var i=b(e);i&&(t=i.map(function(e){return e.remote}),i.forEach(function(t){if(!f.default.Msg.some((0,a.default)({id:t}))){var i=m(e);i.to=t.remote,i.id=t,i.broadcast=!0;var r=f.default.Msg.add(i,{merge:!0});f.default.Chat.find(t.remote).then(function(e){_(r,e,!0)})}}))}return t},t.addRecordsToChat=_;var u=y(i("eadfaddcj")),c=y(i("eecdaegci")),l=y(i("bdiiahhjbe")),d=y(i("ccgjijjbbj")),f=y(i("bhggeigghg")),h=y(i("jccfhaecf")),p=i("cefjgcjhgf"),g=i("beadfddidc");function y(e){return e&&e.__esModule?e:{default:e}}var v={image:!0,video:!0,audio:!0,ptt:!0,sticker:!0,document:!0,product:!0,template:!1};function b(e){var t=void 0,i=void 0,r=void 0;if(e instanceof f.default.Msg.constructor.model)i=e,r=e.id;else{if(!(e instanceof d.default))return void l.default.error("model:msgs:broadcastFanout: unknown msgOrKey: "+String(e))(e);r=e}if(!h.default.isStatusV3(r.remote)){if(i&&i.recipients&&0!==i.recipients.length)t=i.recipients;else{var n=f.default.GroupMetadata.get(r.remote);n?t=(0,s.default)(m(n.participants),"id"):l.default.log("model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: "+r.remote.toString())()}return t?t.map(function(e){return new d.default({fromMe:r.fromMe,remote:e,id:r.id})}):void 0}}function _(e,t,a,s,u,c){var d=s||t.msgs;if(0!==e.length){var h=d===t.msgs;if(c)if(h){l.default.info("models:msg:store:resetMostRecentMsgs .msgs === cmc !")();var g=(0,o.default)(e,function(e){return!!e});g&&(0,p.setLastReceivedKey)(t.id,g.id).then(function(){t.lastReceivedKey=g.id,d.add(e)})}else{h=!0;var y=(0,o.default)(e,function(e){return!!e}),v=Promise.resolve();y&&(v=(0,p.setLastReceivedKey)(t.id,y.id).then(function(){t.lastReceivedKey=y.id,d.add(e)})),v.then(function(){var e=new(0,i("dbfjecijha").default);e.replace(t.msgs),t.msgChunks.push(e),t.replaceMsgsCollection(d),t.msgs.trigger("change:last",t.msgs.last())})}else if(a){var b=Promise.resolve();if(h){var _=(0,o.default)(e,function(e){return!!e});_&&(b=(0,p.setLastReceivedKey)(t.id,_.id).then(function(){t.lastReceivedKey=_.id}))}b.then(function(){d.add(e)})}else d.add(e,{at:0,silent:(0,n.default)(e,O)});if(a&&h||!f.default.Msg.lastReceivedReceipt[t.id])for(var m=e.length-1;m>=0;m--){var P=e[m],E=P.id;if(E.fromMe&&!P.isNotification){f.default.Msg.updateLastReceipt(E.remote,P.t);break}}if(a&&h||!f.default.Msg.lastReceivedPaymentTransaction[t.id])for(var j=e.length-1;j>=0;j--){var T=e[j],M=T.id;T.paymentTransactionTimestamp&&f.default.Msg.updateLastTransactionTime(M.remote,T.paymentTransactionTimestamp)}var S=u;S&&!t.unreadMsgAnchor&&(t.disableUnreadAnchor?t.disableUnreadAnchor=!1:t.unreadMsgAnchor=(0,r.default)(e,function(e){return e.id.toString()===S.toString()}))}}function m(e){return null!=e&&"object"==typeof e?JSON.parse(JSON.stringify(e),c.default):e}function O(e){return"i"===e.eventType}},ccbihadedf:function(e,t,i){"use strict";var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i("dbbaabdabi"),o=l(n),a=l(i("bjebjijbfc")),s=i("cgcgbfbffj"),u=l(s),c=i("cjbafegbjg");function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),r(t,[{key:"initializeFromCache",value:function(e){if(e){var t=a.default.globalUnixTime()-n.ConversionTupleExpiry,i=e.filter(function(e){return e.timestamp-t>0}).map(function(e){var t=(0,c.parseConversionData)(e.conversionData);return t?e.conversionData=t:delete e.conversionData,e});this.add(i),this.saveToCache()}}}]),t}();d.model=o.default,d.cachePolicy={id:"conversion_tuple",policy:s.CACHE_POLICY.LOAD,delay:1e3},e.exports=new d},ccdbdjihjh:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=i("dcaifjegcg"),o=(r=n)&&r.__esModule?r:{default:r};function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),u=0;u<o;u++)s[u]=arguments[u];return i=r=a(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.id=(0,n.prop)(),r.callId=(0,n.prop)(),r.isIncoming=(0,n.prop)(!1),r.isRinging=(0,n.prop)(!1),r.isInterrupted=(0,n.prop)(!1),r.isMuted=(0,n.prop)(!1),r.isTrafficStopped=(0,n.prop)(!1),r.isInvitingToGroupCall=(0,n.prop)(!1),r.isVideoStopped=(0,n.prop)(!1),r.isVideoPaused=(0,n.prop)(!1),r.isVideoDecodePaused=(0,n.prop)(!1),r.isVideoDecodeStarted=(0,n.prop)(!1),r.isOfferingVideoUpgrade=(0,n.prop)(!1),a(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),t}();s.Proxy="callParticipant",t.default=(0,n.defineModel)(s)},ccehadbeci:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=h(i("ddgaeajhag")),n=h(i("cfadahgeie")),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},s=i("dcaifjegcg"),u=h(s),c=h(i("dbfjecijha")),l=h(i("bdiiahhjbe")),d=h(i("hciaejfjd")),f=h(i("bjigbaghc"));function h(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var g=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=p(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,s.prop)(),r.pendingMsgs=(0,s.prop)(),r.labels=(0,s.prop)(),r.msgChunks=(0,s.session)(function(){return[]}),r.lastReceivedKey=(0,s.session)(),r.unreadMsgAnchor=(0,s.session)(),r.disableUnreadAnchor=(0,s.session)(),r.msgsLength=(0,s.session)(),r.msgsChanged=(0,s.session)(0),r.msgs=(0,s.collection)(c.default),p(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),o(t,[{key:"initialize",value:function(){var e=this;a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.listenTo(this.msgs,"change:last",function(){e.msgsChanged++}),this.listenTo(this.msgs,"add remove bulk_add",function(){e.msgsChanged++,e.msgsLength=e.msgs.length}),f.default.isSMB&&(this.addLabelsToCollection(),this.listenTo(this,"change:labels",this.addLabelsToCollection))}},{key:"addLabelsToCollection",value:function(){(0,d.default)(this.id.toString(),this.labels,"Chat")}},{key:"onEmptyMRM",value:function(){throw new Error("onEmptyMRM not implemented")}},{key:"delete",value:function(){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.getAllCMCs().forEach(function(e){e.forEach(function(e){e.delete()}),e.delete()})}},{key:"removeMsg",value:function(e){var t=e.msgChunk;t&&(t.indexOf(e)<0||(l.default.log("models:Chat:removeMsg "+e.get("id"))(),t.remove(e),0===t.length&&(t===this.msgs?this.onEmptyMRM():this.removeMsgsCollection(t))))}},{key:"getAllCMCs",value:function(){return this.msgChunks.concat([this.msgs])}},{key:"getAllMsgs",value:function(){return(0,n.default)(this.getAllCMCs().map(function(e){return e.getModelsArray()}))}},{key:"replaceMsgsCollection",value:function(e){l.default.info("model:Chat:replaceMsgsCollection:"+this.id.toString())();var t={msg:e.last()};this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs,t),this.msgChunks=(0,r.default)(this.msgChunks,e),e.delete()}},{key:"removeMsgsCollection",value:function(e){this.msgChunks=(0,r.default)(this.msgChunks,e),e.delete()}},{key:"notifyMsgCollectionMerge",value:function(e,t,i,r){this.trigger("change:cmc:merge",e,t,i,r)}}]),t}();t.default=g},ccfcjccjbg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=j(i("cjjebecgeb")),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},a=j(i("hciaejfjd")),s=j(i("bgfcjjddjf")),u=i("dcaifjegcg"),c=j(u),l=j(i("bjigbaghc")),d=i("ccicaaeiaa"),f=j(i("eadfaddcj")),h=j(i("ccaaiecfib")),p=j(i("fffdgbfji")),g=j(i("bdiiahhjbe")),y=j(i("edjgaiicj")),v=j(i("dhefcajhhb")),b=j(i("gbbacfeci")),_=j(i("bhggeigghg")),m=j(i("jccfhaecf")),O=j(i("djbfhebjhe")),P=i("dfbbghiidh"),E=j(i("djjeigcdbe"));function j(e){return e&&e.__esModule?e:{default:e}}function T(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var M=/^[^0-9]+$/,S=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=T(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,u.prop)(),r.name=(0,u.prop)(),r.shortName=(0,u.prop)(),r.pushname=(0,u.prop)(),r.type=(0,u.prop)("in"),r.verifiedName=(0,u.prop)(),r.isBusiness=(0,u.prop)(),r.isEnterprise=(0,u.prop)(),r.verifiedLevel=(0,u.prop)(),r.statusMute=(0,u.prop)(),r.sectionHeader=(0,u.prop)(),r.labels=(0,u.prop)(),r.isContactBlocked=(0,u.session)(!1),r.verificationString=(0,u.session)(),r.verificationBinary=(0,u.session)(),r.pendingAction=(0,u.session)(),r._notifyName=(0,u.session)(null),r.promises=(0,u.session)(function(){return{}}),r.status=(0,u.session)(),r.profilePicThumb=(0,u.session)(),r.businessProfile=(0,u.session)(),r.commonGroups=(0,u.session)(),r.liveLocations=(0,u.session)(),r.businessCatalog=(0,u.session)(),r.notifyName=(0,u.derived)(r._notifyNameFunction,["_notifyName","pushname","isBusiness","verifiedLevel","verifiedName"]),r.mentionName=(0,u.derived)(r._mentionName,["isMyContact","isBusiness","verifiedLevel","name","notifyName"]),r.displayName=(0,u.derived)(r._displayName,["id","mentionName","isMe"]),r.userid=(0,u.derived)(r._userid),r.userhash=(0,u.derived)(r._userhash),r.searchName=(0,u.derived)(r._searchName,["name","id"]),r.searchVerifiedName=(0,u.derived)(r._searchVerifiedName,["verifiedLevel","verifiedName"]),r.header=(0,u.derived)(r._header,["name"]),r.isMe=(0,u.derived)(r._isMe),r.isUser=(0,u.derived)(r._isUser),r.isGroup=(0,u.derived)(r._isGroup),r.isBroadcast=(0,u.derived)(r._isBroadcast),r.isPSA=(0,u.derived)(r._isPSA),r.formattedShortNameWithNonBreakingSpaces=(0,u.derived)(r._formattedShortNameWithNonBreakingSpaces,["shortName","formattedName","id"]),r.formattedShortName=(0,u.derived)(r._formattedShortName,["shortName","formattedName","id"]),r.formattedName=(0,u.derived)(r._formattedName,["name","id"]),r.formattedUser=(0,u.derived)(r._formattedUser,["name","id"]),r.isWAContact=(0,u.derived)(r._isWAContact,["type"]),r.isMyContact=(0,u.derived)(r._isMyContact,["name"]),r.showBusinessCheckmark=(0,u.derived)(r._showBusinessCheckmark,["isBusiness","verifiedLevel","name","verifiedName"]),r.showBusinessVname=(0,u.derived)(r._showBusinessVname,["isBusiness","verifiedLevel","name","verifiedName"]),T(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.default),n(t,[{key:"_notifyNameFunction",value:function(){return this.isBusiness&&this.verifiedLevel!==f.default.VERIFIED_LEVEL.HIGH?this.verifiedName:h.default.supportsFeature(h.default.F.CONTACT_HAS_PUSHNAME)?this.pushname:this._notifyName?this._notifyName.name:void 0}},{key:"_mentionName",value:function(){return!this.isMyContact&&this.isBusiness&&this.verifiedLevel!==f.default.VERIFIED_LEVEL.HIGH?null:this.name||this.notifyName}},{key:"_displayName",value:function(){return this.isMe?l.default.pushname:this.mentionName||(0,O.default)(this.id)}},{key:"_userid",value:function(){return this.isUser?m.default.user(this.id):null}},{key:"_userhash",value:function(){return this.isUser?(0,y.default)((this.id.user||"")+"WA_ADD_NOTIF"):null}},{key:"_searchName",value:function(){return m.default.isPSA(this.id)?p.default.accentFold(p.default.t("whatsapp_psa_contact_name")):this.name?p.default.accentFold(this.name):null}},{key:"_searchVerifiedName",value:function(){return this.verifiedLevel!==f.default.VERIFIED_LEVEL.HIGH?null:this.verifiedName?p.default.accentFold(this.verifiedName):null}},{key:"_header",value:function(){if(this.name){var e=this.name.toLowerCase(),t=E.default.exec(e);if(t&&0===t.index||t&&M.test(e.slice(t.index))){var i=t[0],r=p.default.removeAccents(i);return(0,d.getCollator)().compare(r,i)?i:r}return"#"}}},{key:"_isMe",value:function(){return this.id.equals(l.default.me)}},{key:"_isUser",value:function(){return m.default.isUser(this.id)}},{key:"_isGroup",value:function(){return m.default.isGroup(this.id)}},{key:"_isBroadcast",value:function(){return m.default.isBroadcast(this.id)}},{key:"_isPSA",value:function(){return m.default.isPSA(this.id)}},{key:"_formattedShortNameWithNonBreakingSpaces",value:function(){return this.id?this.isMe?p.default.t("web_you"):this.shortName||this.formattedName&&this.formattedName.replace(/\s/g," "):""}},{key:"_formattedShortName",value:function(){return this.id?this.isMe?p.default.t("web_you"):this.shortName||this.formattedName:""}},{key:"_formattedName",value:function(){if(!this.id)return"";if(this.isMe)return p.default.t("web_you");if(m.default.isPSA(this.id))return p.default.t("whatsapp_psa_contact_name");var e=void 0;return!this.name&&this.isUser&&(e=(0,O.default)(this.id)),this.name||e}},{key:"_formattedUser",value:function(){return this.getFormattedUser()}},{key:"_isWAContact",value:function(){return this.isUser&&"in"===this.type}},{key:"_isMyContact",value:function(){return!!(this.isUser&&this.name&&this.name.length)}},{key:"_showBusinessCheckmark",value:function(){return this.isBusiness&&this.verifiedLevel===f.default.VERIFIED_LEVEL.HIGH&&this.name===this.verifiedName}},{key:"_showBusinessVname",value:function(){return this.isBusiness&&this.verifiedLevel===f.default.VERIFIED_LEVEL.HIGH&&this.name!==this.verifiedName}},{key:"initialize",value:function(){var e=this;o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.id&&(this.isMe&&this.addChild("status",b.default.gadd(this.id)),this.isMe&&this.addChild("profilePicThumb",v.default.gadd(this.id)),this.isBusiness&&this.addChild("businessProfile",_.default.BusinessProfile.gadd(this.id)),this.listenTo(this,"change:isBusiness",function(){return(0,P.onIsBusinessChange)(e)}),this.isContactBlocked=!!s.default.get(this.id),this.pendingAction=0,l.default.isSMB&&(this.addLabelsToCollection(),this.listenTo(this,"change:labels",this.addLabelsToCollection)))}},{key:"getStatus",value:function(){return m.default.user(this.id)||g.default.info("contact:getStatus for non-user "+this.id.toString())(),this.status=b.default.gadd(this.id)}},{key:"addLabelsToCollection",value:function(){(0,a.default)(this.id.toString(),this.labels,"Contact")}},{key:"getProfilePicThumb",value:function(){return this.profilePicThumb=v.default.gadd(this.id)}},{key:"addPendingAction",value:function(e){var t=this;if(e.isPending()){var i=function(){t.decPending()};e.then(i,i),this.pendingAction++}return e}},{key:"decPending",value:function(){this.pendingAction>0?this.pendingAction--:(g.default.log("contact:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)}},{key:"isBlocked",value:function(){return!!s.default.get(this.id)}},{key:"searchMatch",value:function(e,t,i){return h.default.supportsFeature(h.default.F.LABELS_DISPLAY)&&i?!(e&&this.searchName&&!this.searchName.includes(e))&&(0,r.default)(this.labels,i):!!e&&(!(!this.searchName||!this.searchName.includes(e))||(!(!this.userid||!this.userid.includes(e))||(!!(t&&this.userid&&this.userid.includes(t))||(!(!this.searchVerifiedName||!this.searchVerifiedName.includes(e))||!(!this.pushname||!p.default.accentFold(this.pushname).includes(e))))))}},{key:"getFormattedUser",value:function(){return this.id?m.default.isPSA(this.id)?p.default.t("whatsapp_psa_contact_name"):this.name?this.name:p.default.isRTL()?p.default.embedLTR((0,O.default)(this.id)):(0,O.default)(this.id):""}},{key:"set",value:function(e,i,r){var n=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e,i,r);if("string"!=typeof e&&i&&i.merge&&n){if(n.isPSA)return n;!e.name&&n.name&&(n.unset("name"),n.unset("shortName")),!e.verifiedName&&n.verifiedName&&n.unset("verifiedName")}return n}}]),t}();S.Collection="Contact",S.Proxy="contact",S.idClass=m.default,t.default=(0,u.defineModel)(S)},ccicaaeiaa:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var i=e.id.toString(),r=t.id.toString();if(i===o.default.me.toString())return 1;if(r===o.default.me.toString())return-1;var n=e.name,a=t.name;if(!n&&a)return 1;if(n&&!a)return-1;if(n&&a&&e.header&&t.header){var u=s.compare(e.header,t.header);return 0===u?s.compare(n,a):u}return i&&r?i.localeCompare(r):-1},t.getCollator=function(){return s};var r=a(i("eadfaddcj")),n=a(i("gbfffciea")),o=a(i("bjigbaghc"));function a(e){return e&&e.__esModule?e:{default:e}}var s=void 0;function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.default.L10N.DEFAULT;if(window.Intl&&window.Intl.Collator){var t=window.Intl.Collator([e],{sensitivity:"base"});s={compare:function(e,i){try{return t.compare(e,i)}catch(e){return 0}}}}else s={compare:function(e,t){return e.localeCompare(t)}}}u(),n.default.on("set_locale",u)},ccijeahddj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadCollections=function(){Object.assign(r.default,n.default)};var r=o(i("bhggeigghg")),n=o(i("cjedbbhjhh"));function o(e){return e&&e.__esModule?e:{default:e}}},cdaedfafjc:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPack=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i("dcaifjegcg"),o=c(n),a=c(i("cgejbjhjej")),s=i("daichdjff"),u=c(i("bffjfbgbg"));function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d="placeholder:",f="image/png",h=t.StickerPack=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),u=0;u<o;u++)a[u]=arguments[u];return i=r=l(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,n.prop)(),r.index=(0,n.prop)(),r.name=(0,n.prop)(),r.page=(0,n.prop)(),r.url=(0,n.prop)(),r.mimetype=(0,n.prop)(f),r.mediaData=(0,n.session)(),r._mediaObject=(0,n.prop)(),r.directPath=(0,n.prop)(),r.filehash=(0,n.prop)(),r.mediaKey=(0,n.prop)(),r.size=(0,n.prop)(),r.type=(0,n.prop)(s.OUTWARD_TYPES.STICKER_PACK),r.uploadhash=(0,n.prop)(),r.clientUrl=(0,n.derived)(r._clientUrl,["url","isFirstParty"]),r.stickers=(0,n.derived)(r._getStickersCollection,["id"]),r.isPlaceholder=(0,n.derived)(r._isPlaceholder,["id"]),r.isFirstParty=(0,n.derived)(r._isFirstParty,["url","mediaKey"]),l(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"_clientUrl",value:function(){return this.isFirstParty?"":this.url}},{key:"_isPlaceholder",value:function(){return t.isPlaceholderId(this.id)}},{key:"_isFirstParty",value:function(){return Boolean(this.url)&&!this.mediaKey}},{key:"_getStickersCollection",value:function(){return this._stickers=this._stickers||new a.default(this.id.split("#")[0]),this._stickers}},{key:"initialize",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.isPlaceholder||this.isFirstParty||(this.addChild("mediaData",new u.default({renderableUrl:""})),i("ddgbhifaji").registerStickerPackIcon(this))}},{key:"downloadMedia",value:function(){this.isPlaceholder||this.isFirstParty||i("ddgbhifaji").downloadStickerOrStickerPackIcon(this)}}]),t}();h.Proxy="stickerPack",h.createPlaceholder=g,h.isPlaceholderId=function(e){return new RegExp("^"+d).test(e)};var p=(0,n.defineModel)(h);function g(e){var t=e.index,i=e.page;return new p({id:""+d+t,index:t,page:i})}t.default=p,p.createPlaceholder=g,p.isPlaceholderId=h.isPlaceholderId},cdbfiiicdg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=i("bdfbccfifg"),o=(r=n)&&r.__esModule?r:{default:r};var a=function(e){function t(e,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.id))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),t}();a.policy=n.CACHE_POLICY_TYPE.NONE,t.default=a},cdcijfdgje:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=g(i("eadfaddcj")),a=g(i("bjebjijbfc")),s=g(i("dhigahgdjb")),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),c=g(i("bieicghjif")),l=g(i("bdiiahhjbe")),d=g(i("cgcgbfbffj")),f=g(i("jccfhaecf")),h=g(i("chajfbfiga")),p=i("hjbbdjjdf");function g(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d.default),n(t,[{key:"_find",value:function(e){var t=this;return f.default.isUser(e)||f.default.isGroup(e)?h.default.subscribeLiveLocation(e,!0).then(function(i){if(i.status&&i.status>=400)return 499===i.status?l.default.log("liveLocation:subscribe query not implemented on the phone")():l.default.error("model:LiveLocation:_find error "+i.status)(),Promise.reject(i.status);var n=(0,p.isNumber)(i.duration)?i.duration:void 0,o=i.participants?i.participants.map(function(e){return r({},t._extractLocationFields(e),{id:e.id,expiration:0===e.expiration?1/0:e.expiration})}):[];return{id:e,duration:n,participants:o}}):Promise.reject(new Error("invalid wid for live location: "+e))}},{key:"getActive",value:function(e){var t=this;return f.default.isUser(e)||f.default.isGroup(e)?h.default.queryActiveLiveLocation(e).then(function(i){if(i.status&&i.status>=400)return 499===i.status?l.default.log("liveLocation:participant query not implemented on the phone")():l.default.error("model:LiveLocation:getActive error "+i.status)(),Promise.reject(i.status);if(i.participants&&i.participants.length){var r=i.participants.map(function(e){return{id:e.id,expiration:0===e.expiration?1/0:e.expiration}});t.add({id:e,participants:r},{merge:!0})}}).catch(u.WapDrop,function(){}):Promise.reject(new Error("invalid wid for live location: "+e))}},{key:"onResume",value:function(){this.filter(function(e){return e.active&&e.hasParticipants()}).forEach(function(e){e.update()})}},{key:"handle",value:function(e){var t=this;Array.isArray(e)?e.forEach(function(e){switch(e.type){case"update":var i=t._extractLocationFields(e),r=s.default.get(e.jid);r&&r.liveLocations&&r.liveLocations.forEach(function(e){return e.set(i)});break;case"disable":var n=t.get(e.chat);if(n){var o=n.participants.get(e.jid);o&&(e.seq>o.sequence||-1===e.seq)&&o.disable()}break;default:l.default.error("models:liveLocation:handle unknown type: "+e.type)(e)}}):l.default.error("models:liveLocation:handle unrecognized payload")(e)}},{key:"processMsg",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l.default.assert(e.type===o.default.MSG_TYPE.LOCATION&&e.isLive,"collection:liveLocation trying to process non live-location msg")();var i=e.id.remote,r=e.lat,n=e.lng,s=e.accuracy,u=e.speed,c=e.degrees,d=e.sequence,f=e.comment,h=e.shareDuration,p=e.t;if(p&&h){var g=p+h;if(!(g<=a.default.globalUnixTime())){var y={id:e.sender,lat:r,lng:n,accuracy:s,speed:u,degrees:c,sequence:d,comment:f,expiration:g,lastUpdated:p,msg:e};-1===d&&delete y.sequence;var v=this.get(i);if(v){var b=v.participants.get(y.id);if(t)return void(b&&b.lastUpdated<=y.lastUpdated&&b.set(y));if(b&&v.participants.removeParticipant(b),v.hasParticipants())return void v.participants.add(y)}this.add({id:i,participants:[y]})}}}},{key:"removeMsg",value:function(e){l.default.assert(e.type===o.default.MSG_TYPE.LOCATION&&e.isLive,"collection:liveLocation trying to remove non live-location msg")();var t=e.id.remote,i=e.sender,r=this.get(t);r&&r.participants.remove(i)}},{key:"_extractLocationFields",value:function(e){return void 0===e.lat||void 0===e.lng?{}:{lastUpdated:a.default.globalUnixTime()-e.elapsed,lat:e.lat,lng:e.lng,accuracy:e.accuracy,speed:e.speed,degrees:e.degrees,comment:e.comment}}}]),t}();y.model=c.default,y.staleCollection=!0,y.resumeOnAvailable=!0,t.default=new y},ceidcegjgi:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyStates=void 0;var r,n=i("bdiiahhjbe"),o=(r=n)&&r.__esModule?r:{default:r};var a=t.ProxyStates={};t.default=function(e,t,i){var r=t.props,n=t.session,s=t.collections,u=t.derived,c=function(e,t){var i={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=e[r]);return i}(t,["props","session","collections","derived"]);function l(e){this._ProxyState$state=e}var d={};[r,n,s,u].forEach(function(e){e&&Object.keys(e).forEach(function(e){d[e]={get:function(){return o.default.assert(!1,"Invalid ProxyState Access",'Cannot read proxy property "'+e+'" created in <'+this._ProxyState$ComponentName+"/>. Make sure it is whitelisted in your list of concerns.")(),this._ProxyState$state[e]},set:function(t){o.default.assert(!1,"Invalid ProxyState Write",'Cannot write proxy property "'+e+'" created in <'+this._ProxyState$ComponentName+"/>. Make sure it is whitelisted in your list of concerns.")(),this._ProxyState$state[e]=t}}})}),d.mirrorMask={value:i},d.isProxyOf={value:function(e){return this._ProxyState$state===e}},["set","get"].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(Object.keys(c))).forEach(function(e){d[e]={value:function(){var t=this._ProxyState$state;return t[e].apply(t,arguments)}}}),l.prototype=Object.create(null,d),l.prototype.constructor=l,a[e]=l}},cgcgbfbffj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CACHE_POLICY=void 0;var r=j(i("cifjgjcead")),n=j(i("bjcdbcecjd")),o=j(i("jcfacighg")),a=j(i("cbjgdhddc")),s=j(i("cgjajaggch")),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},c=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),l=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},d=E(i("dfhjacfbjg")),f=j(i("bjigbaghc")),h=E(i("cajijabhgb")),p=j(i("bdiiahhjbe")),g=i("eacidghfgh"),y=j(g),v=j(i("dcdiaahjj")),b=j(i("fcedgihic")),_=j(i("egjjcjcg")),m=i("hjbbdjjdf"),O=j(i("bhggeigghg")),P=i("dbjfahieed");function E(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function j(e){return e&&e.__esModule?e:{default:e}}var T="QUERY",M="FIND",S="UPDATE";t.CACHE_POLICY=P.CACHE_POLICY_TYPE;var C=(new Object).toString(),w={id:"none",policy:P.CACHE_POLICY_TYPE.NONE},k=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._inflight={},e._cachePolicy=(0,P.createCachePolicy)(e,e.constructor.cachePolicy||w),e._staleCollection=e.constructor.staleCollection||!1,e._resumeOnAvailable=e.constructor.resumeOnAvailable||!1,(!0===e._staleCollection||(0,m.isFunction)(e.onResume))&&(e.listenTo(y.default,"change:stream",e._handleStreamChange),e.listenTo(y.default,"didResume",e._onResume),e._resumeOnAvailable&&e.listenTo(v.default,"change:available",function(){v.default.available&&e._needsUpdate&&e._onResume()})),e._cachePolicy.enableCaching(),e._cachePolicy.constructor.policy===P.CACHE_POLICY_TYPE.LOAD&&e.listenTo(f.default,"change:me",e._updateFromCache),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,b.default),c(t,[{key:"initializeFromCache",value:function(e){this.add(e)}},{key:"saveToCache",value:function(){if(f.default.me){var e=this._cachePolicy.id;p.default.log("baseCollection:saveToCache save: "+String(e))(),_.default.setCollection(e,this.toJSON(),this._cachePolicy.constructor.policy===P.CACHE_POLICY_TYPE.IMMEDIATE)}}},{key:"add",value:function(e,i){var r=this;if(e){if(f.default.blockStoreAdds)throw new h.LogoutDrop("adding to store when blocking store adds");var n=Array.isArray(e)?e:[e];if((0,s.default)(n,function(e){return e&&e.isState})){var o=(0,a.default)(n,function(e){return r.get(e.id)});return o.length&&l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,o,i),n}}return l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e,i)}},{key:"findQuery",value:function(e,t){return this._query(T,e,t)}},{key:"find",value:function(e,t){return e?this._query(M,e,t):(d.upload(p.default.trace("Called find without an id")),Promise.reject("called find without an id"))}},{key:"update",value:function(e,t){return e?this._query(S,e,t):(d.upload(p.default.trace("Called update without an id")),Promise.reject("called update without an id"))}},{key:"handle",value:function(e){var t=this._handle(e.shift());if(this._staleCollection){var i=Array.isArray(t)?t:[t];(0,o.default)(i).forEach(function(e){e.stale=!1})}this.add(t,{merge:!0})}},{key:"gadd",value:function(e,t){if(this._model.prototype.isIdType(e)){var i=this.get(e);if(i)return i;var r={id:e};return this.add(r,t)[0]}if(e&&e.id){var o=t||{};return o.merge=!0,this.add(e,o)[0]}var a=(0,n.default)(O.default,this)||"unknown";throw new Error(a+".gadd called without an id attr (id)")}},{key:"gaddUp",value:function(e){var t=void 0,i=this._staleCollection;if(this._model.prototype.isIdType(e)){var r={stale:i,id:e};t=this.get(e)||this.add(r,{merge:!0})[0]}else e&&e.id&&(this.get(e.id)&&(i=!1),e=u({stale:i},e),t=this.add(e,{merge:!0})[0]);if(t)return t.stale&&this.find(t.id).catch(h.WapDrop,function(){}),t;var o=(0,n.default)(O.default,this)||"unknown";throw new Error(o+".gadd called without an id attr (id)")}},{key:"delete",value:function(){this._inflight={},this.reset()}},{key:"isStateStale",value:function(e){var t=this.get(e);return!!t&&t.stale}},{key:"_handleResume",value:function(){switch(y.default.stream){case g.STREAM.DISCONNECTED:if(!this._staleCollection)return;this.forEach(function(e){e&&(e.stale=!0)});break;case g.STREAM.RESUMING:case g.STREAM.SYNCING:case g.STREAM.CONNECTED:}}},{key:"_onResume",value:function(){(0,m.isFunction)(this.onResume)&&(this._resumeOnAvailable&&!v.default.available?this._needsUpdate=!0:(this.onResume(),this._needsUpdate=!1))}},{key:"_query",value:function(e,t,i){var n=this,o=(0,m.isString)(t)?t:t.toString();o===C&&(o=(0,r.default)("collection_query_"));var a=e===T?void 0:this.get(t),s="force-"+o;if((this._inflight[s]&&e===M||e===S)&&(o=s),this._inflight[o])return e===M&&a&&!a.stale?Promise.resolve(a):this._inflight[o];if(!a||a&&a.stale||e===S){var u=this._inflight[o]=this._serverQuery(e,t,i).finally(function(){delete n._inflight[o]});return u.catch(h.WapDrop,function(e){p.default.warn(e.toString())()}).catch(function(){}),u.catch(m.isString,function(e){p.default.log("baseCollection:query query promise rejected: "+String(e))()})}return Promise.resolve(a)}},{key:"_serverQuery",value:function(e,t,i){var r=this,n=void 0;if(e===S)n=this._update(t);else if(e===M)n=this._find(t);else{var a=i&&i.logOnSend;n=this._findQuery(t,a)}return n.then(function(e){if(r._staleCollection){var t=Array.isArray(e)?e:[e];(0,o.default)(t).forEach(function(e){void 0===e.stale&&(e.stale=!1)})}var n=void 0;if(n=i&&i.set?r.set(e):r.add(e,{merge:!0}),Array.isArray(e))return n;if(n[0])return n[0];throw new h.ModelCreateError(r._model.prototype.Collection,e)})}},{key:"_update",value:function(e){return this._find(e)}},{key:"_handleStreamChange",value:function(){this._handleResume(),this._cachePolicy.constructor.policy===P.CACHE_POLICY_TYPE.LOAD&&this._updateFromCache()}},{key:"_updateFromCache",value:function(){var e=this._cachePolicy.id;this._cachePolicy.disableCaching(),f.default.me&&(p.default.log("baseCollection:initFromCache load: "+String(e))(),this.initializeFromCache(_.default.getCollection(e)),this._cachePolicy.enableCaching())}}]),t}();t.default=k},cgejbjhjej:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FETCH_STATE=void 0;var r=u(i("ccjgiajgj")),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=i("dhjffabgfb");Object.defineProperty(t,"FETCH_STATE",{enumerable:!0,get:function(){return a.FETCH_STATE}});var s=u(i("chajfbfiga"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i._parseStickersRes=function(e){if(200!==e.status||!e.data)throw new Error("sticker pack stickers query error");return e.data.map(function(e,t){return n({},(0,r.default)(e,["directPath","mimetype","mediaKey","filehash","width","height"]),{index:t,id:e.filehash,clientUrl:e.url,uploadhash:e.encFilehash})})},i.stickerPackId=e;var o=t._cache[i.stickerPackId];if(o)return c(i,o);var a=void 0,s=i;return Object.defineProperty(i,"fetchState",{get:function(){return a},set:function(e){a!==e&&(a=e,s.trigger("change:fetchState",e))}}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.StickerCollection),o(t,[{key:"fetch",value:function(e){var t=this;return e&&this.fetchState!==a.FETCH_STATE.PENDING&&delete this._fetchPromise,this._fetchPromise?this._fetchPromise:(this.fetchState=a.FETCH_STATE.PENDING,i("cdaedfafjc").default.isPlaceholderId(this.stickerPackId)?(this._fetchPromise=new Promise(function(){}),this._fetchPromise):(this._fetchPromise=s.default.queryStickersInStickerPack(this.stickerPackId).then(this._parseStickersRes).then(function(e){var i=Math.max(t.length||e.length);t._resetRange(0,i,e),t.fetchState=a.FETCH_STATE.SUCCESS}).catch(function(e){t.fetchState=a.FETCH_STATE.ERROR}),this._fetchPromise))}},{key:"_resetRange",value:function(e,t,i){var r=this;this._forEachInRange(e,t,function(t,n){var o=i[n-e];t?o?t.id===o.id?t.set(o):(r.remove(t),r.add(o)):r.remove(t):o&&r.add(o)})}},{key:"_forEachInRange",value:function(e,t,i){for(var r=e;r<t;r++){i(this.at(r),r)}}}]),t}();l._cache={},l.comparator=function(e,t){return e.index<t.index?-1:e.index>t.index?1:0},t.default=l},cgfdiahhcd:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(i("eaaagccfda")),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i("bdfbccfifg"),a=s(o);function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.id));return n._trigger=i.trigger||"all",n._delay=i.delay,n._saveToCache=(0,r.default)(n.saveToCache,n._delay),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"saveToCache",value:function(){this.collection.saveToCache()}},{key:"enableCaching",value:function(){this.listenTo(this.collection,this._trigger,this._saveToCache)}},{key:"disableCaching",value:function(){this.stopListening(this.collection,this._trigger,this._saveToCache)}}]),t}();u.policy=o.CACHE_POLICY_TYPE.LOAD,t.default=u},cgfidiajgj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sticker=void 0;var r=d(i("fhfbcdaib")),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i("dcaifjegcg"),a=d(o),s=i("ddgbhifaji"),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(s),c=d(i("bffjfbgbg")),l=i("daichdjff");function d(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var h=(0,r.default)(function(){return new g({id:"placeholder",isPlaceholder:!0})}),p=t.Sticker=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,a=Array(n),s=0;s<n;s++)a[s]=arguments[s];return i=r=f(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,o.prop)(),r.mediaData=(0,o.session)(),r._mediaObject=(0,o.prop)(),r.clientUrl=(0,o.prop)(),r.directPath=(0,o.prop)(),r.filehash=(0,o.prop)(),r.height=(0,o.prop)(),r.index=(0,o.prop)(),r.mediaKey=(0,o.prop)(),r.mimetype=(0,o.prop)(),r.size=(0,o.prop)(),r.type=(0,o.prop)(l.OUTWARD_TYPES.STICKER),r.uploadhash=(0,o.prop)(),r.width=(0,o.prop)(),r.isPlaceholder=(0,o.prop)(),f(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"initialize",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.addChild("mediaData",new c.default),this.isPlaceholder||u.registerSticker(this)}},{key:"downloadMedia",value:function(){return u.downloadStickerOrStickerPackIcon(this)}},{key:"sendToChat",value:function(e){i("jdigiabic").default.enqueue([this]),this.mediaData&&this.mediaData.mediaBlob&&this.mediaData.mediaBlob.retain();var t={quotedMsg:e.composeQuotedMsg};return e.composeQuotedMsg=null,(0,s.prepSticker)(this).sendToChat(e,t)}}]),t}();p.Proxy="sticker",p.getPlaceholder=h;var g=(0,o.defineModel)(p);g.getPlaceholder=h,t.default=g},chbjajaddg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=c(i("cgcgbfbffj")),o=c(i("cbcbdjdah")),a=c(i("ccaaiecfib")),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),u=c(i("biecbbiiee"));function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=l(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.syncPromise=null,r.isSynced=!1,l(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.default),r(t,[{key:"onResume",value:function(){this.isSynced=!1,this.sync(this.parent)}},{key:"sync",value:function(e){var t=this;return a.default.supportsFeature(a.default.F.INDEX_RECEIVED_VCARD)?this.isSynced?Promise.resolve():this.syncPromise?this.syncPromise:(this.syncPromise=u.default.queryVCard(e.id).then(function(e){return t.add(e)}).catch(s.E499,function(){}).catch(function(){}).finally(function(){t.isSynced=!0,t.syncPromise=null}),this.syncPromise):(this.isSynced=!0,Promise.resolve())}}]),t}();d.model=o.default,d.resumeOnAvailable=!0,t.default=d},chghgadcbg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i("dcaifjegcg"),o=u(n),a=u(i("bhggeigghg")),s=u(i("jccfhaecf"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return i=r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,n.prop)(),c(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"contact",value:function(){return a.default.Contact.gadd(this.id)}}]),t}();l.Collection="Blocklist",l.Proxy="blocklist",l.idClass=s.default,t.default=(0,n.defineModel)(l)},cjabddhidj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=f(i("ebjaejiaba")),o=f(i("dfjfgdhbjj")),a=f(i("dbdfbgehgj")),s=f(i("bjigbaghc")),u=i("eacidghfgh"),c=f(u),l=f(i("bhggeigghg")),d=f(i("cgcgbfbffj"));function f(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.stale=!1,r.add(e,{silent:!0}),r.contact=i,r.listenTo(l.default.GroupMetadata,"group_participant_change_"+s.default.me.toString(),r.updateCommonGroups),r.listenTo(l.default.GroupMetadata,"group_participant_change_"+r.contact.toString(),r.updateCommonGroups),r.listenTo(c.default,"change:stream",function(){c.default.stream===u.STREAM.DISCONNECTED&&(r.stale=!0)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d.default),r(t,[{key:"updateCommonGroups",value:function(e){var t=l.default.GroupMetadata.assertGet(e).participants,i=s.default.me;this.get(e)?t.get(this.contact)&&t.get(i)||this.remove(e):t.get(this.contact)&&t.get(i)&&this.add(a.default.assertGet(e))}}]),t}();h.model=n.default,h.comparator=o.default,t.default=h},cjcghajbag:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCT_REVIEW_STATUS=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=s(i("idbcfjbae")),a=s(i("cgcgbfbffj"));function s(e){return e&&e.__esModule?e:{default:e}}var u=t.PRODUCT_REVIEW_STATUS={NO_REVIEW:"",PENDING:"PENDING",REJECTED:"REJECTED",APPROVED:"APPROVED",OUTDATED:"OUTDATED"};var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),r(t,[{key:"getProductModels",value:function(){var e=n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toArray",this).call(this);if(n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"length",this)<1)return e;var i=n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"head",this).call(this);return i&&i.catalogWid?n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"filter",this).call(this,function(e){return e.reviewStatus===u.APPROVED&&!e.old}):e}},{key:"add",value:function(e,i){var r=i?n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e,i):n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e);return this.sort(),r}}]),t}();c.model=o.default,c.comparator=function(e,t){return e.index-t.index},t.default=c},cjedbbhjhh:function(e,t,i){"use strict";e.exports={AllStarredMsgs:i("djfhiceeje").default,Blocklist:i("bgfcjjddjf").default,BusinessProfile:i("ejiicdbii").default,Call:i("biaifggagf").default,Catalog:i("ejegihaeh").default,Product:i("cjcghajbag").default,Chat:i("dbdfbgehgj").default,ChatPreference:i("ebcagbhefg"),Cmd:i("dhggbbghfb"),Conn:i("bjigbaghc").default,Contact:i("dhigahgdjb").default,ConversionTuple:i("ccbihadedf"),EmojiVariant:i("dfbhcehadj").default,GroupMetadata:i("djaadchjch"),Label:i("bijffg").default,LiveLocation:i("cdcijfdgje").default,Msg:i("biecbbiiee").default,MsgInfo:i("eigdejjai").default,Mute:i("dagdiahdfi").default,Presence:i("ebbjbbjjg").default,ProfilePicThumb:i("dhefcajhhb").default,QuickReply:i("bechejbabh").default,RecentEmoji:i("bjfecgfdgj").default,RecentSticker:i("jdigiabic").default,ServerProps:i("bfgbdiffgd").default,StarredGifMsgs:i("dfgeejdaib"),Status:i("gbbacfeci").default,StatusV3:i("bgcdajbhif").default,Sticker:i("dhjffabgfb").default,StickerPack:i("fagbfehid").default,Stream:i("dcdiaahjj").default,Wap:i("chajfbfiga").default,Wid:i("ecadbdfdef")}},dacfecidja:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=l(i("cgcgbfbffj")),o=l(i("dbdfbgehgj")),a=l(i("cbcbdjdah")),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),u=l(i("bfbggcdbfb")),c=l(i("biecbbiiee"));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.hasMoreMsgs=!0,e.resultPage=0,e.searchPromise=null,e.searchTerm=null,e.searchLabel=null,e.updateFtsAfterMsgLabelUpdate=function(){if(e.currentLabelSearch){var t=e.filter(function(t){return!t.labels||!t.labels.includes(e.currentLabelSearch)});e.remove(t,{silent:!0})}},e.listenTo(c.default,"remove_msgs",function(t){e.remove(t,{silent:!0}).filter(function(e){return!!e}).length&&e.trigger("bulk_remove")}),e.listenTo(o.default,"remove",function(t){var i=[];e.forEach(function(e){e.chat===t&&i.push(e)}),e.remove(i,{silent:!0}).filter(function(e){return!!e}).length&&e.trigger("bulk_remove")}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.default),r(t,[{key:"delete",value:function(e){e&&this.stopListening(),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this)}},{key:"resetSearch",value:function(){this.hasMoreMsgs=!0,this.resultPage=0,this.searchTerm=null,this.searchPromise&&this.searchPromise.cancel()}},{key:"search",value:function(e,t){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=e+"__"+(r.label||r.kind||"");this.currentLabelSearch=r.label;var o=!1;this.searchTerm!==n?(this.searchTerm&&0===e.indexOf(this.searchTerm)?o=!0:(this.searchTerm=n,this.delete()),this.resultPage=0,this.hasMoreMsgs=!0):o=!0;var a=new u.default.UiAction({uiActionType:u.default.UI_ACTION_TYPE.IMAGE_OPEN,uiActionPreloaded:o});if(this.searchPromise){if(this.searchTerm===n)return this.searchPromise;this.searchPromise.cancel()}var l=void 0;return l=t?t.fts(e,++this.resultPage,100):c.default.search(e,++this.resultPage,100,void 0,r),this.searchPromise=l.cancellable().then(function(e){e.eof&&(i.hasMoreMsgs=!1),i.searchTerm!==n&&i.delete(),i.searchTerm=n,e.messages&&i.add(e.messages.filter(function(e){return!e.isRevoked})),a.markUiActionT(),a.commit()}).catch(s.WapDrop,Promise.CancellationError,function(){}).finally(function(){i.searchPromise=null,i.trigger("searchPromise_update")}),this.trigger("searchPromise_update"),this.searchPromise}}]),t}();d.model=a.default,t.default=d},daejhdfjb:function(e,t,i){"use strict";var r,n,o,a,s,u,c;Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),d=i("dcaifjegcg"),f=O(d),h=O(i("dghjhchjic")),p=O(i("gbfffciea")),g=O(i("bjigbaghc")),y=i("cgejjichfa"),v=i("hgeacfdgi"),b=O(v),_=O(i("ccaaiecfib")),m=O(i("bhgjacgcdd"));function O(e){return e&&e.__esModule?e:{default:e}}function P(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function E(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var j=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=E(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,d.prop)(),r.peerJid=(0,d.prop)(),r.offerTime=(0,d.prop)(),r.startTime=(0,d.prop)(),r.isVideo=(0,d.prop)(!1),r.isGroupCall=(0,d.prop)(!1),r.canHandleLocally=(0,d.prop)(!1),r.outgoing=(0,d.prop)(!1),r.webClientShouldHandle=(0,d.prop)(!1),r.participants=(0,d.collection)(h.default),r._state=(0,d.prop)(),E(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f.default),l(t,[{key:"getState",value:function(){return this._state}},{key:"setState",value:function(e){var t,i=e;(t=this._state,i in T[t||"EMPTY"])&&(this.webClientShouldHandle||i===y.CALL_STATES.INCOMING_RING||(i=y.CALL_STATES.HANDLED_REMOTELY,b.default.callId===this.id&&m.default.callEndByHandledRemotely()),this._state!==y.CALL_STATES.CONNECTION_LOST&&i===y.CALL_STATES.ACTIVE&&(this.startTime=Date.now()),this._state=i,this.handleNotification(),this.potentiallyUpdateCallUi())}},{key:"handleNotification",value:function(){var e=this.getState();g.default.tosShowCallNotification&&this.peerJid&&!_.default.supportsFeature(_.default.F.DESKTOP_VOIP_VOICE_CALL)&&(e===y.CALL_STATES.INCOMING_RING?p.default.alertCall(this.peerJid,this.id,this.isVideo,this.canHandleLocally):p.default.cancelCall(this.peerJid))}},{key:"potentiallyUpdateCallUi",value:function(){b.default.callId===this.id?this.setCallUiProps():!b.default.callId&&this.getState()===y.CALL_STATES.INCOMING_RING&&_.default.supportsFeature(_.default.F.VOIP_INDIVIDUAL_INCOMING)&&this.canHandleLocally&&(b.default.callId=this.id,this.setCallUiProps())}},{key:"setCallUiProps",value:function(){b.default.type=this.isVideo?v.CALL_TYPES.VIDEO:v.CALL_TYPES.VOICE,b.default.state=this.getUiState(),b.default.to=this.outgoing?this.peerJid:g.default.me,b.default.from=this.outgoing?g.default.me:this.peerJid,b.default.startTime=this.startTime,b.default.outgoing=this.outgoing,b.default.state===y.CALL_UI_STATES.ENDED&&(b.default.peerBusy=!1)}},{key:"getUiState",value:function(){switch(this.getState()){case y.CALL_STATES.INCOMING_RING:return y.CALL_UI_STATES.INCOMING_RING;case y.CALL_STATES.OUTGOING_RING:return y.CALL_UI_STATES.OUTGOING_RING;case y.CALL_STATES.OUTGOING_CALLING:return y.CALL_UI_STATES.OUTGOING_CALLING;case y.CALL_STATES.CONNECTING:return y.CALL_UI_STATES.CONNECTING;case y.CALL_STATES.CONNECTION_LOST:return y.CALL_UI_STATES.RECONNECTING;case y.CALL_STATES.ACTIVE:return y.CALL_UI_STATES.ACTIVE;case y.CALL_STATES.HANDLED_REMOTELY:return y.CALL_UI_STATES.NONE;case y.CALL_STATES.ENDED:return y.CALL_UI_STATES.ENDED;case y.CALL_STATES.REJECTED:return y.CALL_UI_STATES.REJECTED;case y.CALL_STATES.REMOTE_CALL_IN_PROGRESS:return y.CALL_UI_STATES.REMOTE_CALL_IN_PROGRESS;case y.CALL_STATES.FAILED:return y.CALL_UI_STATES.FAILED;default:return y.CALL_UI_STATES.NONE}}}]),t}();j.Collection="Call",j.Proxy="call",t.default=(0,d.defineModel)(j);var T={EMPTY:(r={},P(r,y.CALL_STATES.INCOMING_RING,!0),P(r,y.CALL_STATES.OUTGOING_CALLING,!0),P(r,y.CALL_STATES.CONNECTING,!0),P(r,y.CALL_STATES.REJECTED,!0),P(r,y.CALL_STATES.HANDLED_REMOTELY,!0),P(r,y.CALL_STATES.ENDED,!0),P(r,y.CALL_STATES.FAILED,!0),r),INCOMING_RING:(n={},P(n,y.CALL_STATES.HANDLED_REMOTELY,!0),P(n,y.CALL_STATES.CONNECTING,!0),P(n,y.CALL_STATES.ACTIVE,!0),P(n,y.CALL_STATES.REJECTED,!0),P(n,y.CALL_STATES.ENDED,!0),P(n,y.CALL_STATES.REMOTE_CALL_IN_PROGRESS,!0),P(n,y.CALL_STATES.FAILED,!0),n),OUTGOING_CALLING:(o={},P(o,y.CALL_STATES.OUTGOING_RING,!0),P(o,y.CALL_STATES.CONNECTING,!0),P(o,y.CALL_STATES.ENDED,!0),P(o,y.CALL_STATES.FAILED,!0),o),OUTGOING_RING:(a={},P(a,y.CALL_STATES.ACTIVE,!0),P(a,y.CALL_STATES.REJECTED,!0),P(a,y.CALL_STATES.ENDED,!0),P(a,y.CALL_STATES.FAILED,!0),a),CONNECTING:(s={},P(s,y.CALL_STATES.OUTGOING_RING,!0),P(s,y.CALL_STATES.ACTIVE,!0),P(s,y.CALL_STATES.ENDED,!0),P(s,y.CALL_STATES.REMOTE_CALL_IN_PROGRESS,!0),P(s,y.CALL_STATES.FAILED,!0),s),CONNECTION_LOST:(u={},P(u,y.CALL_STATES.ACTIVE,!0),P(u,y.CALL_STATES.ENDED,!0),P(u,y.CALL_STATES.FAILED,!0),u),ACTIVE:(c={},P(c,y.CALL_STATES.ENDED,!0),P(c,y.CALL_STATES.FAILED,!0),P(c,y.CALL_STATES.CONNECTION_LOST,!0),c),HANDLED_REMOTELY:{},ENDED:{},REJECTED:{},REMOTE_CALL_IN_PROGRESS:{},FAILED:{}}},dagdiahdfi:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i("cgcgbfbffj"),o=f(n),a=f(i("bjigbaghc")),s=f(i("bdiiahhjbe")),u=f(i("bhggeigghg")),c=i("dhadcigcaf"),l=f(c),d=f(i("egjjcjcg"));function f(e){return e&&e.__esModule?e:{default:e}}var h=!0,p=!0,g=!0,y=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"initializeFromCache",value:function(e){this.add(e),this.setGlobalNotifications(d.default.getGlobalNotifications()),this.setGlobalSounds(d.default.getGlobalSounds()),this.setGlobalPreviews(d.default.getGlobalPreviews())}},{key:"saveToCache",value:function(){if(a.default.me){var e=this.constructor.cachePolicy.id;s.default.log("models:mute:cache-save: "+String(e))(),d.default.setCollection(e,[this.globalMute().toJSON()])}}},{key:"globalMute",value:function(){var e=this.get(c.GLOBAL_MUTE);return e||this.add({id:c.GLOBAL_MUTE})[0]}},{key:"getGlobalSounds",value:function(){return h}},{key:"setGlobalSounds",value:function(e){h=e,d.default.setGlobalSounds(e)}},{key:"getGlobalNotifications",value:function(){return p}},{key:"setGlobalNotifications",value:function(e){p=e,d.default.setGlobalNotifications(e)}},{key:"getGlobalPreviews",value:function(){return g}},{key:"setGlobalPreviews",value:function(e){g=e,d.default.setGlobalPreviews(e)}},{key:"handle",value:function(e){e.forEach(function(e){var t=u.default.Chat.get(e.id);t&&"mute"===e.type&&t.mute.setMute(e.muteExpiration)})}}]),t}();y.model=l.default,y.cachePolicy={id:"mute",policy:n.CACHE_POLICY.LOAD,delay:1e3},t.default=new y},dahaahdjfa:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},n=p(i("hgjcbccfg")),o=p(i("ccaaiecfib")),a=p(i("bdiiahhjbe")),s=p(i("ccgjijjbbj")),u=p(i("jccfhaecf")),c=i("dcbdjheea"),l=i("hjbbdjjdf"),d=i("bgiachiigg"),f=i("bffjfbgbg"),h=i("beadfddidc");function p(e){return e&&e.__esModule?e:{default:e}}var g={parseMsgProto:function(e,t,i,r,n,s){if(!e)return a.default.assert(!1,"null-message","drop: not Message")(e,t),t;var u=e.conversation,c=e.imageMessage,d=e.contactMessage,f=e.locationMessage,p=e.liveLocationMessage,g=e.extendedTextMessage,y=e.documentMessage,v=e.audioMessage,b=e.videoMessage,_=e.stickerMessage,m=e.contactsArrayMessage,O=e.protocolMessage,P=e.sendPaymentMessage,E=e.requestPaymentMessage,j=e.productMessage,T=e.groupInviteMessage,M=e.templateMessage,S=e.templateButtonReplyMessage,C=void 0;if((0,l.isString)(u)&&this.parseConversationProto(t,u),T&&this.parseGroupInviteMessageProto(t,T),c&&(this.parseImageMessageProto(t,c),C=c.contextInfo),_&&(this.parseStickerMessageProto(t,_),C=_.contextInfo),d&&(this.parseContactMessageProto(t,d),C=d.contextInfo),m&&(this.parseContactsArrayMessageProto(t,m),C=m.contextInfo),f&&(this.parseLocationMessageProto(t,f),C=f.contextInfo),p&&(this.parseLiveLocationMessageProto(t,p,n),C=p.contextInfo),P&&(C=P&&P.noteMessage&&P.noteMessage.extendedTextMessage&&P.noteMessage.extendedTextMessage.contextInfo,this.parseSendPaymentMessageProto(t,P,r)),E&&(C=E&&E.noteMessage&&E.noteMessage.extendedTextMessage&&E.noteMessage.extendedTextMessage.contextInfo,this.parseRequestPaymentMessageProto(t,E,r)),g&&(this.parseExtendedTextMessageProto(t,g),C=g.contextInfo),y&&(this.parseDocumentMessageProto(t,y),C=y.contextInfo),v&&(this.parseAudioMessageProto(t,v),C=v.contextInfo),b&&(this.parseVideoMessageProto(t,b),C=b.contextInfo),O&&this.parseProtocolMessageProto(t,O,i),j&&o.default.supportsFeature(o.default.F.CATALOG)&&(this.parseProductMessageProto(t,j),C=j.contextInfo),T&&this.parseGroupInviteMessageProto(t,T),M){if(o.default.supportsFeature(o.default.F.MD_BACKEND)&&o.default.supportsFeature(o.default.F.MD_HSM))this.parseTemplateMessage(t,M.fourRowTemplate);else if(o.default.supportsFeature(o.default.F.HSM)){var w=M.hydratedFourRowTemplate;this.parseTemplateMessage(t,w),t.caption=w.hydratedContentText,t.footer=w.hydratedFooterText,t.title=w.hydratedTitleText}t.type="template"}return S&&((0,h.shouldEnableHsm)()&&(this.parseContextInfoProto(t,S.contextInfo),this.parseTemplateButtonReplyMessage(t,S)),t.type="template_button_reply"),C&&this.parseContextInfoProto(t,C,s),t},parseConversationProto:function(e,t){e.type="chat",e.body=t},parseImageMessageProto:function(e,t){e.type="image",e.clientUrl=this.decodeUrl(t.url),e.directPath=t.directPath||"",e.mimetype=t.mimetype||"",e.caption=t.caption,e.filehash=this.decodeBytes(t.fileSha256),e.uploadhash=this.decodeBytes(t.fileEncSha256),e.size=t.fileLength||0,e.height=t.height||0,e.width=t.width||0,e.mediaKey=this.decodeBytes(t.mediaKey),e.body=this.decodeBytes(t.jpegThumbnail)||""},parseStickerMessageProto:function(e,t){e.type="sticker",e.clientUrl=this.decodeUrl(t.url),e.directPath=t.directPath||"",e.mimetype=t.mimetype||"",e.filehash=this.decodeBytes(t.fileSha256),e.uploadhash=this.decodeBytes(t.fileEncSha256),e.mediaKey=this.decodeBytes(t.mediaKey),e.height=t.height||0,e.width=t.width||0,e.pngThumbnail=this.decodeBytes(t.pngThumbnail)},parseContactMessageProto:function(e,t){e.type="vcard",e.subtype=t.displayName,e.body=t.vcard},parseContactsArrayMessageProto:function(e,t){var i=t.contacts;e.type="multi_vcard",e.subtype=t.displayName,e.vcardList=Array.isArray(i)?i.map(function(e){return{displayName:e.displayName,vcard:e.vcard}}):[]},parseLocationMessageProto:function(e,t){var i=t.name&&t.address?t.name+"\n"+t.address:t.name||t.address||"";e.type="location",e.lat=void 0!==t.degreesLatitude?t.degreesLatitude:void 0,e.lng=void 0!==t.degreesLongitude?t.degreesLongitude:void 0,e.loc=i,e.body=this.decodeBytes(t.jpegThumbnail)||"",e.clientUrl=t.url},parseExtendedTextMessageProto:function(e,t){var i=t.matchedText||t.canonicalUrl||t.description||t.title;e.type="chat",e.subtype=i?"url":void 0,e.body=t.text||"",e.matchedText=t.matchedText,e.canonicalUrl=t.canonicalUrl,e.description=t.description,e.title=t.title,e.thumbnail=this.decodeBytes(t.jpegThumbnail)||"",e.richPreviewType=t.previewType,e.textColor=t.textArgb,e.backgroundColor=t.backgroundArgb;var r=d.Message.ExtendedTextMessage.FONTTYPE;switch(t.font){case r.SANS_SERIF:case r.SERIF:case r.NORICAN_REGULAR:case r.BRYNDAN_WRITE:case r.BEBASNEUE_REGULAR:case r.OSWALD_HEAVY:e.font=t.font}},parseDocumentMessageProto:function(e,t){e.type="document",e.clientUrl=this.decodeUrl(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.caption=(0,f.cleanIncomingFilename)(t.title),e.filehash=this.decodeBytes(t.fileSha256),e.uploadhash=this.decodeBytes(t.fileEncSha256),e.size=t.fileLength||0,e.pageCount=t.pageCount||0,e.mediaKey=this.decodeBytes(t.mediaKey),e.filename=(0,f.cleanIncomingFilename)(t.fileName),e.body=this.decodeBytes(t.jpegThumbnail)||""},parseAudioMessageProto:function(e,t){e.type=t.ptt?"ptt":"audio",e.clientUrl=this.decodeUrl(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.filehash=this.decodeBytes(t.fileSha256),e.uploadhash=this.decodeBytes(t.fileEncSha256),e.size=t.fileLength||0,e.duration=""+(t.seconds||0),e.mediaKey=this.decodeBytes(t.mediaKey),e.streamingSidecar=t.streamingSidecar},parseVideoMessageProto:function(e,t){e.type="video",e.clientUrl=this.decodeUrl(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.filehash=this.decodeBytes(t.fileSha256),e.uploadhash=this.decodeBytes(t.fileEncSha256),e.size=t.fileLength||0,e.height=t.height,e.width=t.width,e.duration=""+(t.seconds||0),e.mediaKey=this.decodeBytes(t.mediaKey),e.caption=t.caption,e.body=this.decodeBytes(t.jpegThumbnail)||"",e.isGif=t.gifPlayback,e.gifAttribution=t.gifAttribution,e.streamingSidecar=t.streamingSidecar},parseContextInfoProto:function(e,t,i){var r=t.quotedMessage,n=t.mentionedJid;e.quotedMsg=r&&this.parseMsgProto(r,{type:"unknown"}),e.quotedMsg&&"payment"===e.quotedMsg.type&&i&&a.default.log("parseContextInfoProto: payment not supported")(),e.quotedStanzaID=t.stanzaId,e.quotedParticipant=this.decodeJid(t.participant),e.quotedRemoteJid=this.decodeJid(t.remoteJid),e.mentionedJidList=Array.isArray(n)?n.map(this.decodeJid):n,e.isForwarded=t.isForwarded,e.forwardingScore=t.forwardingScore},parseProtocolMessageProto:function(e,t,i){if("relay"===i){var r=void 0;switch(t.type){case d.Message.ProtocolMessage.TYPE.REVOKE:r="revoke";break;default:r="unknown"}var n=t.key,o=new s.default({fromMe:n.fromMe,remote:this.decodeJid(n.remoteJid),id:n.id,participant:this.decodeJid(n.participant)});e.type="protocol",e.subtype=r,e.protocolMessageKey=o}},decodeJid:function(e){return u.default.isWid(e)?(0,c.createWid)(e):e},decodeUrl:function(e){return e&&!e.includes("/u/")?e:void 0},decodeBytes:function(e){return e?n.default.encode(e):void 0},parseTemplateMessage:function(e,t){var i=t.documentMessage,r=t.imageMessage,n=t.locationMessage,o=t.videoMessage;i?(this.parseDocumentMessageProto(e,i),e.subtype="document"):r?(this.parseImageMessageProto(e,r),e.subtype="image"):n?(this.parseLocationMessageProto(e,n),e.subtype="location"):o?(this.parseVideoMessageProto(e,o),e.subtype="video"):(e.subtype="text",t.hydratedContentText&&(e.body=t.hydratedContentText)),t.hydratedButtons&&this.parseButtons(e,t)},parseButtons:function(e,t){var i=t.hydratedButtons,n=function(e){return e.callButton?"call":e.urlButton?"url":e.quickReplyButton?"quick_reply":void 0};e.buttons=i.map(function(e){return r({index:e.index,subtype:n(e)},function(e){return e.quickReplyButton||e.urlButton||e.callButton}(e))})},parseTemplateButtonReplyMessage:function(e,t){e.body=t.selectedDisplayText},parseProductMessageProto:function(e,t){if(o.default.supportsFeature(o.default.F.CATALOG)){var i=t.product;i&&(i.productImage&&this.parseImageMessageProto(e,i.productImage),e.type="product",e.businessOwnerJid=t.businessOwnerJid,e.contextInfo=t.contextInfo,e.productId=i.productId,e.currencyCode=i.currencyCode,e.priceAmount1000=i.priceAmount1000,e.retailerId=i.retailerId,e.url=i.url,e.productImageCount=i.productImageCount,e.title=i.title,e.description=i.description)}},parseLiveLocationMessageProto:function(e,t,i){a.default.log("parseLiveLocationMessageProto: not supported")()},parseSendPaymentMessageProto:function(e,t,i){a.default.log("parseSendPaymentMessageProto: not supported")()},parseRequestPaymentMessageProto:function(e,t,i){a.default.log("parseSendPaymentMessageProto: not supported")()},parseGroupInviteMessageProto:function(e,t){a.default.log("parseGroupInviteMessageProto: not supported")()}};t.default=g},dbbaabdabi:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConversionTupleExpiry=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=i("dcaifjegcg"),a=f(o),s=f(i("bjebjijbfc")),u=f(i("djheacfeif")),c=f(i("bdiiahhjbe")),l=f(i("dbajccegac")),d=f(i("jccfhaecf"));function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var p=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,a=Array(n),u=0;u<n;u++)a[u]=arguments[u];return i=r=h(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,o.prop)(),r.conversionData=(0,o.prop)(),r.conversionSource=(0,o.prop)(),r.timestamp=(0,o.prop)(function(){return s.default.globalUnixTime()}),r.alarmId=(0,o.session)(),h(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),r(t,[{key:"initialize",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.listenTo(this,"change:timestamp",this._setExpiryTimer),this._setExpiryTimer()}},{key:"_setExpiryTimer",value:function(){var e=this,t=this.timestamp+604800;if(t<0)return c.default.error("Invalid conversionTuple timer")(),void this.delete();this.alarmId=u.default.setLocalTimeout(function(){e.delete()},1e3*t,this.alarmId)}},{key:"_clearAlarm",value:function(){this.alarmId&&(u.default.clearTimeout(this.alarmId),this.alarmId=void 0)}},{key:"elapsedSeconds",value:function(){return s.default.globalUnixTime()-this.timestamp}},{key:"formatTuple",value:function(){var e={conversionDelaySeconds:this.elapsedSeconds()};return this.conversionData&&(e.conversionData=this.conversionData),this.conversionSource&&(e.conversionSource=this.conversionSource),e}},{key:"toJSON",value:function(){var e=this.serialize(),t=e.conversionData;if(t instanceof ArrayBuffer){var i=new l.default(t);e.conversionData=i.readString(t.byteLength)}return e}},{key:"delete",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.getCollection().remove(this.id),this._clearAlarm()}}]),t}();p.Collection="ConversionTuple",p.Proxy="conversionTuple",p.idClass=d.default,t.default=(0,o.defineModel)(p),t.ConversionTupleExpiry=604800},dbdfbgehgj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=U(i("bgeijhbbad")),n=U(i("jcfacighg")),o=U(i("iidhbgeed")),a=U(i("dbafiicfja")),s=U(i("bebajedcaf")),u=U(i("djfhiaaehb")),c=U(i("eaaagccfda")),l=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),d=G(i("cajijabhgb")),f=G(i("ebggjhghhi")),h=i("cgcgbfbffj"),p=U(h),g=U(i("ebjaejiaba")),y=U(i("dfjfgdhbjj")),v=i("bjigbaghc"),b=U(v),_=U(i("eadfaddcj")),m=U(i("bihjahgcja")),O=U(i("bijffg")),P=U(i("bdiiahhjbe")),E=U(i("ccgjijjbbj")),j=U(i("bechejbabh")),T=U(i("jdigiabic")),M=i("eacidghfgh"),S=U(M),C=U(i("fagbfehid")),w=U(i("bhggeigghg")),k=U(i("egjjcjcg")),A=U(i("jccfhaecf")),I=i("bgabieacgg"),L=i("dgacffdjd"),R=i("cjjjhbdicf"),N=i("dfdebdgdei"),D=i("ebffbebefe"),F=i("dcjbdhhjge");function G(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function U(e){return e&&e.__esModule?e:{default:e}}var x=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.notSpam={},e.promises={sendUnstarAll:null,initializeRestFromTabletCache:null},e.keysForResyncMsgs=void 0,e._sortEnabled=!1,e.enableSortListener(),e.listenTo(S.default,"change:stream",function(){S.default.stream===M.STREAM.RESUMING&&e.forEach(function(e){e.pendingMsgs=!1})}),e.listenToOnce(e,"sort",(0,c.default)(e.setIndexes,100)),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,p.default),l(t,[{key:"enableSortListener",value:function(e){this._sortEnabled||(this.listenTo(this,"change:t change:pin change:isVisible",this.sort),e&&this.sort(),this._sortEnabled=!0)}},{key:"disableSortListener",value:function(){this._sortEnabled&&(this.stopListening(null,null,this.sort),this._sortEnabled=!1)}},{key:"setIndexes",value:function(){this.forEach(function(e,t){e.initialIndex=t})}},{key:"active",value:function(){var e=(0,u.default)(this.filter(function(e){return e.active}));return e||void 0}},{key:"_find",value:function(e){return Promise.resolve({id:e,createdLocally:!0})}},{key:"_findQuery",value:function(e){var t=this,i={};return(0,I.find)(!!e.retry,i).then(function(e){return"preempted"===e?Promise.reject("chats preempted"):(b.default.platform===v.PLATFORMS.IPHONE&&((0,s.default)(e)?w.default.Msg.trigger(_.default.COLLECTION_HAS_SYNCED):setTimeout(function(){w.default.Msg.trigger(_.default.COLLECTION_HAS_SYNCED)},2500)),t.trigger(_.default.COLLECTION_HAS_SYNCED,i),Promise.resolve(e))})}},{key:"sync",value:function(){return this.findQuery({}).catch(d.WapDrop,function(){}),Promise.all([f.waitForBBEvent(this,_.default.COLLECTION_HAS_SYNCED),w.default.Msg._hasSynced()])}},{key:"getKeysForResyncMsgs",value:function(){return this.filter(function(e){return e.isVisible}).map(function(e){var t=e.getAckedPhoneProps(),i=e.lastReceivedKey;return i&&(t.id=i.id,t.fromMe=i.fromMe.toString(),t.participant=i.participant),t})}},{key:"setKeysForResyncMsgs",value:function(e){this.keysForResyncMsgs=e}},{key:"resetKeysForResyncMsgs",value:function(){this.keysForResyncMsgs=void 0}},{key:"resyncMessages",value:function(){var e=this;P.default.log("ChatStore:resyncMessages")();var t=this.keysForResyncMsgs||this.getKeysForResyncMsgs();return(0,R.resyncMessages)(t).then(function(t){return t.status>=400?(P.default.error("ChatStore:resyncMessages resume error "+t.status)(),Promise.reject(new Error("ChatStore:resyncMessages resume error "+t.status))):(P.default.log("ChatStore:resyncMessages resume success")(),(e.keysForResyncMsgs&&e.promises.initializeRestFromTabletCache?e.promises.initializeRestFromTabletCache:Promise.resolve()).then(function(){t.checksum&&(0,L.resyncContacts)(t.checksum),t.statusChecksum&&w.default.StatusV3.sync(t.statusChecksum),t.quickRepliesChecksum&&j.default.sync(t.quickRepliesChecksum),t.labelsChecksum&&O.default.sync(t.labelsChecksum),t.stickerPackChecksum&&C.default.sync(t.stickerPackChecksum),null!=t.recentStickersChecksum&&T.default.sync(t.recentStickersChecksum),e.disableSortListener(),t.data.forEach(function(t){if(t.disableUnreadAnchor=!1,t.firstUnreadKey=void 0,t.keys&&1===t.keys.length){var i=t.keys[0];t.firstUnreadKey=new E.default({id:i[0],fromMe:i[1],participant:i[2],remote:t.id})}if("delete"!==t.type&&!A.default.isPSA(t.id)){var r=w.default.Contact.get(t.id);if(r){if(t.name){var n={name:t.name};(0,F.updateLocal)(r.id,n).then(function(){r.set(n)})}}else w.default.Contact.add({id:t.id,name:t.name})}var o=e.get(t.id);if(o)if("clear"===t.type){o.resetMediaMsgs();var a=[];o.msgs.forEach(function(e){return a.push(e)}),o.msgChunks.length&&o.msgChunks.forEach(function(e){e.forEach(function(e){return a.push(e)})}),o.set({t:t.t,unreadCount:t.unreadCount,createdLocally:!1,archive:t.archive,isReadOnly:t.isReadOnly,modifyTag:t.modifyTag,msgs:[],notSpam:t.notSpam,unreadMsgAnchor:void 0,disableUnreadAnchor:t.disableUnreadAnchor,pendingMsgs:t.pendingMsgs,pin:t.pin,changeNumberOldJid:t.changeNumberOldJid,changeNumberNewJid:t.changeNumberNewJid,muteExpiration:t.muteExpiration}),a.forEach(function(e){e.delete()}),P.default.log("model:chat:resume: cleared chat for "+t.id)()}else"delete"===t.type?(o.delete(),P.default.log("model:chat:resume: deleted chat for "+t.id)()):o.set(t,{merge:!0});else e.add(t)})}).finally(function(){e.enableSortListener(!0)}))}).catch(d.WapDrop,function(e){return P.default.error("ChatStore:resyncMessages resume dropped")(),Promise.reject(e)}).finally(function(){e.resetKeysForResyncMsgs()})}},{key:"unstarAllMessages",value:function(e,t){return(0,D.unstarAllMessages)(e,t)}},{key:"forwardMessagesToChats",value:function(e,t){var r=i("dgjddffcfg"),s=Promise.map(e,function(e){return Promise.props({message:e,canForward:e.canForward()})});return Promise.map(t,function(e){var t=void 0;return t=e.isUser&&e.contact.isBlocked()?(0,N.unblockContact)(e.contact):Promise.resolve(!0),Promise.all([s,t]).spread(function(t,i){var r=(0,a.default)((0,o.default)(t,{canForward:!0}),"message"),n=(0,a.default)((0,o.default)(t,{canForward:!1}),"message");return Promise.props({chat:e,undelivered:e.forwardMessages(r,!0),canForward:r,cannotForward:n})})}).then(function(e){var t=(0,n.default)(e.map(function(e){var t=e.chat,i=e.undelivered,n=e.canForward,o=e.cannotForward,a=null;return(i.length||o.length)&&(a=r.formatForwardError({chat:t,undelivered:i,canForward:n,cannotForward:o})),a?{chat:t,reason:a}:null}));if(t.length)throw new m.default(t);return!0})}},{key:"saveToCache",value:function(){if(b.default.me){var e=t.cachePolicy.id;P.default.log("ChatCollection:saveToCache save: "+String(e))();var i=this.map(function(e,t){var i=e.toJSON(),n=t<20?Math.min(e.unreadCount+20,50):Math.min(Math.max(3,e.unreadCount),20);return i.msgs=e.msgs?e.msgs.slice(-n).map(function(e){return(0,r.default)(e.toJSON(),function(e){return void 0!==e})}):[],i});k.default.setCollection(e,i,!0)}}},{key:"onResume",value:function(){var e=this.active();e&&e.presence.subscribe()}},{key:"delete",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.listenToOnce(this,"sort",(0,c.default)(this.setIndexes,100))}}]),t}();x.model=g.default,x.comparator=y.default,x.cachePolicy={id:"chat",policy:h.CACHE_POLICY.IMMEDIATE,trigger:"add sort remove reset change:id change:t change:unreadCount change:archive change:isReadOnly change:isAnnounceGrpRestrict change:modifyTag change:muteExpiration change:name change:notSpam change:pin change:changeNumberOldJid change:changeNumberNewJid change:lastReceivedKey change:msg:ack msgs:loadEarlier"},t.default=new x},dbfjecijha:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MsgLoadState=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=i("dcaifjegcg"),a=d(o),s=d(i("cbcbdjdah")),u=d(i("bhggeigghg")),c=d(i("cgcgbfbffj")),l=d(i("cgeeeeddea"));function d(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g=function(e){function t(){var e,i,r;f(this,t);for(var n=arguments.length,a=Array(n),s=0;s<n;s++)a[s]=arguments[s];return i=r=h(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.noEarlierMsgs=(0,o.prop)(),r.isLoadingEarlierMsgs=(0,o.prop)(),r.isLoadingRecentMsgs=(0,o.prop)(),r.isLoadingAroundMsgs=(0,o.prop)(),r.contextLoaded=(0,o.prop)(),h(r,i)}return p(t,a.default),t}();g.Proxy="msgLoad";var y=t.MsgLoadState=(0,o.defineModel)(g),v=function(e){function t(){f(this,t);var e=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.msgLoadState=new y({noEarlierMsgs:!1,isLoadingEarlierMsgs:!1,isLoadingRecentMsgs:!1,isLoadingAroundMsgs:!1,contextLoaded:!1}),e.listenTo(e,"add remove reset sort",e.triggerChangeLast),e}return p(t,c.default),r(t,[{key:"delete",value:function(){this.stopListening(),n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.msgLoadState.delete()}},{key:"triggerChangeLast",value:function(e,t,i){var r=this.last();if(this._last!==r){this._last=r;var n=!1;t&&t.includes(e)&&i&&i.add&&!i.remove&&(n=!0),this.trigger("change:last",r,n)}}},{key:"add",value:function(e,i){var r=this,o=n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e,i);return u.default.Msg.add(o,i).forEach(function(e){e&&r.isModel(e)&&(e.msgChunk=r)}),o&&this.trigger("bulk_add",o,i),o}},{key:"remove",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"remove",this).call(this,e,i),a=!!i&&i.silent,s=o.filter(function(e){return!!e});return s.length&&!a&&(this.trigger("remove_msgs",s,i),r||this.trigger("update_sort_time")),o}},{key:"replace",value:function(e){var t=this;this.msgLoadState=e.msgLoadState,this.loadRecentPromise=e.loadRecentPromise,this.loadEarlierPromise=e.loadEarlierPromise,this.loadAroundPromise=e.loadAroundPromise;var i=e.getModelsArray();this.set(i,{silent:!0,merge:!1}),i.forEach(function(e){t.isModel(e)&&(e.msgChunk=t)}),this.trigger("bulk_add",i)}},{key:"onMsgLoadStateChange",value:function(e){var t=this,i=void 0,r=function(){e()},n=function(){(0,l.default)(null!=i,"prevMsgLoadState cannot be null after bulk_add"),i.off("change",r);var n=t.msgLoadState;n.on("change",r),i=n,e()};(i=this.msgLoadState).on("change",r),this.on("bulk_add",n);var o=function(){(0,l.default)(null!=i,"prevMsgLoadState cannot be null when unsubscribing"),t.off("bulk_add",n),i.off("change",r)};return function(){var e=o;e&&(o=null,e())}}}]),t}();v.model=s.default,t.default=v},dbjacfjdhg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=v(i("chihjdheic")),n=v(i("ddjgcdciii")),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},s=i("biheibdage"),u=v(s),c=v(i("cgcgbfbffj")),l=v(i("eadfaddcj")),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),f=v(i("cieaaiahhf")),h=v(i("bbcjhfahhb")),p=v(i("bfgbdiffgd")),g=v(i("dcaibchbg")),y=i("cgffhfegce");function v(e){return e&&e.__esModule?e:{default:e}}var b=y.FILETYPE.IMAGE,_=y.FILETYPE.VIDEO,m=y.FILETYPE.DOCUMENT,O=y.FILETYPE.AUDIO,P=s.ATTACH_MEDIA_STATE.READY,E=s.ATTACH_MEDIA_STATE.ERROR,j=s.ATTACH_MEDIA_STATE.PROCESSING,T=1,M=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.errorMsgs=null,e.ignored=0,e.mediaPickerStatsLogger=new h.default,e.selection=new g.default([],function(e){return e.id},"prev"),e.listenTo(e.selection,"all",e._handleSelectionEvents.bind(e)),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.default),o(t,[{key:"_handleSelectionEvents",value:function(e,t){"focus"!==t&&!1!==t||this.trigger("active-change")}},{key:"removeSingleton",value:function(e,t){e&&(t||this.mediaPickerStatsLogger.logDelete(e.id),e.url&&window.URL.revokeObjectURL(e.url),e.original&&e.original.url&&window.URL.revokeObjectURL(e.original.url))}},{key:"remove",value:function(e,i){var r=this,n=a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"remove",this).call(this,e,i);return n.forEach(function(e){return r.removeSingleton(e,i)}),this.selection.init(this.getPreviewableMedias(),!0),n}},{key:"delete",value:function(){var e=this;a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.forEach(function(t){return e.removeSingleton(t)}),this.selection.init(this.getPreviewableMedias(),!0)}},{key:"replace",value:function(e,t){var i=this.get(e);if(i){var r=this.indexOf(i),n=i.caption;this.remove(i,{silent:!0}),i.delete();var o=new u.default({id:e,caption:n,file:this._normalizeFile(t),chat:i.chat,uiProcessed:!1});return this.add(o,r?{at:r}:{}),o.processPromise}}},{key:"getValidMedias",value:function(){return this.filter(function(e){return e.state===P})}},{key:"getPreviewableMedias",value:function(){return this.filter(function(e){return e.previewable})}},{key:"getActive",value:function(){return this.selection.getVal()}},{key:"setActive",value:function(e){this.selection.setVal(e)}},{key:"unsetActive",value:function(){this.selection.unset()}},{key:"setNextAsActive",value:function(){var e=this.selection.list.length-1;return-1===this.selection.index||this.selection.index===e?this.selection.getVal():(this.selection.setNext(),this.selection.getVal())}},{key:"setPrevAsActive",value:function(){return-1===this.selection.index||0===this.selection.index?this.selection.getVal():(this.selection.setPrev(),this.selection.getVal())}},{key:"processFiles",value:function(e,t,i){var r=this,n=this.getPreviewableMedias().length,o=e.length+n>l.default.MAX_FILES?Math.max(l.default.MAX_FILES-n,0):e.length,a=e.length-o;0===o?a&&this.trigger("max_upload_limit",a):this.ignore(a);var s=e.slice(0,o).map(function(e){return new u.default({id:T++,file:r._normalizeFile(e),chat:t,uiProcessed:!1})});this.add(s);var c=this.getActive();return this.unsetActive(),Promise.all(e).then(function(){return r._attemptToSetNextActiveFromAdded(s,c)}),Promise.map(s,function(e){return e.processPromise}).then(function(){return r._attemptToSetNextActiveFromAdded(s,c)})}},{key:"_attemptToSetNextActiveFromAdded",value:function(e,t){if(!this.getActive()&&!(0,n.default)(this.getModelsArray(),{state:j,previewable:!1})){var i=(0,r.default)(e,function(e){return e.previewable});i||(i=t),this.selection.init(this.getPreviewableMedias()),i&&this.setActive(i)}}},{key:"_logMediaAdd",value:function(e){this.mediaPickerStatsLogger.chatRecipients||(this.mediaPickerStatsLogger.chatRecipients=e.chat.groupMetadata&&e.chat.groupMetadata.participants.length||1);var t=e.isGif?"gif":e.type;this.mediaPickerStatsLogger.logAdd(e.id,t,e.fileOrigin)}},{key:"_normalizeFile",value:function(e){return Promise.resolve(e).then(function(e){var t=void 0;return!(t=e instanceof File?{file:e,filename:e.name,mimetype:e.type,type:(0,y.typeFromMimetype)(e.type)}:e instanceof Blob?{file:e,mimetype:e.type,type:(0,y.typeFromMimetype)(e.type)}:e).type&&t.mimetype&&(t.type=(0,y.typeFromMimetype)(t.mimetype)),t})}},{key:"ignore",value:function(e){e>0&&(this.ignored+=e)}},{key:"uiProcessMsgs",value:function(){var e=this,t=[],i=void 0,r=0,n=0,o=0,a=0,s=0,u=0,c=0,h=0,g=0,y=!1,v=l10n.filesize(p.default.media),P=l10n.filesize(p.default.maxFileSize);if(this.forEach(function(t){if(!t.uiProcessed&&(!i&&t.previewable&&(i=t,e._logMediaAdd(t)),t.state!==j&&(t.uiProcessed=!0,t.state===E)))if(t.exception instanceof f.default)switch(t.getFileType()){case b:r+=1;break;case _:n+=1;break;case O:o+=1;break;case m:a+=1}else if(t.exception instanceof d.MediaFileEmpty)switch(t.getFileType()){case b:s+=1;break;case _:u+=1;break;case O:c+=1;break;case m:h+=1}else t.exception instanceof d.MediaFileFailedLoad?y=!0:g+=1}),r>0&&t.push(l10n.t("image_too_big",{number:r,_plural:r,maxSize:v})),n>0&&t.push(l10n.t("video_too_big",{number:n,_plural:n,maxSize:v})),o>0&&t.push(l10n.t("audio_too_big",{number:o,_plural:o,maxSize:v})),a>0&&t.push(l10n.t("document_too_big",{number:a,_plural:a,maxSize:P})),s>0&&t.push(l10n.t("image_empty",{number:s,_plural:s})),u>0&&t.push(l10n.t("video_empty",{number:u,_plural:u})),c>0&&t.push(l10n.t("audio_empty",{number:c,_plural:c})),h>0&&t.push(l10n.t("document_empty",{number:h,_plural:h})),g>0&&t.push(l10n.t("files_not_supported",{number:g,_plural:g})),y&&(t=[]).push(l10n.t("media_failed_load")),t.length>1){t=[];var T=r+n+o+a,M=s+u+c+h,S=T+M+g;0===g?(0!==T&&t.push(l10n.t("files_too_big",{number:T,_plural:T,maxSize:P})),0!==M&&t.push(l10n.t("files_empty",{number:M,_plural:M}))):t.push(l10n.t("files_not_added",{number:S,_plural:S}))}this.errorMsgs=t.join(" "),this.ignore(this.getPreviewableMedias().length-l.default.MAX_FILES);var C=this.ignored;return this.ignored=0,C&&this.trigger("max_upload_limit",C),{errorMsgs:this.errorMsgs}}},{key:"canSend",value:function(){return!(0,n.default)(this.getModelsArray(),{state:j,previewable:!1})}}]),t}();M.model=u.default,t.default=M},dbjfahieed:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CACHE_POLICY_TYPE=void 0,t.createCachePolicy=function(e,t){switch(t.policy){case"LOAD":return new r.default(e,t);case"IMMEDIATE":return new o.default(e,t);case"NONE":return new n.default(e,t)}return new n.default(e,{id:"none",policy:"NONE"})};var r=s(i("cgfdiahhcd")),n=s(i("cdbfiiicdg")),o=s(i("ijiafihgg")),a=i("bdfbccfifg");function s(e){return e&&e.__esModule?e:{default:e}}t.CACHE_POLICY_TYPE=a.CACHE_POLICY_TYPE},dcaifjegcg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.collection=t.derived=t.session=t.prop=void 0;var r=j(i("dichbhhfga")),n=j(i("eicihhaba")),o=j(i("bhdddbafig")),a=j(i("bhdefefjjb")),s=j(i("cfadahgeie")),u=j(i("ifhdgjfff")),c=j(i("bejjegijhj")),l=j(i("fcdbffdgh")),d=j(i("bebajedcaf")),f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},h=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),p=i("bjcgjfiffb");Object.defineProperty(t,"prop",{enumerable:!0,get:function(){return p.prop}}),Object.defineProperty(t,"session",{enumerable:!0,get:function(){return p.session}}),Object.defineProperty(t,"derived",{enumerable:!0,get:function(){return p.derived}}),Object.defineProperty(t,"collection",{enumerable:!0,get:function(){return p.collection}}),t.defineModel=function(e){var t=(0,p.convert)(e),i=(0,p.stateExtend)(C,t);if(e.Proxy){var r=(0,y.genMirrorMask)(t);i.prototype.mirrorMask=r,(0,E.default)(e.Proxy,t,r)}return i};var g=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),y=i("jjbajibff"),v=j(y),b=j(i("gbfffciea")),_=j(i("cccehdaiaf")),m=j(i("bdiiahhjbe")),O=j(i("bhggeigghg")),P=i("hjbbdjjdf"),E=j(i("ceidcegjgi"));function j(e){return e&&e.__esModule?e:{default:e}}function T(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function M(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var S=/^change:/,C=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=M(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(r.stale=(0,p.session)(),r.__fired=null,r.__changes=null,r.__initialized=!1,i._internalInitializationDoNotUse)return M(r);r.stale=e&&e.stale||r.getDefault("stale"),r.parent=i.parent,r.collection=i.collection,r._initDeriveds(),r._initCollections();var n=r.__defaults,o=n?f({},n,e):e;return o&&!(0,d.default)(o)&&r.set(o,f({silent:!0},i)),r.initialize(),r.__initialized=!0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,_.default),h(t,[{key:"initialize",value:function(){if(this.collection&&this.id&&!this.collection._model.prototype.isIdType(this.id))throw new Error("Model id:"+String(this.id)+" is wrong type");this._uiObservers=0,this.mirrorMask&&(this.mirror=new v.default(this))}},{key:"update",value:function(){return this.getCollection().update(this.id)}},{key:"find",value:function(){return this.getCollection().find(this.id)}},{key:"getCollection",value:function(){return this.Collection||m.default.assert(!1,"no-collection","baseState:getCollection Attempting to get a non existing collection")(),O.default[this.Collection]}},{key:"_refreshStaleModel",value:function(){!this._uiObservers&&this.stale||this.getCollection().find(this.id).catch(g.WapDrop,function(){})}},{key:"incObservers",value:function(e){(this._uiObservers++,e)||i("deiciccchg").default.online&&this.stale&&(b.default.uiBusy?this.listenToOnce(b.default,"ui_idle",this._refreshStaleModel):this._refreshStaleModel())}},{key:"decObservers",value:function(){this._uiObservers>0&&this._uiObservers--,0===this._uiObservers&&this.stopListening(b.default,"ui_idle",this._refreshStaleModel)}},{key:"hasObservers",value:function(){return this._uiObservers>0}},{key:"addChild",value:function(e,t){var i={};i[e]=t,this.set(i,{silent:!0}),this.listenTo(t,"all",this._getCachedEventBubblingHandler(e))}},{key:"get",value:function(e){return this[e]}},{key:"set",value:function(e,t,i){var r=i;return"string"==typeof e?this._set(e,t,r):(r=t)&&r.merge?this._set((0,l.default)(e,c.default),r):this._set(e,r)}},{key:"_markChange",value:function(e){this.__initialized&&(this._getChanges().push(e),this.__fired&&(this.__fired[e]=!1))}},{key:"_set",value:function(e,t,i){var r=this,n=i,o=!!this.__changes,c=void 0;(0,P.isString)(e)?c=this._setKV(e,t,n):(n=t,c=(0,u.default)(e,function(e,t,i){var o=r._setKV(i,t,n);return o&&e.push(o),e},[]));for(var l=0,d=function(){if(l++>5)throw new Error("Circular derived properties / event listeners");var e=(0,s.default)(c),t=r._topo;if(!t)throw new Error("_topo unexpectedly undefined");var i=(0,a.default)(t,e);c=i.reduce(function(e,t,n){var o=r._setD(t,i.slice(n+1));return o&&e.push.apply(e,T(o)),e},[])};c&&c.length>0;)d();if(!(n&&n.silent)&&this.hasUnfiredChanges()){for(var f=this.__fired={},h=this._getChanges(),p=h.length;h.length;){var g=h.shift();if(!f[g]){f[g]=!0;var y=this._definition[g].evt;(this.isListening(y)||this.isListening("all"))&&this.trigger(y,this,this[g])}}(p&&this.isListening("change")||this.isListening("all"))&&this.trigger("change",this)}return o||(this.__changes&&(this.__changes=null),this.__fired&&(this.__fired=null)),this}},{key:"_setKV",value:function(e,t,i){if(this._collections[e])this[e].set(t,i);else{var r=this._definition[e];if(r){if(r.attr===p.Attr.DERIVED)throw new Error("Attempting to directly set derived property: "+e);var n=r.sk;if(t!==this[e]){this[n]=t,this._markChange(e);var o=this._deps;return o&&o[e]?o[e]:void 0}}else this[e]=t}}},{key:"_setD",value:function(e,t){var i=this._definition[e],r=i.sk,n=i.fn.call(this);if(this[r]!==n&&(this[r]=n,this._markChange(e),this._deps&&this._deps[e])){var a=(0,o.default)(this._deps[e],t);if(a.length)return a}}},{key:"hasUnfiredChanges",value:function(){var e=this.__fired,t=this.__changes;if(!t)return!1;if(!e)return!0;for(var i=0;i<t.length;i++)if(!e[t[i]])return!0;return!1}},{key:"_getChanges",value:function(){return this.__changes||(this.__changes=[])}},{key:"_initDeriveds",value:function(){var e=this;this.__derived.forEach(function(t){e[e._definition[t].sk]=p.INIT})}},{key:"_initCollections",value:function(){var e=this;(0,n.default)(this._collections,function(t,i){e[i]=new t(null,{parent:e})})}},{key:"unset",value:function(e,t){var i=Array.isArray(e)?e:[e];this.set((0,r.default)(i),t)}},{key:"clear",value:function(){this.unset([].concat(T(this.__props),T(this.__session)))}},{key:"delete",value:function(){this.stopListening()}},{key:"reset",value:function(){this.set(this.__defaults)}},{key:"toJSON",value:function(){return this.serialize()}},{key:"serialize",value:function(){for(var e=this,t={},i=0;i<this.__props.length;i++)t[this.__props[i]]=this[this.__props[i]];return(0,n.default)(this._collections,function(i,r){t[r]=e[r].serialize()}),t}},{key:"getDefault",value:function(e){var t=this._definition[e];if(t){var i=t.default;return(0,P.isFunction)(i)?i():i}}},{key:"_getCachedEventBubblingHandler",value:function(e){return function(t,i,r){S.test(t)?this.trigger("change:"+e+"."+t.split(":")[1],i,r):"change"===t&&this.trigger("change",this)}.bind(this)}}],[{key:"isIdType",value:function(e){return!(!this.idWhitelist||!this.idWhitelist.includes(e))||(this.idClass?e instanceof this.idClass:"string"==typeof e)}}]),t}();t.default=C},dcdiaahjj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamMode=t.StreamInfo=void 0;var r=E(i("eaaagccfda")),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=E(i("eadfaddcj")),a=E(i("ccaaiecfib")),s=E(i("bdiiahhjbe")),u=i("dcaifjegcg"),c=E(u),l=E(i("bfbggcdbfb")),d=E(i("djbfbcedhj")),f=E(i("bhggeigghg")),h=E(i("deiciccchg")),p=i("eacidghfgh"),g=E(p),y=E(i("cbbhbjebii")),v=E(i("ceddibdhdb")),b=E(i("egjjcjcg")),_=E(i("cfgcdfcfee")),m=E(i("gbfffciea")),O=i("icbibjcg"),P=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("gefabghf"));function E(e){return e&&e.__esModule?e:{default:e}}function j(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var T={OFFLINE:"OFFLINE",OPENING:"OPENING",PAIRING:"PAIRING",SYNCING:"SYNCING",RESUMING:"RESUMING",CONNECTING:"CONNECTING",NORMAL:"NORMAL",TIMEOUT:"TIMEOUT"},M={QR:"QR",MAIN:"MAIN",SYNCING:"SYNCING",OFFLINE:"OFFLINE",CONFLICT:"CONFLICT",PROXYBLOCK:"PROXYBLOCK",TOS_BLOCK:"TOS_BLOCK",SMB_TOS_BLOCK:"SMB_TOS_BLOCK",DEPRECATED_VERSION:"DEPRECATED_VERSION"};t.StreamInfo=T,t.StreamMode=M;var S={SHOW:"SHOW",OBSCURE:"OBSCURE",HIDE:"HIDE"},C=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=j(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.info=(0,u.session)(T.NORMAL),r.mode=(0,u.session)(M.SYNCING),r.obscurity=(0,u.session)(S.HIDE),r.needsUpdate=(0,u.session)(),r.clientExpired=(0,u.session)(!1),r.hardExpired=(0,u.session)(!1),r.couldForce=(0,u.session)(),r.uiActive=(0,u.session)(),r.available=(0,u.session)(!0),r.unavailableShiftTimer=(0,u.session)(),r.unavailableLogoutTimer=(0,u.session)(),r.unobscureShiftTimer=(0,u.session)(),r.timeoutEvent=(0,u.session)(),r.resumeCount=(0,u.session)(0),r.phoneAuthed=(0,u.session)(!1),r._activeModeMeasure=(0,u.session)(),r.displayInfo=(0,u.derived)(r._displayInfo,["info","obscurity"]),j(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.default),n(t,[{key:"_displayInfo",value:function(){return function(e,t){switch(t){case S.SHOW:return e;case S.HIDE:return g.default.hasSynced?T.NORMAL:T.CONNECTING;case S.OBSCURE:switch(e){case T.OPENING:case T.PAIRING:case T.SYNCING:case T.RESUMING:return T.CONNECTING;default:return e}default:return s.default.error("Stream:unknown obscure level:",t)(),e}}(this.info,this.obscurity)}},{key:"initialize",value:function(){var e=this;(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this._activeModeMeasure=P.startMeasure("Stream.mode: "+this.mode),s.default.log("Stream:rememberMe: "+String(b.default.getRememberMe()))(),this.unavailableShiftTimer=new v.default(function(){return e.markUnavailable()}),this.unobscureShiftTimer=new v.default(function(){return e.unobscure()}),this.unavailableLogoutTimer=new v.default(function(){b.default.getRememberMe()||(s.default.log("Stream:unavailableLogoutTimer logout due to inactivity")(),g.default.logout())}),this.listenTo(g.default,"change:state change:stream change:hasSynced",this.onSocketUpdate),this.listenTo(h.default,"change:online",this.onSocketUpdate),this.listenTo(this,"change:available",this.onAvailableUpdate),this.listenTo(this,"change:phoneAuthed",this.onPhoneAuthedUpdate),this.listenTo(this,"change:info change:displayInfo change:mode",(0,r.default)(this.onSelfUpdate)),this.listenTo(this,"change:info",this.logPageResume),this.listenTo(this,"change:info",this.updateWamLog),this.listenTo(this,"change:mode",this.logModeChange),this.listenTo(this,"change:available change:uiActive",this.updateCouldForce),this.listenTo(m.default,"midnight",this.updateHardExpire.bind(this)),window.document&&document.addEventListener("visibilitychange",this.updateCouldForce),this.updateCouldForce(),this.updateHardExpire()}},{key:"delete",value:function(){}},{key:"markAvailable",value:function(){this.unavailableShiftTimer.cancel(),this.available=!0,d.default.monitor(!0,this.displayInfo===T.TIMEOUT)}},{key:"markUnavailable",value:function(e){e?this.unavailableShiftTimer.onOrBefore(e):(this.unavailableShiftTimer.cancel(),this.available=!1,d.default.monitor(!1,this.displayInfo===T.TIMEOUT))}},{key:"onSelfUpdate",value:function(){s.default.log("Stream:onSelfUpdate mode:"+this.mode+" info:"+this.info+" view:"+this.displayInfo)();var e=this.timeoutEvent;if(this.info===T.TIMEOUT)e||(this.timeoutEvent=e=new l.default.WebcPhoneDisconnected),this.displayInfo!==T.TIMEOUT||this._bbarTime||(this._bbarTime=Date.now());else if(e){e.markWebcPhoneDisconnectedT();var t=this._bbarTime;t&&(e.webcPhoneBbarShownT=Date.now()-t),e.commit(),this.timeoutEvent=null}}},{key:"onSocketUpdate",value:function(){var e={},t=function(){switch(g.default.state){case p.STATE.TIMEOUT:return T.TIMEOUT;case p.STATE.OPENING:return h.default.online?T.OPENING:T.OFFLINE;case p.STATE.PAIRING:return g.default.hasSynced?T.RESUMING:T.PAIRING;case p.STATE.CONNECTED:return g.default.stream!==p.STREAM.CONNECTED?g.default.hasSynced?T.NORMAL:T.SYNCING:T.NORMAL;case p.STATE.UNLAUNCHED:case p.STATE.PROXYBLOCK:default:return T.NORMAL}}();if(e.info=t,e.mode=function(){var e=!1;a.default.supportsFeature(a.default.F.MD_BACKEND)||(e=b.default.knowsPhone());if(!e&&g.default.state!==p.STATE.PROXYBLOCK)return M.QR;var t=g.default.hasSynced;switch(g.default.state){case p.STATE.PROXYBLOCK:return M.PROXYBLOCK;case p.STATE.CONFLICT:return M.CONFLICT;case p.STATE.TOS_BLOCK:return M.TOS_BLOCK;case p.STATE.SMB_TOS_BLOCK:return M.SMB_TOS_BLOCK;case p.STATE.DEPRECATED_VERSION:return M.DEPRECATED_VERSION;case p.STATE.UNLAUNCHED:return M.SYNCING;case p.STATE.UNPAIRED_IDLE:case p.STATE.UNPAIRED:return M.QR;case p.STATE.OPENING:if(!h.default.online&&!g.default.hasSynced)return M.OFFLINE;default:return t||g.default.stream===p.STREAM.CONNECTED?M.MAIN:M.SYNCING}}(),e.phoneAuthed=g.default.stream!==p.STREAM.DISCONNECTED,t===T.NORMAL)this.unobscureShiftTimer.cancel(),e.obscurity=S.HIDE;else if(t===T.OFFLINE)this.unobscureShiftTimer.cancel(),e.obscurity=S.OBSCURE;else switch(this.obscurity){case S.HIDE:this.unobscureShiftTimer.onOrBefore(o.default.DIAGNOSTIC_DELAY);break;case S.OBSCURE:this.unobscureShiftTimer.onOrBefore(3e3);break;case S.SHOW:}this.set(e)}},{key:"unobscure",value:function(){this.obscurity=S.SHOW}},{key:"onPhoneAuthedUpdate",value:function(){this.phoneAuthed&&(this.sendAvailability(!0),f.default.RecentEmoji.sync())}},{key:"onAvailableUpdate",value:function(){var e=this.available;s.default.log("Stream:onAvailableUpdate user "+(e?"available":"unavailable"))(),e||b.default.getRememberMe()?this.unavailableLogoutTimer.cancel():this.unavailableLogoutTimer.onOrBefore(o.default.IDLE_TIMEOUT_WAIT),this.sendAvailability(!1)}},{key:"sendAvailability",value:function(e){(e||this.uiActive)&&(this.available?(0,O.sendPresenceAvailable)():(0,O.sendPresenceUnavailable)())}},{key:"updateCouldForce",value:function(){this.couldForce=!this.uiActive||!this.available&&document.hidden}},{key:"updateHardExpire",value:function(){y.default.isExpired()&&(this.hardExpired=!0,y.default.restart(!0))}},{key:"logPageResume",value:function(){this.info===T.RESUMING&&(this.resumeCount++,new l.default.WebcPageResume({webcResumeCount:this.resumeCount}).commit())}},{key:"updateWamLog",value:function(){var e=this.info===T.NORMAL;d.default.streamInfoChange(this.info,_.default.numSocketsAttempted,e),e&&this.stopListening(this,"change:info",this.updateWamLog)}},{key:"logModeChange",value:function(){this._activeModeMeasure&&this._activeModeMeasure.end(),this._activeModeMeasure=P.startMeasure("Stream.mode: "+this.mode);var e=void 0;e=this.mode===M.TOS_BLOCK||this.mode===M.SMB_TOS_BLOCK?l.default.WEBC_STREAM_MODE_CODE.TOS_BLOCK:l.default.WEBC_STREAM_MODE_CODE[this.mode],new l.default.WebcStreamModeChange({webcStreamMode:e}).commit()}}]),t}();C.Proxy="stream";var w=(0,u.defineModel)(C);t.default=new w},ddcfhecgai:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(i("eaejieeafc")),n=o(i("cgcgbfbffj"));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.default),t}();a.model=r.default,t.default=a},ddeghajfaj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i("dcaifjegcg"),a=(r=o)&&r.__esModule?r:{default:r};function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,a=Array(n),u=0;u<n;u++)a[u]=arguments[u];return i=r=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,o.prop)(),r.shortcut=(0,o.prop)(),r.message=(0,o.prop)(),r.count=(0,o.prop)(),r.keywords=(0,o.prop)(),r.pendingCount=(0,o.session)(0),r.totalCount=(0,o.derived)(r._totalCount,["count","pendingCount"]),s(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"_totalCount",value:function(){return this.count+this.pendingCount}},{key:"useOnce",value:function(){this.pendingCount+=1,this.getCollection().periodicFlush()}}]),t}();u.Collection="QuickReply",u.Proxy="quickReply",t.default=(0,o.defineModel)(u)},debjjaigad:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_PREFERENCE=void 0;var r=i("dcaifjegcg"),n=a(r),o=a(i("jccfhaecf"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){var e,i,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),u=0;u<o;u++)a[u]=arguments[u];return i=n=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),n.id=(0,r.prop)(),n.wallpaperColor=(0,r.prop)(),n.saveToCameraRoll=(0,r.prop)(),s(n,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.default),t}();u.Collection="ChatPreference",u.Proxy="chatPreference",u.idClass=o.default,u.idWhitelist=["defaultPreference"],t.DEFAULT_PREFERENCE="defaultPreference",t.default=(0,r.defineModel)(u)},defecifdhg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULTS=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i("dcaifjegcg"),o=s(n),a=s(i("jccfhaecf"));function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return i=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,n.prop)(),r.tag=(0,n.prop)(),r.address=(0,n.prop)(),r.description=(0,n.prop)(),r.vertical=(0,n.prop)(),r.email=(0,n.prop)(),r.website=(0,n.prop)(),r.latitude=(0,n.prop)(),r.longitude=(0,n.prop)(),r.businessHours=(0,n.prop)(),r.catalogStatus=(0,n.prop)(),r.stale=(0,n.session)(!0),u(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"markStale",value:function(){this.stale=!0,this.hasObservers()&&this.find()}}]),t}();c.Collection="BusinessProfile",c.Proxy="businessProfile",c.idClass=a.default,t.default=(0,n.defineModel)(c);t.DEFAULTS={address:null,description:null,vertical:null,email:null,website:null}},dfbhcehadj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i("cgcgbfbffj"),o=u(n),a=u(i("eaejdgfgif")),s=u(i("djegeegcbf"));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"setVariant",value:function(e,t){var i=s.default.skinToneEmojis[e];if(!i)throw new Error("attempt to store variantless emoji");this.gadd({id:i,variant:t})}},{key:"getVariant",value:function(e){if(s.default.skinToneEmojis[e]){var t=this.get(e);return t?t.variant:null}throw new Error("attempt to get variantless emoji")}},{key:"getVariantIfExists",value:function(e){if(s.default.skinToneEmojis[e]){var t=this.get(e);return t?t.variant:null}return null}}]),t}();c.model=a.default,c.cachePolicy={id:"emoji_variant_collection",policy:n.CACHE_POLICY.LOAD,delay:1e3},t.default=new c},dfgeejdaib:function(e,t,i){"use strict";var r=g(i("dejffaagc")),n=g(i("beajagdaig")),o=g(i("iidhbgeed")),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),s=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},u=g(i("cgcgbfbffj")),c=g(i("cbcbdjdah")),l=g(i("biecbbiiee")),d=i("eacidghfgh"),f=g(d),h=g(i("ccaaiecfib")),p=g(i("bdiiahhjbe"));function g(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.syncPromise=null,e.isSynced=!1,e.listenTo(f.default,"change:stream",function(){f.default.stream===d.STREAM.DISCONNECTED&&(e.isSynced=!1)}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),a(t,[{key:"onResume",value:function(){this.isSynced=!1,this.sync()}},{key:"maySync",value:function(){return h.default.supportsFeature(h.default.F.STARRED_GIFS)}},{key:"sync",value:function(){var e=this;return this.isSynced?Promise.resolve():this.syncPromise?this.syncPromise:this.maySync()?(this.syncPromise=l.default.getStarred(void 0,void 0,void 0,!0).then(function(t){var i=[];t&&t.length&&(i=(0,o.default)(t,function(e){return e&&e.isGif&&!e.isUnsentMedia})),e.set(i)}).catch(function(e){499!==e&&p.default.error("starred gif msgs sync error: ",e)()}).finally(function(){e.syncPromise=null,e.isSynced=!0}),this.syncPromise):Promise.resolve()}},{key:"add",value:function(e,i){if(!e||!this.maySync()||!this.isSynced)return[];var r=this.isModel(e)?[e]:e;return r=(0,n.default)((0,o.default)(r,function(e){return e.isGif}),this.toArray(),function(e,t){return e.body===t.body}),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,r,i)}},{key:"remove",value:function(e,i){if(!e||!this.maySync()||!this.isSynced)return[];var n=this.isModel(e)?[e]:e;return n=(0,r.default)((0,o.default)(n,function(e){return e.isGif}),this.toArray(),function(e,t){return e.body===t.body}),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"remove",this).call(this,n,i)}}]),t}();y.model=c.default,y.comparator=function(e,t){return t.t-e.t},e.exports=new y},dfhgffbdig:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=p(i("dbdfbgehgj")),a=p(i("gbfffciea")),s=p(i("bjigbaghc")),u=p(i("fcedgihic")),c=p(i("ccaaiecfib")),l=p(i("iajeehcac")),d=p(i("beahjdfigf")),f=p(i("bfgbdiffgd")),h=i("dffedeegcb");function p(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var y=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,a=Array(n),s=0;s<n;s++)a[s]=arguments[s];return i=r=g(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.sendForNeededAddRequest=function(e){var t=r.parent.id,i=o.default.assertGet(t),n=i.groupMetadata.desc;(0,h.sendForNeededAddRequest)(e,i.formattedTitle||i.name,n,r.parent.id)},g(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),r(t,[{key:"initialize",value:function(){this.listenTo(this,"change:contact.name",this.sort),this.listenTo(a.default,"locale_change",this.sort)}},{key:"delete",value:function(){this.forEach(function(e){e.delete()}),this.stopListening(),this.reset()}},{key:"set",value:function(e,i){var r=i||{};return r.isParticipantCollectionAdd||(r.remove=!0),n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e,r)}},{key:"add",value:function(e,i){var r=i||{};return r.isParticipantCollectionAdd=!0,n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e,r)}},{key:"canAdd",value:function(){return!!this.iAmAdmin()}},{key:"canPromote",value:function(e){return!!e&&(!s.default.me.equals(e.id)&&(!!this.iAmAdmin()&&!e.isAdmin))}},{key:"canDemote",value:function(e){return!!e&&(!!this.iAmAdmin()&&(!s.default.me.equals(e.id)&&(!(c.default.supportsFeature(c.default.F.GROUPS_V_3)&&f.default.groupsV3&&e.isSuperAdmin)&&!!e.isAdmin)))}},{key:"canRemove",value:function(e){return!!e&&(!s.default.me.equals(e.id)&&!!this.iAmAdmin())}},{key:"canVerifyIdentity",value:function(e){return!!c.default.supportsFeature(c.default.F.QUERY_IDENTITY)&&(!!e&&!s.default.me.equals(e.id))}},{key:"iAmMember",value:function(){return 1===this.filter(function(e){return e.id.equals(s.default.me)}).length}},{key:"iAmRestrictedMember",value:function(){var e=this.parent.id;return o.default.assertGet(e).groupMetadata.restrict&&!this.iAmAdmin()}},{key:"iAmAdmin",value:function(){return 1===this.filter(function(e){return e.id.equals(s.default.me)&&e.isAdmin}).length}},{key:"iAmSuperAdmin",value:function(){return 1===this.filter(function(e){return e.id.equals(s.default.me)&&e.isSuperAdmin}).length}},{key:"getAdmins",value:function(){return this.where({isAdmin:!0})}}]),t}();y.model=l.default,y.comparator=d.default,t.default=y},dfjfgdhbjj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var i=e.pin||0,r=t.pin||0;if(i||r)return i!==r?i>r?-1:1:e.id.toString()<t.id.toString()?-1:1;var n=e.t||0,o=t.t||0;return n!==o?n>o?-1:1:e.id.toString()<t.id.toString()?-1:1}},dghggcieid:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=i("dcaifjegcg"),o=(r=n)&&r.__esModule?r:{default:r};function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),u=0;u<o;u++)s[u]=arguments[u];return i=r=a(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.id=(0,n.prop)(),r.weight=(0,n.prop)(),a(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),t}();s.Proxy="recentEmoji",t.default=(0,n.defineModel)(s)},dghjhchjic:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(i("dffgeedefc")),n=a(i("ccdbdjihjh")),o=a(i("cgcgbfbffj"));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),t}();s.model=n.default,s.comparator=function(e,t){return e.id===t.id?0:(0,r.default)(e.id,t.id)?-1:1},t.default=s},dhadcigcaf:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLOBAL_MUTE=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=v(i("ddhijeejag")),a=v(i("bdiiahhjbe")),s=v(i("jccfhaecf")),u=i("dcaifjegcg"),c=v(u),l=v(i("chajfbfiga")),d=v(i("gbfffciea")),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),h=v(i("djheacfeif")),p=i("ccihhdchab"),g=v(i("dgdjiicfdg")),y=i("hjbbdjjdf");function v(e){return e&&e.__esModule?e:{default:e}}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var _=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=b(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,u.prop)(),r.expiration=(0,u.prop)(0),r._unmuteTimer=(0,u.session)(),r.promises=(0,u.session)(function(){return{}}),r.isMuted=(0,u.derived)(r._isMuted,["expiration"]),b(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.default),r(t,[{key:"_isMuted",value:function(){return!!this.expiration}},{key:"initialize",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.expiration&&this.mute(this.expiration)}},{key:"setMute",value:function(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))}},{key:"mute",value:function(e,t,i){var r=this,n=e;if(!(0,y.isNumber)(n))return a.default.log("models:Mute:mute called with invalid expiration "+n)(),Promise.reject(new f.ActionError);(n=Math.round(n))>2e9&&a.default.log("models:Mute:mute called with wrong units?"+this.id.toString()+" exp:"+n)();var u=function(){if(this.isMuted&&this._clearUnmuteTimer(),-1===n)a.default.log("models:Mute:mute "+this.id.toString()+" muted, no expiration")();else{var e=n-(0,g.default)().unix();a.default.log("models:Mute:mute "+this.id.toString()+" duration:"+e)(),this._unmuteTimer=h.default.setGlobalTimeout(this.unmute.bind(this),1e3*n)}this.set({expiration:n})}.bind(this),c=s.default.isGroup(this.id);if(t){if(this.promises.mute)return this.promises.mute;var v=this.promises.mute=l.default.sendConversationMute(this.id,n,this.expiration),b=c?new p.ActionType(l10n.t("action_group_muting")):new p.ActionType(l10n.t("action_chat_muting")),_=i||(0,p.genId)(),m=this.promises.mute.catch(function(e){a.default.error("models:Mute:mute dropped")(e);var i=c?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed");throw new p.ActionType(i,l10n.t("action_try_again"),r.mute.bind(r,n,t,_))}).then(function(e){if(200===e.status){var i=c?l10n.t("action_group_muted"):l10n.t("action_chat_muted");return new p.ActionType(i,l10n.t("action_undo"),r.unmute.bind(r,t,_))}if(e.status>=400)throw c?new p.ActionType(l10n.t("action_group_mute_failed")):new p.ActionType(l10n.t("action_chat_mute_failed"))});return d.default.openToast(o.default.createElement(p.ActionToast,{id:_,initialAction:b,pendingAction:m})),v.then(function(e){200!==e.status||e._duplicate||u()}).finally(function(){r.promises.mute=null})}return u(),Promise.resolve()}},{key:"canMute",value:function(){return s.default.isGroup(this.id)||s.default.isUser(this.id)}},{key:"_clearUnmuteTimer",value:function(){h.default.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0}},{key:"unmute",value:function(e,t){var i=this,r=function(){a.default.log("models:Mute:unmute "+this.id.toString())(),this._clearUnmuteTimer()}.bind(this),n=s.default.isGroup(this.id);if(e){if(this.promises.unmute)return this.promises.unmute;var u=this.promises.unmute=l.default.sendConversationMute(this.id,!1,this.expiration),c=n?new p.ActionType(l10n.t("action_group_unmuting")):new p.ActionType(l10n.t("action_chat_unmuting")),f=t||(0,p.genId)(),h=this.promises.unmute.catch(function(t){a.default.error("models:Mute:unmute dropped")(t);var r=n?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed");return Promise.reject(new p.ActionType(r,l10n.t("action_try_again"),i.unmute.bind(i,e,f)))}).then(function(e){if(200===e.status)return n?new p.ActionType(l10n.t("action_group_unmuted")):new p.ActionType(l10n.t("action_chat_unmuted"));if(e.status>=400)throw n?new p.ActionType(l10n.t("action_group_unmute_failed")):new p.ActionType(l10n.t("action_chat_unmute_failed"))});return d.default.openToast(o.default.createElement(p.ActionToast,{id:f,initialAction:c,pendingAction:h})),u.then(function(e){200!==e.status||e._duplicate||r()}).finally(function(){i.promises.unmute=null})}return r(),Promise.resolve()}},{key:"delete",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.getCollection().remove(this.id),this._clearUnmuteTimer()}}]),t}();_.Collection="Mute",_.Proxy="mute",_.idClass=s.default,_.idWhitelist=["global_mute"],t.GLOBAL_MUTE="global_mute",t.default=(0,u.defineModel)(_)},dhefcajhhb:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=m(i("bebajedcaf")),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},a=m(i("bhggeigghg")),s=m(i("bjigbaghc")),u=m(i("bdiiahhjbe")),c=m(i("igdjeffe")),l=m(i("egjjcjcg")),d=m(i("chajfbfiga")),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),h=m(i("jccfhaecf")),p=i("dcbdjheea"),g=m(i("edjgaiicj")),y=m(i("ccaaiecfib")),v=i("cgcgbfbffj"),b=m(v),_=i("biahggehgf");function m(e){return e&&e.__esModule?e:{default:e}}var O=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,b.default),n(t,[{key:"get",value:function(e){var i=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"get",this).call(this,e);if(!this._model.prototype.isIdType(e))return i;var r=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"get",this).call(this,(0,g.default)(e.toString()));if(r){if(this.remove(r,{silent:!0}),i&&i.tag)return i;var n=r.toJSON();return n.id=e,this.add(n,{silent:!0,merge:!0})[0]}return i||void 0}},{key:"saveToCache",value:function(){if(s.default.me){var e=t.cachePolicy.id,i=this.filter(function(e){return h.default.isWid(e.id)&&!!e.eurl});i=i.map(function(e){var t=e.toJSON();return t.id=(0,g.default)(t.id.toString()),t}),u.default.log("models:profilePic:cache-save: "+String(e))(),l.default.setCollection(e,i)}}},{key:"initializeFromCache",value:function(e){if(this.length&&e){var t=this.reduce(function(e,t){return e[(0,g.default)(t.id.toString())]=t.id.toString(),e},new Object);if(!(0,r.default)(t)){var i=e.reduce(function(e,i){return t[i.id]&&(i.id=(0,p.createWid)(t[i.id]),i.stale=!0,e.push(i)),e},[]);this.add(i,{merge:!0})}}}},{key:"onResume",value:function(){var e=this.filter(function(e){var t=a.default.Chat.get(e.id);return e.hasObservers()&&e.stale&&(h.default.isUser(e.id)||h.default.isGroup(e.id))&&!(t&&t.isReadOnly)}).map(function(e){return e.tag||e.unset("tag",{silent:!0}),e});this.resyncPictures(e)}},{key:"_find",value:function(e){var t=a.default.Chat.get(e);if(t&&t.isReadOnly)return(0,_.profilePicFindThumbFromPhone)(e,this.get(e)).then(function(e){return e.tag||e.raw||(e.eurl=null,e.tag=null,e.raw=null,e.eurlStale=!1),e}).catch(f.ProtoVersionUndefined,function(){return{id:e,stale:!0}});if(h.default.isUser(e)||h.default.isGroup(e)){var i={id:e};return(0,_.profilePicFind)(e).then(function(e){return i.tag=e.tag,i.raw=null,i.eurl=e.eurl,i.eurlStale=!1,y.default.supportsFeature(y.default.F.MD_BACKEND),i}).catch(f.ServerStatusCodeError,function(e){switch(e.status){case 401:i.tag="",i.raw=void 0;break;case 423:case 429:i.stale=!0;break;default:i.tag=null,i.eurl=null,i.eurlStale=!1}return Promise.resolve(i)}).catch(f.WapDrop,function(){return{id:e,stale:!0}})}return Promise.resolve({id:e,tag:null})}},{key:"imageChanged",value:function(e,t){var i=this.get(e);i&&("remove"===t?i.set({tag:void 0,eurl:void 0}):i.tag!==t&&i.update().catch(f.WapDrop,function(){}))}},{key:"resyncPictures",value:function(e){var t=this;return 0===e.length?Promise.resolve():d.default.resyncPictures(e.map(function(e){return{id:e.id,tag:e.tag}})).then(function(i){if(423===i.status||429===i.status)u.default.warn("ProfilePicThumbStore:resyncPictures blocked "+i.status)();else{if("number"==typeof i.status&&i.status>=400)throw u.default.error("ProfilePicThumbStore:resyncPictures error "+i.status)(i),new Error("ProfilePicThumbStore:resyncPictures error");if(!Array.isArray(i))throw u.default.error("ProfilePicThumbStore:resyncPictures unknown reply",i)(),new Error("ProfilePicThumbStore:resyncPictures unknown reply");u.default.log("ProfilePicThumbStore:resyncPictures success")(),i.forEach(function(e){var i=t.get(e.id);i&&i.set({tag:e.tag,raw:void 0,stale:!1,eurl:e.eurl,eurlStale:!1})}),e.forEach(function(e){e.eurlStale&&e.update()}),e.forEach(function(e){e.stale=!1})}}).catch(f.WapDrop,function(){}).catch(function(e){u.default.error("ProfilePicThumbStore:resyncPictures dropped: "+String(e))()})}}]),t}();O.model=c.default,O.staleCollection=!0,O.resumeOnAvailable=!0,O.cachePolicy={id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:v.CACHE_POLICY.LOAD,delay:5e3},t.default=new O},dhggbbghfb:function(e,t,i){"use strict";var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=v(i("dfhjacfbjg")),o=v(i("cajijabhgb")),a=y(i("dbdfbgehgj")),s=y(i("eadfaddcj")),u=y(i("dhigahgdjb")),c=y(i("bdiiahhjbe")),l=y(i("ebbjbbjjg")),d=y(i("dhefcajhhb")),f=y(i("gbbacfeci")),h=y(i("bgcdajbhif")),p=i("dfhgeaeig"),g=i("dgdhcdgffe");function y(e){return e&&e.__esModule?e:{default:e}}function v(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}var b={handle:function(e){var t=r(e,1)[0];switch(t.type){case"const":s.default[t.key]=t.value;break;case"read":if(t.isStatus){h.default.handle([t]);break}case"unread":var i=a.default.get(t.jid);i&&("read"===t.type?(0,g.markSeen)(i):"unread"===t.type&&(0,g.markUnseen)(i));break;case"picture":d.default.imageChanged(t.jid,t.tag);break;case"log":n.upload("server-requested",!0,!0);break;case"privacy":if(t.jid){var y=l.default.get(t.jid);y&&y.reset(),d.default.update(t.jid).catch(o.WapDrop,function(){}),f.default.update(t.jid).catch(o.WapDrop,function(){})}else c.default.error("Store:Cmd:handle:privacy no jid",t)();break;case"identity":if(t.jid){var v=u.default.get(t.jid);v?(0,p.updateIdentity)(v,t):c.default.error("Store:Cmd:handle:identity no contact",t)()}else c.default.error("Store:Cmd:handle:identity no jid",t)();break;default:c.default.warn("Store:Cmd:handle:unknown "+t.type,t)()}}};e.exports=b},dhhbbaegif:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=c(i("gbfffciea")),a=c(i("fcedgihic")),s=c(i("iajeehcac")),u=c(i("beahjdfigf"));function c(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),r(t,[{key:"initialize",value:function(){this.listenTo(this,"change:contact.name",this.sort),this.listenTo(o.default,"locale_change",this.sort)}},{key:"delete",value:function(){this.forEach(function(e){e.delete()}),this.stopListening(),this.reset()}},{key:"set",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.isParticipantCollectionAdd||(i.remove=!0),n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e,i)}},{key:"add",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.isParticipantCollectionAdd=!0,n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e,i)}}]),t}();l.model=s.default,l.comparator=u.default,t.default=l},dhigahgdjb:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=E(i("eaaagccfda")),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},a=P(i("cajijabhgb")),s=E(i("gbfffciea")),u=E(i("eadfaddcj")),c=E(i("ccfcjccjbg")),l=E(i("ccicaaeiaa")),d=E(i("bdiiahhjbe")),f=E(i("cbeabehaca")),h=P(i("ebggjhghhi")),p=i("eacidghfgh"),g=E(p),y=i("cgcgbfbffj"),v=E(y),b=E(i("egjjcjcg")),_=i("cajejegicg"),m=i("cbecjajacd"),O=i("dhiccjfja");function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function E(e){return e&&e.__esModule?e:{default:e}}var j=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._contactHashes=new f.default,e.checksum=void 0,e._frequentContacts={},e._sort=(0,r.default)(function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"sort",e).call(e)},1e3),e._silentSort=(0,r.default)(function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"sort",e).call(e,{silent:!0})},1e3),e.listenTo(s.default,"locale_change",e.sort),e.listenTo(e,"change:name",e.sort),e.listenTo(g.default,"change:stream",function(){g.default.stream===p.STREAM.RESUMING&&e.forEach(function(e){e.unset("verificationString"),e.unset("verificationBinary")})}),e.listenTo(e,"add",e.contactAdded),e.listenTo(e,"remove",e.contactRemoved),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,v.default),n(t,[{key:"sort",value:function(e){return e&&e.silent?this._silentSort():this._sort()}},{key:"initializeFromCache",value:function(e){e&&(d.default.log("Store:Contact init from cache")(),this.add(e,{silent:!0,merge:!0}))}},{key:"contactAdded",value:function(e){this._contactHashes.put(e)}},{key:"contactRemoved",value:function(e){this._contactHashes.remove(e)}},{key:"delete",value:function(){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.setChecksum(),delete this.checksum,this._frequentContacts={},(0,m.setFrequent)({}).catch(function(){}),this._contactHashes.clear()}},{key:"isFilteredContact",value:function(e){return!!e.name&&!e.isMe&&!e.isPSA&&e.isWAContact}},{key:"getFilteredContacts",value:function(){return this.filter(function(e){return e.name&&!e.isMe&&!e.isPSA&&e.isWAContact})}},{key:"_find",value:function(e){var t=this.get(e);return t?Promise.resolve(t):Promise.resolve({id:e})}},{key:"_findQuery",value:function(e){return(0,O.contactFindQuery)(e)}},{key:"sync",value:function(){return this.findQuery({}).catch(a.WapDrop,function(){}),h.waitForBBEvent(this,u.default.COLLECTION_HAS_SYNCED)}},{key:"frequentContacts",value:function(e,t){var i=this,r=e&&this._frequentContacts[e];if(r||(r=this._frequentContacts.message),!r)return[];var n=t&&t.id;return r.map(function(e){return i.get(e)}).filter(function(e){return!!e&&!e.id.equals(n)})}},{key:"_getUserCount",value:function(){return this.map(function(e){return e.isUser?1:0}).reduce(function(e,t){return e+t},0)}},{key:"setChecksum",value:function(e){this.checksum=e,b.default.setContactChecksum(this.checksum),(0,_.setChecksum)(e).catch(function(){})}}]),t}();j.model=c.default,j.comparator=l.default,j.cachePolicy={id:"contact",policy:y.CACHE_POLICY.IMMEDIATE,trigger:"add\n        sort\n        remove\n        reset\n        change:id\n        change:name\n        change:shortName\n        change:pushname\n        change:type\n        change:verifiedName\n        change:isBusiness\n        change:isEnterprise\n        change:verifiedLevel\n        change:statusMute\n        change:sectionHeader\n        change:isContactBlocked\n        change:labels"},t.default=new j},dhjffabgfb:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickerCollection=t.FETCH_STATE=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=a(i("cgcgbfbffj")),o=a(i("cgfidiajgj"));function a(e){return e&&e.__esModule?e:{default:e}}t.FETCH_STATE={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};var s=t.StickerCollection=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.default),r(t,[{key:"fetch",value:function(e){throw new Error(this.constructor.name+".fetch is not implemented")}}]),t}();s.model=o.default,t.default=new s},diafggiefe:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=i("dcaifjegcg"),s=v(a),u=v(i("bdiihbaeaj")),c=v(i("bdiiahhjbe")),l=v(i("bffjfbgbg")),d=v(i("beeieigghj")),f=i("dgeebjciej"),h=i("fabajdgab"),p=i("ddgbhifaji"),g=i("cajijabhgb"),y=i("daichdjff");function v(e){return e&&e.__esModule?e:{default:e}}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var _=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),s=0;s<n;s++)o[s]=arguments[s];return i=r=b(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,a.prop)(),r.type=(0,a.prop)(),r.mediaUrl=(0,a.prop)(),r.blobUrl=(0,a.session)(),r.mediaData=(0,a.session)(),r.fetchedFromServer=(0,a.prop)(),r.old=(0,a.session)(!1),b(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"initialize",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.listenTo(this,"change:mediaUrl change:fetchedFromServer",this.triggerImageUpdate),this.triggerImageUpdate()}},{key:"triggerImageUpdate",value:function(){var e=this;if(this.fetchedFromServer&&this.mediaUrl){this.mediaData||this.addChild("mediaData",new l.default({mediaStage:y.STAGE.PREPARING}));var t={};(0,u.default)({retries:10,factor:1e3,maxTimeout:9e5,jitter:.25},function(t){return(0,h.fetchMedia)(e.mediaUrl).then(function(e){return e&&e.status>=200&&e.status<300?e:t(new g.CatalogImageDownloadError)})}).then(function(i){var o=i.result,a=d.default.createFromData(o,"image/jpeg");(0,p.prepRawMedia)(a,{}).waitForPrep().then(function(e){return t=n({},t,{mediaBlob:e.mediaBlob,type:e.type,mimetype:e.mimetype,fullWidth:e.fullWidth,fullHeight:e.fullHeight}),Promise.all([d.default.createFromBase64Jpeg(e.preview),d.default.createFromData(e.mediaBlob),(0,f.getHash)(e.mediaBlob)])}).then(function(i){var o=r(i,3),a=o[0],s=o[1],u=o[2];if(t=n({},t,{preview:a,mediaBlob:s,renderableUrl:s.url(),mediaStage:y.STAGE.RESOLVED,filehash:u}),u===e.mediaData.filehash)return Promise.resolve();e.mediaData.set(t)})}).catch(function(t){c.default.error("Failed to fetch "+e.mediaUrl,t)(),e.mediaData.set({mediaStage:y.STAGE.ERROR_MISSING})})}}},{key:"markOld",value:function(){this.old=!0}}]),t}();_.Proxy="productImage",t.default=(0,a.defineModel)(_)},diajeiidei:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(i("djfhiaaehb")),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),a=l(i("eadfaddcj")),s=l(i("cbcbdjdah")),u=l(i("biecbbiiee")),c=l(i("cgcgbfbffj"));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f="before",h="after",p=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=d(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.hasMediaBefore=!0,r.hasMediaAfter=!0,d(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.default),n(t,[{key:"delete",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.stopListening()}},{key:"contains",value:function(e){return this.includes(e)}},{key:"getAfter",value:function(e){var t=this.indexOf(e);return t<0||t===this.length-1?null:this.at(t+1)}},{key:"getBefore",value:function(e){var t=this.indexOf(e);return t<=0?null:this.at(t-1)}},{key:"loadEarlierMedias",value:function(){var e=this.head();e&&this.queryMedia(null,e)}},{key:"loadRecentMedias",value:function(){var e=this.last();e&&this.queryMedia(null,e,h)}},{key:"loadMoreAroundIfNeeded",value:function(e){if(e){var t=this.indexOf(e);t<20&&this.hasMediaBefore&&this.loadEarlierMedias(),this.length-t<20&&this.hasMediaAfter&&this.loadRecentMedias()}}},{key:"queryMedia",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;if(!t&&e){var s=e.msgs;if(!s||0===s.length)return this.hasMediaBefore=!1,new Promise(function(e){e({eof:!0})});this.add(s.filter(function(e){return e.isMedia&&!e.isProduct}),{at:0});var c=this.toArray();if(this.downloadMedias(c),e.msgs.msgLoadState.noEarlierMsgs)return this.hasMediaBefore=!1,new Promise(function(e){e({eof:!0})});if(c.length<=2*a.default.MEDIA_QUERY_LIMIT){var l=0===c.length?s.head():(0,r.default)(c);return this.queryMedia(e,l)}return new Promise(function(e){e({eof:!1})})}if(t&&n===f){if(this.queryMediaBefore)return this.queryMediaBefore;var d=0;return this.queryMediaBefore=u.default.queryMedia(t.id.remote,a.default.MEDIA_QUERY_LIMIT,n,t.isMedia?t.id:void 0).then(function(t){var r=t.messages;(!r||r.length<a.default.MEDIA_QUERY_LIMIT)&&(i.hasMediaBefore=!1);var n=[];r&&r.length>0&&(n=r.filter(function(e){return e.isMedia}),i.downloadMedias(n)),i.add(n,{at:0});var o={mediaCount:t.mediaCount,linkCount:t.linkCount,docCount:t.docCount};return e&&e.resetMediasCount(o),{length:d=n.length}}).catch(o.WapDrop,o.ProtoVersionUndefined,function(){}).catch(404,function(){}).finally(function(){i.queryMediaBefore=null,i.trigger("query_media_before",d)}),this.trigger("query_media_before",0),this.queryMediaBefore}if(t&&n===h)return this.queryMediaAfter?this.queryMediaAfter:this.queryMediaAfter=u.default.queryMedia(t.id.remote,a.default.MEDIA_QUERY_LIMIT,n,t.id).then(function(t){var r=t.messages;(!r||r.length<a.default.MEDIA_QUERY_LIMIT)&&(i.hasMediaAfter=!1);var n=[];r&&r.length>0&&(n=r.filter(function(e){return e.isMedia}),i.downloadMedias(n)),i.add(n);var o={mediaCount:t.mediaCount,linkCount:t.linkCount,docCount:t.docCount};return e&&e.resetMediasCount(o),{length:n.length}}).catch(o.WapDrop,o.ProtoVersionUndefined,function(){}).catch(404,function(){}).finally(function(){i.queryMediaAfter=null,i.trigger("query_media_after")})}},{key:"downloadMedias",value:function(e){e.forEach(function(e){e.downloadMedia()})}}]),t}();p.model=s.default,t.default=p},dieafdcbjb:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i("dcaifjegcg"),n=a(r),o=a(i("jccfhaecf"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){var e,i,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),u=0;u<o;u++)a[u]=arguments[u];return i=n=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),n.id=(0,r.prop)(),n.status=(0,r.prop)(),n.stale=(0,r.session)(!0),s(n,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.default),t}();u.Collection="Status",u.Proxy="status",u.idClass=o.default,t.default=(0,r.defineModel)(u)},djaadchjch:function(e,t,i){"use strict";var r=g(i("bgjcbiaddd")),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=g(i("bdiiahhjbe")),a=g(i("cgcgbfbffj")),s=g(i("fcfchiagj")),u=g(i("bhggeigghg")),c=g(i("chajfbfiga")),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),d=g(i("jccfhaecf")),f=i("dcbdjheea"),h=i("bjcegba"),p=i("biigiejiib");function g(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"onResume",value:function(){var e=this;(0,r.default)(u.default.Chat.where({active:!0}).filter(function(e){return e.isGroup||e.isBroadcast}),u.default.Chat.where({isBroadcast:!0})).forEach(function(t){e.find(t.id).catch(l.WapDrop,l.ProtoVersionUndefined,function(){})})}},{key:"_find",value:function(e){var t=this;if(d.default.isGroup(e)){var i=u.default.Chat.get(e);return i&&i.isReadOnly?(0,h.queryGroupFromPhone)(e):(0,p.sendQueryGroup)(e)}if(d.default.isBroadcast(e))return c.default.contactFindBroadcast(e).then(function(i){if(200===i.status){var r=t.get(e);return r&&!r.stale?Promise.resolve(r):{id:e,participants:i.recipients}}return 404===i.status?(o.default.error("models:GroupMetadataCollection:_find:False broadcast list query")(),{id:e}):(o.default.error("models:GroupMetadataCollection:_find:bclist error: "+i.status)(),Promise.reject(new Error("models:GroupMetadataCollection:_find:bclist error: "+i.status)))});var r="groupMetadata:find trying to fetch non-group/bclist wid "+e.toString();return o.default.log(r)(),Promise.reject(new Error(r))}},{key:"_handle",value:function(e){return e}},{key:"handlePendingInvite",value:function(e){var t=e.gid,i=e.participants;this.add({id:(0,f.createWid)(t),pendingParticipants:i},{merge:!0})}}]),t}();y.model=s.default,y.staleCollection=!0,e.exports=new y},djfhiceeje:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarredMsgCollection=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.addStarredMsgs=function(e){h.add(e),e.forEach(function(e){e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}),l.default.add(e)},t.removeStarredMsgs=p;var n=f(i("cbcbdjdah")),o=f(i("biecbbiiee")),a=i("eacidghfgh"),s=f(a),u=f(i("bdiiahhjbe")),c=f(i("eadfaddcj")),l=f(i("dfgeejdaib")),d=f(i("cgcgbfbffj"));function f(e){return e&&e.__esModule?e:{default:e}}var h=void 0;function p(e){h.remove(e),e.forEach(function(e){e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)})}var g=t.StarredMsgCollection=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.syncPromise=null,e.isSynced=!1,e.listenTo(s.default,"change:stream",function(){s.default.stream===a.STREAM.DISCONNECTED?e.isSynced=!1:s.default.stream===a.STREAM.CONNECTED&&e.delete()}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d.default),r(t,[{key:"process",value:function(e,t,i,r){r?this.delete():this.updateMsgs(e,t,i)}},{key:"sync",value:function(e){if(this.isSynced)return Promise.resolve();if(this.syncPromise)return this.syncPromise;var t=this,i=void 0,r=this.last();return r&&(i=r.id),this.syncPromise=o.default.getStarred(e,c.default.PAGE_SIZE,i).then(function(e){e.length&&t.add(e,{silent:!0}),e.length<c.default.PAGE_SIZE&&(t.isSynced=!0)}).catch(function(e){u.default.error("starred msg sync error: ",e)()}).finally(function(){t.syncPromise=null,t.trigger("sync")}),this.trigger("sync"),this.syncPromise}},{key:"updateMsgs",value:function(e,t,i){var r=this,n=this.syncPromise||Promise.resolve();this.syncPromise=n.then(function(){return e?(t.length>0?o.default.incrementalStarredUpdate(t):Promise.resolve([])).then(function(e){var t=e.concat(i);r.isSynced&&(r.add(t,{silent:!0}),l.default.add(e)),t.forEach(function(e){e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}),r.trigger("sync")}).catch(function(e){u.default.error("models:starred:update:error: ",e)()}):(p(t.concat(i).filter(function(e){return!e.star})),Promise.resolve())}).finally(function(){r.syncPromise=null})}},{key:"delete",value:function(){this.isSynced=!1,function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this)}}]),t}();g.model=n.default,g.comparator=function(e,t){return t.t-e.t},h=new g,t.default=h},djjeigcdbe:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=new RegExp("[A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]")},eaejdgfgif:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=i("dcaifjegcg"),o=(r=n)&&r.__esModule?r:{default:r};function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),u=0;u<o;u++)s[u]=arguments[u];return i=r=a(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.id=(0,n.prop)(),r.variant=(0,n.prop)(),a(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),t}();s.Proxy="emojiVariant",t.default=(0,n.defineModel)(s)},eaejieeafc:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=i("dcaifjegcg"),o=(r=n)&&r.__esModule?r:{default:r};function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var s=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),u=0;u<o;u++)s[u]=arguments[u];return i=r=a(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),r.id=(0,n.prop)(),r.parentType=(0,n.prop)(),r.parentId=(0,n.prop)(),r.labelId=(0,n.prop)(),a(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),t}();s.Collection="LanelItemCollection",s.Proxy="labelItem",t.default=(0,n.defineModel)(s)},ebbjbbjjg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=l(i("bjigbaghc")),a=l(i("igjghefdb")),s=l(i("cgcgbfbffj")),u=l(i("jccfhaecf")),c=i("cbgjbaaigi");function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),n(t,[{key:"_find",value:function(e){return!this.gadd(e).isUser||u.default.isServer(e)||u.default.isPSA(e)?Promise.resolve({id:e}):(0,c.subscribePresence)(e).then(function(){return{id:e}})}},{key:"handle",value:function(e){var t=r(e,1)[0];if(!o.default.me.equals(t.id)){var i=this.get(t.id);i&&("unsubscribe"===t.type?i.set({isSubscribed:!1,stale:!0}):(i.handle(t),i.stale=!1))}}},{key:"clearAllPresence",value:function(){this.forEach(function(e){e.reset(),e.set({stale:!0,isSubscribed:!1})})}}]),t}();d.model=a.default,d.staleCollection=!0,t.default=new d},ebcagbhefg:function(e,t,i){"use strict";var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=i("cgcgbfbffj"),a=l(o),s=i("debjjaigad"),u=l(s),c=l(i("eadfaddcj"));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),r(t,[{key:"initializeFromCache",value:function(e){var t=e||[];this.add([{id:s.DEFAULT_PREFERENCE,wallpaperColor:c.default.DEFAULT_CHAT_WALLPAPER,saveToCameraRoll:!0}].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(t)),{merge:!0})}},{key:"get",value:function(e){return n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"get",this).call(this,e)||n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"get",this).call(this,s.DEFAULT_PREFERENCE)}},{key:"delete",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.add({id:s.DEFAULT_PREFERENCE,wallpaperColor:c.default.DEFAULT_CHAT_WALLPAPER,saveToCameraRoll:!0})}}]),t}();d.model=u.default,d.cachePolicy={id:"chat_preference",policy:o.CACHE_POLICY.LOAD,delay:1e3},e.exports=new d},ebjaejiaba:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CHAT_KIND=t.KIND=void 0;var r=be(i("cjjebecgeb")),n=be(i("ddgaeajhag")),o=be(i("diibgbjaeh")),a=be(i("eicihhaba")),s=be(i("hajciceai")),u=be(i("bhdddbafig")),c=be(i("bgejacgfdg")),l=be(i("bcdejiigcg")),d=be(i("ddfeabiaci")),f=be(i("begjbhhee")),h=be(i("iidhbgeed")),p=be(i("dbafiicfja")),g=be(i("bebajedcaf")),y=be(i("djfhiaaehb")),v=be(i("ddjgcdciii")),b=be(i("chihjdheic")),_=be(i("eaaagccfda")),m=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),O=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},P=ve(i("cajijabhgb")),E=ve(i("ebggjhghhi")),j=i("djfhiceeje"),T=be(j),M=be(i("eadfaddcj")),S=be(i("bdiiibjcij")),C=be(i("caedaejadb")),w=be(i("diajeiidei")),k=be(i("dbfjecijha")),A=be(i("chbjajaddg")),I=be(i("bjebjijbfc")),L=be(i("gbfffciea")),R=be(i("bjigbaghc")),N=be(i("beecadabde")),D=be(i("ccbihadedf")),F=be(i("cijheiibhg")),G=be(i("ccaaiecfib")),U=be(i("ecjehifjdd")),x=be(i("bdiiahhjbe")),Y=be(i("bfbggcdbfb")),B=be(i("cbcbdjdah")),V=be(i("biecbbiiee")),q=i("ccbagdhfbb"),H=be(i("ccgjijjbbj")),K=be(i("dagdiahdfi")),W=be(i("dhefcajhhb")),z=be(i("ddhijeejag")),J=be(i("eacidghfgh")),Q=be(i("bhggeigghg")),X=be(i("ccehadbeci")),Z=be(i("bgabgddgch")),$=be(i("egjjcjcg")),ee=be(i("jccfhaecf")),te=be(i("chajfbfiga")),ie=be(i("edjgaiicj")),re=be(i("cfejjfjhca")),ne=be(i("cahfddcdga")),oe=be(i("cgfjebhhej")),ae=i("ccihhdchab"),se=i("dcaifjegcg"),ue=i("ddgbhifaji"),ce=i("bcjidabgad"),le=i("dcbafbaejf"),de=i("icbibjcg"),fe=i("eahbfdfee"),he=i("cgddafdgie"),pe=i("bhjegffigh"),ge=i("eabhibhged"),ye=i("dcjbdhhjge");function ve(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function be(e){return e&&e.__esModule?e:{default:e}}function _e(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var me=t.KIND={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"};t.CHAT_KIND=me;var Oe=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=_e(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,se.prop)(),r.t=(0,se.prop)(),r.unreadCount=(0,se.prop)(0),r.archive=(0,se.prop)(),r.isReadOnly=(0,se.prop)(),r.isAnnounceGrpRestrict=(0,se.prop)(),r.modifyTag=(0,se.prop)(),r.muteExpiration=(0,se.prop)(0),r.name=(0,se.prop)(),r.notSpam=(0,se.prop)(),r.pin=(0,se.prop)(),r.changeNumberOldJid=(0,se.prop)(),r.changeNumberNewJid=(0,se.prop)(),r.lastReceivedKey=(0,se.prop)(),r.createdLocally=(0,se.session)(),r.pendingAction=(0,se.session)(),r.formattedTitle=(0,se.session)(),r.active=(0,se.session)(),r.pausedTimerId=(0,se.session)(),r.presenceResendTimerId=(0,se.session)(),r.recording=(0,se.session)(),r.typing=(0,se.session)(),r.colors=(0,se.session)(),r.composeContents=(0,se.session)(function(){return{}}),r.composeAttachMediaContents=(0,se.session)(),r.squelch=(0,se.session)(),r.pendingSeenCount=(0,se.session)(0),r.unreadMsgAnchor=(0,se.session)(),r.markedUnread=(0,se.session)(),r.trusted=(0,se.session)(),r.canSend=(0,se.session)(),r.promises=(0,se.session)(function(){return{}}),r.ftsCache=(0,se.session)(function(){return{}}),r.composeQuotedMsg=(0,se.session)(),r.composeQuotedMsgRemoteJid=(0,se.session)(),r.quotedMsgAdminGroupJid=(0,se.session)(),r.groupMetadata=(0,se.session)(),r.presence=(0,se.session)(),r.mute=(0,se.session)(),r.contact=(0,se.session)(),r.liveLocation=(0,se.session)(),r.liveLocationQueried=(0,se.session)(!1),r.ackedProps=(0,se.session)(function(){return{}}),r.mediaCount=(0,se.session)(0),r.linkCount=(0,se.session)(0),r.docCount=(0,se.session)(0),r.vcardDismissed=(0,se.session)(!1),r.kind=(0,se.derived)(r._kind),r.isUser=(0,se.derived)(r._isUser),r.isPSA=(0,se.derived)(r._isPSA),r.isGroup=(0,se.derived)(r._isGroup),r.isBroadcast=(0,se.derived)(r._isBroadcast),r.hasUnread=(0,se.derived)(r._hasUnread,["unreadCount"]),r.shouldShowUnreadDivider=(0,se.derived)(r._shouldShowUnreadDivider,["unreadCount","unreadMsgAnchor"]),r.isVisible=(0,se.derived)(r._isVisible,["createdLocally","msgs","msgsLength"]),r.previewMessage=(0,se.derived)(r._previewMessage,["msgs","msgsChanged"]),r.showChangeNumberNotification=(0,se.derived)(r._showChangeNumberNotification,["changeNumberOldJid","changeNumberNewJid","id","isUser"]),_e(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,X.default),m(t,[{key:"initialize",value:function(){var e=this;O(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this._addQueue=new U.default,this._sendQueue=new U.default,this._promises=null,this.msgs.msgLoadState.contextLoaded=!0,this.isVisible||(this.msgs.msgLoadState.noEarlierMsgs=!0),this.addChild("presence",Q.default.Presence.gadd(this.id));var i=K.default.get(this.id);if(i?this.addChild("mute",i):this.addChild("mute",K.default.gadd({id:this.id,expiration:this.muteExpiration})),this.listenTo(this.mute,"change:expiration",this.updateMuteExpiration),this.addChild("contact",Q.default.Contact.gadd(this.id)),this.name&&!this.contact.name){var r={name:this.name};(0,ye.updateLocal)(this.contact.id,r).then(function(){e.contact.set(r)})}if(this.listenTo(this.contact,"change:name",this.updateTitle),this.listenTo(this.contact,"change:isContactBlocked",this.updateCanSend),this.isGroup&&(this.trusted=!0),this.isGroup||this.isBroadcast){var n=void 0;this.isBroadcast&&!Q.default.GroupMetadata.get(this.id)&&(n=!0),this.addChild("groupMetadata",Q.default.GroupMetadata.gadd(this.id)),this.listenTo(this.groupMetadata,"change:stale change:announce",this.updateIsAnnounceGrpRestrict),this.listenTo(this.groupMetadata.participants,"change:isAdmin add remove",this.updateIsAnnounceGrpRestrict),this.listenTo(this.groupMetadata,"change:trusted change:stale",this.isTrusted),this.listenTo(this.groupMetadata,"change:participants change:stale",this.updateReadOnly),this.listenTo(this.groupMetadata.participants,"change:contact.formattedShortName",this.updateTitle),this.updateReadOnly(),this.updateIsAnnounceGrpRestrict();var o=this.id;this.listenTo(this,"change:isReadOnly",function(){this.isTrusted(),this.updateCanSend(),W.default.update(o).catch(P.WapDrop,function(){}),Q.default.GroupMetadata.update(o).catch(P.WapDrop,function(){})}),this.listenTo(this,"change:isAnnounceGrpRestrict",this.updateCanSend),n&&Q.default.GroupMetadata.update(o).catch(P.WapDrop,function(){})}else this.listenTo(this.presence,"change:isOnline",function(){return(0,de.presenceOnlineChanged)(e)}),this.listenTo(this.contact,"change:isMyContact",this.isTrusted);var a=this.getCollection();a.notSpam[this.id]&&!this.notSpam&&(0,le.sendNotSpam)(this).catch(function(){}),a.notSpam[this.id]=!!this.notSpam,this.notSpam||this.listenTo(this,"change:notSpam",this.onNotSpamChange),this.updateTitle(),this.isTrusted(),this.updateCanSend(),this.listenTo(this.msgs,"add",this.onNewMsg),this.listenTo(this.msgs,"update_sort_time",this.updateSortTime),this.listenTo(this.msgs,"bulk_add",this.addMediaMsgs),this.listenTo(this,"change:msgs",this.resetMediaMsgs),this._saveAssignedColors=(0,_.default)(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this.onActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:t change:modifyTag",this._clearFtsCache)}},{key:"_kind",value:function(){return ee.default.isGroup(this.id)?me.GROUP:ee.default.isBroadcast(this.id)?me.BROADCAST:ee.default.isUser(this.id)?me.CHAT:void x.default.log("chat:unknown kind id:"+this.id.toString())()}},{key:"_isUser",value:function(){return ee.default.isUser(this.id)}},{key:"_isPSA",value:function(){return ee.default.isPSA(this.id)}},{key:"_isGroup",value:function(){return ee.default.isGroup(this.id)}},{key:"_isBroadcast",value:function(){return ee.default.isBroadcast(this.id)}},{key:"_hasUnread",value:function(){return 0!==this.unreadCount}},{key:"_shouldShowUnreadDivider",value:function(){if(0===this.unreadCount)return!1;if(this.unreadMsgAnchor){var e=this.unreadMsgAnchor.msgChunk.getModelsArray();return this.unreadMsgAnchor!==(0,b.default)(e,{isUnreadType:!0})}return!this.msgs.msgLoadState.noEarlierMsgs||this.msgs.filter(function(e){return e.isUnreadType}).length!==this.unreadCount}},{key:"_isVisible",value:function(){if(this._isVisibleLatched)return!0;if(ee.default.isStatusV3(this.id))return!1;var e=this.msgs.length>0&&this.msgs.some(function(e){var t=e.from===R.default.me&&e.type===M.default.MSG_TYPE.GROUPS_V4_INVITE,i=e.type===M.default.MSG_TYPE.E2E_NOTIFICATION;return!t&&!i});return this._isVisibleLatched=!this.createdLocally||e,this._isVisibleLatched}},{key:"_previewMessage",value:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&t.type!==M.default.MSG_TYPE.E2E_NOTIFICATION)return t}return this.msgs.last()}},{key:"_showChangeNumberNotification",value:function(){if(!G.default.supportsFeature(G.default.F.CHANGE_NUMBER_V_2))return!1;var e=this.changeNumberOldJid,t=this.changeNumberNewJid,i=this.id;if(!this.isUser)return!1;if(!e&&!t)return!1;var r=t||i,n=Q.default.Contact.get(r);return!n||!n.isMyContact}},{key:"set",value:function(e,i,r){return"string"==typeof e?"muteExpiration"===e&&this.mute&&this.mute.setMute(i):e.hasOwnProperty("muteExpiration")&&this.mute&&this.mute.setMute(e.muteExpiration),O(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e,i,r)}},{key:"addPendingAction",value:function(e){var t=this;if(e.isPending()){var i=function(){t.decPending()};e.then(i,i),this.pendingAction++}}},{key:"decPending",value:function(){this.pendingAction>0?this.pendingAction--:(x.default.log("chat:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)}},{key:"onActiveUpdate",value:function(){this.isGroup&&this.active&&(this.squelch=-1),this.presence.chatActive=this.active}},{key:"onPendingActionUpdate",value:function(){this.pendingAction<0&&(x.default.log("chat:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)}},{key:"onNotSpamChange",value:function(){this.getCollection().notSpam[this.id]=this.notSpam,this.isTrusted(),this.notSpam&&this.stopListening(this,"change:notSpam")}},{key:"hasMaybeSentMsgToChat",value:function(){return(0,v.default)(this.getAllMsgs(),function(e){return e.isSentByMe})}},{key:"isTrusted",value:function(){var e=!1;return this.isGroup?e=this.isReadOnly||this.notSpam||this.groupMetadata.isTrusted():this.isBroadcast?e=!0:this.isUser&&(e=this.notSpam||this.contact.isMyContact),!e&&this.hasMaybeSentMsgToChat()&&(e=!0),this.trusted=e}},{key:"updateMuteExpiration",value:function(){var e=this,t=Number(this.mute.expiration);(0,pe.updateLocal)(this.id,{muteExpiration:t}).then(function(){return e.muteExpiration=t})}},{key:"updateTitle",value:function(){this.isBroadcast?this.formattedTitle=this.contact.name||this.groupMetadata.participants.map(function(e){return e.contact.formattedShortName}).join(", "):this.isUser?this.formattedTitle=this.contact.getFormattedUser()||"":this.isGroup&&(this.formattedTitle=this.contact.name)}},{key:"title",value:function(){return this.isGroup?this.formattedTitle||l10n.t("unknown_subject"):this.formattedTitle}},{key:"updateCanSend",value:function(){return this.isReadOnly||this.isAnnounceGrpRestrict?this.canSend=!1:this.isUser?this.canSend=!(this.contact.isContactBlocked||this.isPSA):this.canSend=!0}},{key:"delete",value:function(){O(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.getCollection().remove(this.id),this.cancelPendingPromises(),this.presence.delete(),this.liveLocation&&this.liveLocation.delete(),L.default.clearChat(this),this.groupMetadata&&this.groupMetadata.delete(),this.mediaMsgs&&this.mediaMsgs.delete(),this.linkMsgs&&this.linkMsgs.delete(),this.docMsgs&&this.docMsgs.delete();var e=this.starredMsgs;e&&(e.delete(),e.stopListening(),e.reset()),this.receivedVCardMsgs&&this.receivedVCardMsgs.delete(),$.default.deleteComposeContents(this.id)}},{key:"isDirty",value:function(){return 0!==this.unreadCount}},{key:"resetMediaMsgs",value:function(){var e=this.mediaMsgs,t=this.linkMsgs,i=this.docMsgs;e&&(e.delete(),e.queryMedia(this)),t&&(t.delete(),t.queryLinks(this)),i&&(i.delete(),i.queryDocs(this))}},{key:"addMediaMsgs",value:function(e,t){if(e){var i=Array.isArray(e)?e:[e],r=[],n=[],o=[];i.forEach(function(e){e.isMedia&&r.push(e),e.isDoc&&o.push(e),e.linkPreview&&n.push(e)}),this.mediaMsgs&&r.length&&this.mediaMsgs.add(r,t),this.linkMsgs&&n.length&&this.linkMsgs.add(n,t),this.docMsgs&&o.length&&this.docMsgs.add(o,t)}}},{key:"onNewMsg",value:function(e){var t=this;if(e){var i=Promise.resolve();e.isSentByMe&&!this.notSpam&&(i=(0,pe.updateLocal)(this.id,{notSpam:!0}).then(function(){return t.notSpam=!0})),"i"!==e.eventType&&i.then(function(){var i={};return i.t=e.t,t.promises.updateSortTime&&t.promises.updateSortTime.cancel(),t.updateMediasCountOnMsg(e),t.archive&&(i.archive=!1),t.promises.setArchive&&t.promises.setArchive.cancel(),e.isSentByMe?t.markedUnread=!1:(t.presence.handle({id:t.id,participant:e.author,type:"paused"}),"a"!==e.eventType&&"d"!==e.eventType||(i.unreadCount=t.unreadCount+1||1)),(0,pe.updateLocal)(t.id,i).then(function(){return i})}).then(function(i){e.isSentByMeFromWeb&&e.promises.sendPromise?t.setAndKeepPrevious(i,e.promises.sendPromise):t.set(i);var r=D.default.get(t.id);if(r&&(r.timestamp=I.default.globalUnixTime()),"gp2"!==e.type||"add"!==e.subtype&&"create"!==e.subtype||Q.default.GroupMetadata.trigger("group_participant_change_"+R.default.me.toString(),t.id),!e.isSentByMe){switch(e.eventType){case"d":case"a":"d"===e.eventType&&L.default.alertNewMsg(e),t.msgs.length<M.default.MSG_PRELOAD_THRESHOLD&&t.loadEarlierMsgs(void 0,Y.default.WEBC_QUERY_TRIGGER_TYPE.NEW_MESSAGE_PREFETCH).catch(P.E404,function(){}).catch(function(e){x.default.log("chat:onNewMsg failed")(),x.default.log(e)()});break;case"s":if("gp2"===e.type&&"add"===e.subtype&&R.default.me.equals((0,y.default)(e.recipients))&&!t.contact.name)return;L.default.alertNewMsg(e),Q.default.GroupMetadata.trigger("group_participant_change_"+R.default.me.toString(),t.id)}var n=e.mediaData;!n||"image"!==n.type&&"video"!==n.type||L.default.newMediaMsg(e)}})}}},{key:"canPin",value:function(){if(this.archive)return!1;var e=this.promises&&this.promises.setArchive;return(!e||!e.archive)&&G.default.supportsFeature(G.default.F.PIN)}},{key:"canArchive",value:function(){return!this.isBroadcast||G.default.supportsFeature(G.default.F.ARCHIVE_BROADCAST)}},{key:"sendDismissChangeNumber",value:function(){var e=this;if(this.promises.sendDismissChangeNumber)return this.promises.sendDismissChangeNumber;var t=te.default.sendConversationDismissChangeNumber(this.id);this.promises.sendDismissChangeNumber=t;var i=new ae.ActionType(l10n.t("action_chat_dismissing_change_number_notification")),r=t.then(function(e){return 200===e.status?new ae.ActionType(l10n.t("action_chat_dismissed_change_number_notification")):e.status>=400?new ae.ActionType(l10n.t("action_chat_dismiss_change_number_notification_failed")):void 0}).catch(function(t){return x.default.error("models:chat:sendDismissChangeNumber dropped")(t),new ae.ActionType(l10n.t("action_chat_dismiss_change_number_notification_failed"),l10n.t("action_try_again"),e.sendDismissChangeNumber.bind(e))});return L.default.openToast(z.default.createElement(ae.ActionToast,{id:(0,ae.genId)(),initialAction:i,pendingAction:r})),t.then(function(t){if(200===t.status&&!t._duplicate)return(0,pe.updateLocal)(e.id,{changeNumberNewJid:void 0,changeNumberOldJid:void 0}).then(function(){e.changeNumberOldJid=e.changeNumberNewJid=void 0})}).finally(function(){e.promises.sendDismissChangeNumber=null})}},{key:"setComposeContents",value:function(e){this.composeContents=e}},{key:"getSessionPersistedComposeContents",value:function(){return $.default.getComposeContents(this.id)}},{key:"getComposeContents",value:function(){return(0,g.default)(this.composeContents)?this.getSessionPersistedComposeContents()||{}:this.composeContents}},{key:"setComposeAttachMediaContents",value:function(e){this.composeAttachMediaContents=e}},{key:"preload",value:function(){1===this.msgs.length&&this.loadEarlierMsgs().catch(P.E404,function(){}).catch(function(e){x.default.log("chat:preload failed")(),x.default.log(e)()})}},{key:"onEmptyMRM",value:function(){x.default.log("models:Chat:removeMsg 0 messages left, querying...")(),this.loadEarlierMsgs().catch(P.E404,function(){}).catch(function(e){x.default.log("chat:onEmptyMRM failed")(),x.default.log(e)()})}},{key:"loadEarlierMsgs",value:function(e,t){var i=this,r=e,n=t||Y.default.WEBC_QUERY_TRIGGER_TYPE.USER_SCROLL;return r||(r=this.msgs),r.msgLoadState.noEarlierMsgs?Promise.resolve():r.msgLoadState.isLoadingEarlierMsgs?r.loadEarlierPromise:this._loadMsgs("before",r,n).then(function(e){return r&&Array.isArray(e)&&e.length<M.default.PAGE_SIZE&&(r.msgLoadState.noEarlierMsgs=!0),r&&i.isMostRecentCMC(r)&&i.trigger("msgs:loadEarlier"),e})}},{key:"isMostRecentCMC",value:function(e){return this.msgs===e}},{key:"loadRecentMsgs",value:function(e){var t=e;return t||(t=this.msgs),this.isMostRecentCMC(t)?Promise.resolve():t.msgLoadState.isLoadingRecentMsgs?t.loadRecentPromise:this._loadMsgs("after",t,Y.default.WEBC_QUERY_TRIGGER_TYPE.USER_SCROLL)}},{key:"_loadMsgs",value:function(e,t,i){var r=void 0,n={};(r="after"===e?t.last():t.head())?n=r.id.clone():n.remote=this.id,n.count=M.default.PAGE_SIZE,n.direction=e;var o=(0,fe.newMessageQueryEvent)(i);return this._loadMsgsPromiseLoop(r,t,V.default.findQuery.bind(V.default,n,{logOnSend:function(e){o.webcResponseBytes+=e.binarySize}}),e,o)}},{key:"_updateMsgLoadState",value:function(e,t,i){var r=e&&e.msgChunk&&e.msgChunk!==t;t.msgLoadState.contextLoaded=!0,e&&r&&(e.msgChunk.msgLoadState.contextLoaded=!0),"after"===i?t.msgLoadState.isLoadingRecentMsgs=!1:"before"===i?t.msgLoadState.isLoadingEarlierMsgs=!1:"around"===i&&(t.msgLoadState.isLoadingAroundMsgs=!1)}},{key:"_loadMsgsPromiseLoop",value:function(e,t,i,r,n){var o=this,a=performance.now();"after"===r?(t.msgLoadState.isLoadingRecentMsgs=!0,n.webcMessageQueryType=Y.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_NEXT):"before"===r?(t.msgLoadState.isLoadingEarlierMsgs=!0,n.webcMessageQueryType=Y.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_PREV):"around"===r&&(t.msgLoadState.isLoadingAroundMsgs=!0,n.webcMessageQueryType=Y.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_AROUND),n.webcBrowserNetworkType=(0,ce.getEffectiveNetworkType)(),n.webcChatType=this.getWebcChatType(),"number"==typeof this.initialIndex&&(n.webcChatPosition=this.initialIndex);var s=Promise.loop(function(s,u,c){var l=Promise.delay(Z.default.expBackoff(c,12e4,1e3,.1));return("CONNECTED"===J.default.stream?Promise.resolve():E.waitForBBEvent(J.default,"change:stream",function(){return"CONNECTED"===J.default.stream})).then(function(){return o.regCancellablePromise(i()).then(function(i){n.webcQueryT=Math.ceil(performance.now()-a);var u=void 0;Array.isArray(i[0])?(u=i[0][0],i.forEach(function(e){return(0,fe.logMessageCounts)(n,e)})):(u=i[0],(0,fe.logMessageCounts)(n,i)),u&&(n.webcEarliestMessageT=u.t,u.msgChunk===o.msgs&&(n.webcEarliestMessageIndex=o.msgs.length-1)),(0,F.default)().then(function(e){e&&(n.webcBrowserStorageQuotaBytes=e.quota,n.webcBrowserStorageQuotaUsedBytes=e.usage)}).finally(function(){return n.commit()}),o._updateMsgLoadState(e,t,r),s(i)})}).catch(function(e){return!(e instanceof Promise.CancellationError)},function(i){return c>3||404===i?(o._updateMsgLoadState(e,t,r),x.default.error("chat:loadMsgs:error "+String(i))(),404===i?Promise.reject(new P.E404):Promise.reject(new P.GaveUpRetry("Gave up msg fetch after "+c+" tries"))):l})},0);return"after"===r?t.loadRecentPromise=s:"before"===r?t.loadEarlierPromise=s:"around"===r&&(t.loadAroundPromise=s),s}},{key:"getSearchContext",value:function(e,t){var i=this,r=void 0,n=void 0;e instanceof B.default?r=e:e instanceof H.default&&(n=e);var o=r?r.msgChunk:void 0,a=Math.trunc(M.default.PAGE_SIZE/3*2);if(!o||!o.msgLoadState.contextLoaded){o||(o=new k.default,this.msgChunks.push(o),r&&o.add(r));var s=r?r.id.clone():n.clone();s.count=a;var u=function(){if(r)return r.msgChunk;var e=V.default.get(n);return e&&e.msgChunk?e.msgChunk:o},c=(0,fe.newMessageQueryEvent)(Y.default.WEBC_QUERY_TRIGGER_TYPE.SEARCH_RESULT_CLICK);this._loadMsgsPromiseLoop(r,o,V.default.getContext.bind(V.default,s,u,function(e){c.webcResponseBytes+=e.binarySize}),"around",c).then(function(e){var t=u();t&&o&&t!==o&&i.notifyMsgCollectionMerge(t,o,t);var s=e[0],c=n?V.default.get(n):r;c&&Array.isArray(s)&&s.length<a&&(c.msgChunk.msgLoadState.noEarlierMsgs=!0,o&&c.msgChunk!==o&&(o.msgLoadState.noEarlierMsgs=!0))}).catch(function(){t&&(t.isQuotedMsgAvailable=!1)})}return{collection:o,msg:r,key:n,highlightMsg:!0}}},{key:"sendStarMsgs",value:function(e,t){var i=this;return this.promises.sendStarMsgs?this.promises.sendStarMsgs:this.promises.sendStarMsgs=(0,ge.sendStarMsgs)(this.id,e,t).then(function(){e.forEach(function(e){e.set("star",t)}),t?(0,j.addStarredMsgs)(e):(0,j.removeStarredMsgs)(e)}).finally(function(){i.promises.sendStarMsgs=null})}},{key:"sendRevokeMsgs",value:function(e,t){var i=this;return this.promises.sendRevokeMsgs?this.promises.sendRevokeMsgs:this.promises.sendRevokeMsgs=Promise.all(e.map(function(e){return e.sendRevoke(t)})).finally(function(){i.promises.sendRevokeMsgs=null})}},{key:"sendDeleteMsgs",value:function(e,t){var i=this;return this.promises.sendDeleteMsgs?this.promises.sendDeleteMsgs:this.promises.sendDeleteMsgs=te.default.sendMessageDelete(this.id,(0,p.default)(e,function(e){return e.id}),t).then(function(t){var i=[];return 200===t.status?(e.forEach(function(e){e.delete()}),e.length):(t.status>=400&&(i=(0,h.default)(e,function(e){return-1===e.ack&&(e.delete(),!0)})),i.length)}).finally(function(){i.promises.sendDeleteMsgs=null})}},{key:"deleteMsgs",value:function(e,t){this.deleteMsgsBeforeMsgInclusive(void 0,!e,t)}},{key:"deleteMsgsOlderThan",value:function(e,t,i){var r=this.msgs,n=r.head();if(n&&!(n.t>=e))if((n=r.last())&&n.t<e)this.deleteMsgs(t,i);else{this.deleteMsgsPartial(function(r,n,o){return r&&(i&&!(0,q.msgMatchesType)(r,i)||r.star&&!t||r.t>=e||r.isPersistent)})}}},{key:"deleteMsgsBeforeMsgInclusive",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments[2],r=void 0;if(e){if(!this.msgs.get(e.id))return;r=this.msgs.indexOf(e)}else r=this.msgs.length;this.deleteMsgsPartial(function(e,n,o){return i&&!(0,q.msgMatchesType)(e,i)||e.msgChunk===this.msgs&&n>r||t&&e.star||e.isPersistent&&t},!0)}},{key:"deleteMsgsPartial",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.unreadCount;if(this.getAllCMCs().forEach(function(r){var n=r.filter(function(i,r,n){return!e.apply(t,[i,r,n])});r.remove(n,void 0,i),n.forEach(function(e){e.delete()})}),(0,f.default)(this.msgChunks).forEach(function(e){0===e.length&&t.removeMsgsCollection(e)}),this.msgs.length>0){var n=r>this.msgs.length?this.msgs.length:r;(0,pe.updateLocal)(this.id,{unreadCount:n}).then(function(){t.unreadCount=n,t.msgs.msgLoadState.noEarlierMsgs=!0})}}},{key:"getFirstMsgWithStatus",value:function(){return(0,b.default)(this.msgs.getModelsArray(),function(e){return!e.isNotification&&(e.isSentByMe||e.type===M.default.MSG_TYPE.PTT)})}},{key:"getLastReceivedMsg",value:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&(!t.local||t.ack>0))return t}}},{key:"getLastMsgKeyForAction",value:function(){var e=this.msgs.last();if(e)return!this.lastReceivedKey||e.id.fromMe&&e.local&&0===e.ack?e.id:this.lastReceivedKey}},{key:"getLastTimestampMsg",value:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&"i"!==t.eventTypeFromMsgType())return t}}},{key:"getWebcChatType",value:function(){switch(this.kind){case me.CHAT:return Y.default.WEBC_CHAT_TYPE.INDIVIDUAL;case me.GROUP:return Y.default.WEBC_CHAT_TYPE.GROUP;case me.BROADCAST:return Y.default.WEBC_CHAT_TYPE.BROADCAST_LIST;default:throw new TypeError("Invalid Chat.kind "+String(this.kind))}}},{key:"sendContact",value:function(e,t){var i=t&&t.msgContextInfo(this.id),r=(0,d.default)({ack:0,body:oe.default.fromContactModel(e).vcard,from:R.default.me,id:new H.default({from:R.default.me,to:this.id,id:(0,re.default)(),participant:void 0,selfDir:"out"}),local:!0,self:"out",subtype:e.formattedName,t:I.default.globalUnixTime(),to:this.id,type:"vcard",isNewMsg:!0},i||{});(0,he.addAndSendMsgToChat)(this,r)}},{key:"sendGroupInviteMessage",value:function(e,t,i,r,n,o){var a=(0,d.default)({ack:0,from:R.default.me,id:new H.default({from:R.default.me,to:this.id,id:(0,re.default)(),participant:void 0,selfDir:"out"}),local:!0,self:"out",t:I.default.globalUnixTime(),to:this.id,type:"groups_v4_invite",isNewMsg:!0,inviteGrpJpegThum:o,inviteCode:i,inviteCodeExp:r,inviteGrp:e,inviteGrpName:t,comment:n},{});return(0,he.addAndSendMsgToChat)(this,a)[1]}},{key:"sendContactList",value:function(e,t){var i=e.map(oe.default.fromContactModel,oe.default),r=t&&t.msgContextInfo(this.id),n=(0,d.default)({ack:0,from:R.default.me,id:new H.default({from:R.default.me,to:this.id,id:(0,re.default)(),participant:void 0,selfDir:"out"}),local:!0,self:"out",t:I.default.globalUnixTime(),to:this.id,type:"multi_vcard",vcardList:i,isNewMsg:!0},r||{});(0,he.addAndSendMsgToChat)(this,n)}},{key:"forwardMessages",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.id,n=this.contact;if(n.isUser&&n.isBlocked())return Promise.reject(new N.default("Forwarded to contact is blocked",n));var o=[];return Promise.each(e,function(e){if(e.isMMS)return(0,ue.forwardMediaMsg)(e,t,i);var n=e.quotedMsg&&e.quotedMsg.type===M.default.MSG_TYPE.PRODUCT?e.toJSON():(0,l.default)(e.toJSON(),["quotedMsg","quotedParticipant","quotedRemoteJid","quotedStanzaID"]),o=new H.default({from:R.default.me,to:r,id:(0,re.default)(),participant:void 0,selfDir:"out"});Object.assign(n,{id:o,from:R.default.me,t:I.default.globalUnixTime(),to:r,ack:0,participant:void 0,local:!0,self:"out",isNewMsg:!0,star:!1,isForwarded:e.isForwarded||!e.isSentByMe,forwardingScore:e.getForwardingScoreWhenForwarded(),multicast:i}),(0,he.addAndSendMsgToChat)(t,n)}).then(function(){return o})}},{key:"updateReadOnly",value:function(){var e=this,t=Promise.resolve();if(this.isGroup&&!this.groupMetadata.stale){var i=!this.groupMetadata.participants.get(R.default.me);t=(0,pe.updateLocal)(this.id,{isReadOnly:i}).then(function(){return e.isReadOnly=i})}t.then(function(){e.isBroadcast&&e.updateTitle()})}},{key:"updateIsAnnounceGrpRestrict",value:function(){var e=this;if(this.isGroup&&!this.groupMetadata.stale){var t=this.groupMetadata.participants.get(R.default.me),i=t&&!t.isAdmin&&this.groupMetadata.announce;(0,pe.updateLocal)(this.id,{isAnnounceGrpRestrict:i}).then(function(){return e.isAnnounceGrpRestrict=i})}}},{key:"sortMsgs",value:function(e){var t=e.map(function(e){var t=e.msgChunk;return{msg:e,chunkT:(0,ne.default)(t.at(0)).t,index:t.indexOf(e)}});return(0,c.default)(t,["chunkT","index"]).map(function(e){return e.msg})}},{key:"_updateAssignedColor",value:function(){if(this.colors){var e=this.groupMetadata.participants,t=this.colors,i=(0,u.default)((0,s.default)(t),e.map(function(e){return e.id.toString()}).map(ie.default));i.forEach(function(e){delete t[e]}),i.length&&this._saveAssignedColors()}}},{key:"loadAssignedColors",value:function(){return this.groupMetadata&&this.listenTo(this.groupMetadata.participants,"remove reset",this._updateAssignedColor),$.default.getGroupParticipantAssignedColor(this.id)||{}}},{key:"saveAssignedColors",value:function(){var e=this.colors;e&&$.default.setGroupParticipantAssignedColor(this.id,e)}},{key:"assignedColor",value:function(e){var t=this.colors||(this.colors=this.loadAssignedColors()),i=void 0,r=(0,ie.default)(e.toString());if(i=t[r])return i;var n={};(0,a.default)(t,function(e,t){n[e]?n[e].push(t):n[e]=[t]});for(var o=Number.POSITIVE_INFINITY,s=1;s<M.default.NUM_COLORS;s++){if(!n[s]){i=s;break}n[s].length<o&&(o=n[s].length,i=s)}return t[r]=i,this._saveAssignedColors(),i}},{key:"unstarAll",value:function(){var e=this.getAllMsgs();e.forEach(function(e){e&&(e.star=!1)}),(0,j.removeStarredMsgs)(e)}},{key:"constructMediaMsgs",value:function(e){if(!e)return this.getMediaMsgs();var t=void 0;return this.getMediaMsgs().contains(e)||e.msgChunk===this.msgs?(t=this.getMediaMsgs()).hasMediaAfter=!1:t=new w.default,t.contains(e)||(e.msgChunk?t.add(e.msgChunk.filter(function(e){return e.isMedia})):t.add(e)),t}},{key:"fts",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments[2];if(1===i){var n=this.ftsCache[e];if(n)return n;var a=V.default.search(e,i,r,this.id);this.ftsCache[e]=a;var s=function(){t.ftsCache[e]=null};return(0,o.default)(s,3e5),a.catch(s),a}return V.default.search(e,i,r,this.id)}},{key:"_clearFtsCache",value:function(){this.ftsCache={}}},{key:"updateSortTime",value:function(){var e=this;this.promises.updateSortTime||(this.promises.updateSortTime=this.regCancellablePromise(Promise.delay(0)).then(function(){var t=e.getLastTimestampMsg();return t?(e.t=t.t,Promise.resolve()):e.msgs.msgLoadState.noEarlierMsgs?Promise.resolve():e.pendingMsgs?Promise.resolve():e.loadEarlierMsgs()}).then(function(t){if(t){var i=e.getLastTimestampMsg();e.t=i?i.t:void 0}}).catch(function(){}).finally(function(){e.promises.updateSortTime=void 0}))}},{key:"removeFromCollection",value:function(e){e.star&&(0,j.removeStarredMsgs)([e]),e.isMedia&&this.mediaMsgs?this.mediaMsgs.remove(e):e.getLinks().length&&this.linkMsgs?this.linkMsgs.remove(e):e.isDoc&&this.docMsgs&&this.docMsgs.remove(e),this.updateMediasCountOnMsg(e,!0)}},{key:"getMediaMsgs",value:function(){return this.mediaMsgs||(this.mediaMsgs=new w.default),this.mediaMsgs}},{key:"getLinkMsgs",value:function(){return this.linkMsgs||(this.linkMsgs=new C.default),this.linkMsgs}},{key:"getDocMsgs",value:function(){return this.docMsgs||(this.docMsgs=new S.default),this.docMsgs}},{key:"getReceivedVCardMsgs",value:function(){return this.contact.isMyContact||!this.contact.isUser?null:(this.receivedVCardMsgs||(this.receivedVCardMsgs=new A.default,this.receivedVCardMsgs.parent=this),this.receivedVCardMsgs)}},{key:"dismissVCard",value:function(){this.vcardDismissed=!0}},{key:"updateMediasCountOnMsg",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(G.default.supportsFeature(G.default.F.MEDIAS_COUNT)){var i=t?-1:1;e.isMedia&&(this.mediaCount+=i);var r=e.getLinks().length;if(r){var n=i*r;this.linkCount+=n}e.isDoc&&(this.docCount+=i)}}},{key:"resetMediasCount",value:function(e){G.default.supportsFeature(G.default.F.MEDIAS_COUNT)&&(e.mediaCount&&(this.mediaCount=e.mediaCount),e.linkCount&&(this.linkCount=e.linkCount),e.docCount&&(this.docCount=e.docCount))}},{key:"getStarredMsgs",value:function(){var e=this,t=this.starredMsgs;return t||(this.starredMsgs=t=new j.StarredMsgCollection,this.starredMsgs.add(T.default.filter(function(t){return t.chat===e}))),t}},{key:"setAndKeepPrevious",value:function(e,t){var i=this,r=Object.keys(e);r.forEach(function(e){e in i.ackedProps||(i.ackedProps[e]=i[e])}),t.finally(function(){r.forEach(function(e){delete i.ackedProps[e]})}),this.set(e)}},{key:"getAckedPhoneProps",value:function(){return{wid:this.id,mute:this.mute.expiration,active:this.active,isReadOnly:this.isReadOnly,modifyTag:this.modifyTag,unreadCount:this.unreadCount,changeNumberOldJid:this.changeNumberOldJid,changeNumberNewJid:this.changeNumberNewJid,archive:"archive"in this.ackedProps?this.ackedProps.archive:this.archive,notSpam:"notSpam"in this.ackedProps?this.ackedProps.notSpam:this.notSpam,pin:"pin"in this.ackedProps?this.ackedProps.pin:this.pin}}},{key:"regCancellablePromise",value:function(e){var t=this;return this._promises||(this._promises=[]),this._promises.push(e),e.cancellable().finally(function(){t._promises=(0,n.default)(t._promises,e),t._promises&&0===t._promises.length&&(t._promises=null)})}},{key:"cancelPendingPromises",value:function(){this._promises&&this._promises.length>0&&(this._promises.forEach(function(e){e.cancel()}),this._promises=null)}},{key:"matchFilter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!(0,g.default)(e)||(e.label?(0,r.default)(this.labels,e.label):e.kind===M.default.SMB_SEARCH_FILTERS.UNREAD?!!this.hasUnread:e.kind===this.kind)}}]),t}();Oe.Collection="Chat",Oe.Proxy="chat",Oe.idClass=ee.default,t.default=(0,se.defineModel)(Oe)},ecadbdfdef:function(e,t,i){"use strict";e.exports={cache:{},delete:function(){this.cache={}}}},eciicfcjdi:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i("dcaifjegcg"),o=u(n),a=u(i("cjcghajbag")),s=u(i("jccfhaecf"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return i=r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,n.prop)(),r.afterCursor=(0,n.prop)(),r.index=(0,n.prop)(),r.fetchedFromServer=(0,n.session)(),r._products=(0,n.session)(),r._msgs=(0,n.session)(),c(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"initialize",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.productCollection=new a.default,this.msgProductCollection=new a.default,this.listenTo(this,"change:_products",this.triggerProductUpdate),this.listenTo(this,"change:_msgs",this.triggerMsgUpdate),this.triggerProductUpdate(),this.triggerMsgUpdate()}},{key:"triggerProductUpdate",value:function(){this._products&&this.productCollection.add(this._products,{merge:!0}),this._products=void 0}},{key:"triggerMsgUpdate",value:function(){this._msgs&&this.msgProductCollection.add(this._msgs,{merge:!0}),this._msgs=void 0}},{key:"markProductCollectionOld",value:function(){this.productCollection.forEach(function(e){return e.markOld()})}}]),t}();l.Collection="Catalog",l.Proxy="catalog",l.idClass=s.default,t.default=(0,n.defineModel)(l)},eigdejjai:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=p(i("eadfaddcj")),o=p(i("bdiiahhjbe")),a=p(i("bdhgicebce")),s=p(i("ccgjijjbbj")),u=i("eacidghfgh"),c=p(u),l=p(i("bhggeigghg")),d=p(i("cgcgbfbffj")),f=p(i("chajfbfiga")),h=p(i("jccfhaecf"));function p(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d.default),r(t,[{key:"_initializeStaleCollection",value:function(){var e=this;this.listenTo(c.default,"change:stream",function(){c.default.stream===u.STREAM.DISCONNECTED&&e.forEach(function(e){e.settled||e.set("stale",!0)})})}},{key:"_find",value:function(e){var t=l.default.Msg.get(e);return t?t.isSentByMe?f.default.queryMsgInfo(t.id).then(function(e){return e.status>=400?(o.default.log("model:MsgInfo:findQuery error "+e.status)(),Promise.reject(e.status)):(e.id=t.id,e.isPTT=t.type===n.default.MSG_TYPE.PTT,Promise.resolve(e))}):Promise.reject("message not sent by me"):Promise.reject("No message found for id: "+e)}},{key:"updateInfo",value:function(e,t,i,r,n,o){var a=new s.default({from:t,to:i,id:e,participant:n}),u=new s.default({from:t,to:i,id:e}),c=this.get(a)||this.get(u);if(c){if(!h.default.isUser(u.remote)){if(2!==r){var l=c.delivery.get(n);l&&c.delivery.remove(l)}if(3!==r){var d=c.read.get(n);d&&c.read.remove(d)}if(4!==r){var f=c.played.get(n);f&&c.played.remove(f)}}4===r?(c.played.get(n)||(c.playedRemaining-=1),c.played.add({id:n,t:o})):3===r?(c.delivery.get(n)||(c.readRemaining-=1),c.read.add({id:n,t:o})):2===r&&(c.delivery.get(n)||(c.deliveryRemaining-=1),c.delivery.add({id:n,t:o}))}}},{key:"handle",value:function(e){var t=this,i=e.shift();switch(i.cmd){case"ack":this.updateInfo(i.id,i.from,i.to,i.ack,i.participant,i.t);break;case"acks":i.id.forEach(function(e){t.updateInfo(e,i.from,i.to,i.ack,i.participant,i.t)})}}}]),t}();g.model=a.default,g.staleCollection=!0,t.default=new g},ejegihaeh:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},o=d(i("eciicfcjdi")),a=d(i("cgcgbfbffj")),s=d(i("ccaaiecfib")),u=d(i("chajfbfiga")),c=i("dcbdjheea"),l=i("hjbbdjjdf");function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),r(t,[{key:"addMsgAsproduct",value:function(e){s.default.supportsFeature(s.default.F.CATALOG)||Promise.reject("Not supported");var i=e.businessOwnerJid&&(0,c.createWid)(e.businessOwnerJid);if(i){var r=this.get(i),o=r&&e.productId&&r.msgProductCollection.get(e.productId),a=r&&e.productId&&r.productCollection.get(e.productId);if(!(a&&a.t&&a.t>=e.t||o&&o.fetchedFromServer)){var u={id:e.productId,url:e.url,name:e.title,description:e.description,imageCdnUrl:{rawUrl:e.mediaData.renderableUrl},catalogWid:i,reviewStatus:"",currency:e.currencyCode,priceAmount1000:e.priceAmount1000,retailerId:e.retailerId,productMsgMediaData:e.mediaData,imageCount:e.productImageCount?e.productImageCount:1,fetchedFromServer:!1,t:e.t};return n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,{id:i,afterCursor:void 0,_msgs:[u],stale:!0,fetchedFromServer:!!a},{merge:!0})}}}},{key:"_queryProduct",value:function(e,i){var r=this,o=e.toString({legacy:!0});return u.default.queryProduct(o,i).then(function(i){if(!i.data)return n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",r).call(r,{id:e,afterCursor:void 0});var o=i.data;if(!o.image_cdn_urls||o.image_cdn_urls[0].value.includes("https://static.whatsapp.net"))return Promise.reject(new Error("CatalogCollection:findProduct:_queryProduct "+(o.image_cdn_urls?"Product image contains static image":"Could not find image_cdn_urls for product")));var a=[{id:o.id,url:o.url,name:o.name,description:o.description,additionalImageCdnUrl:o.additional_image_cdn_urls.map(function(e){return{rawUrl:e[1].value}}),imageCdnUrl:{rawUrl:o.image_cdn_urls[1].value},catalogWid:e,reviewStatus:o.capability_to_review_status.length&&o.capability_to_review_status[0].value,currency:o.currency,priceAmount1000:o.price?10*o.price:null,retailerId:o.retailer_id,productMsgMediaData:null,imageCount:o.additional_image_cdn_urls.length+1,fetchedFromServer:!0,t:Date.now()/1e3}];return n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",r).call(r,{id:e,afterCursor:void 0,_products:a,_msgs:a,fetchedFromServer:!0},{merge:!0})})}},{key:"findProduct",value:function(e,t){return s.default.supportsFeature(s.default.F.CATALOG)||Promise.reject(new Error("Catalog not supported")),t?this._queryProduct(e,t):Promise.reject(new Error("CatalogCollection:findProduct Received productId type "+(void 0===t?"undefined":"null")))}},{key:"_queryCatalog",value:function(e,t,i,r){var n=e?e.index:0;return u.default.queryProductCatalog(i,r,10).then(function(e){if(!e.data.length)return{id:t,afterCursor:void 0};var i=[];return e.data.forEach(function(e,r){e.image_cdn_urls&&!e.image_cdn_urls[0].value.includes("https://static.whatsapp.net")&&i.push({id:e.id,url:e.url,name:e.name,description:e.description,additionalImageCdnUrl:e.additional_image_cdn_urls.map(function(e){return{rawUrl:e[1].value}}),imageCdnUrl:{rawUrl:e.image_cdn_urls[1].value},catalogWid:t,reviewStatus:e.capability_to_review_status.length?e.capability_to_review_status[0].value:null,currency:e.currency,priceAmount1000:e.price?10*e.price:null,retailerId:e.retailer_id,productMsgMediaData:null,imageCount:e.additional_image_cdn_urls.length+1,fetchedFromServer:!0,t:Date.now()/1e3,old:!1,index:n+r})}),{id:t,afterCursor:e.paging.cursors.after,_products:i,fetchedFromServer:!0,index:n+i.length}})}},{key:"_findQuery",value:function(e){s.default.supportsFeature(s.default.F.CATALOG)||Promise.reject(new Error("Catalog not supported"));var t=this.get(e),i=t&&!t.stale?t.afterCursor:void 0,r=e.user+"@s.whatsapp.net";return this._queryCatalog(t,e,r,i)}},{key:"_find",value:function(e){return s.default.supportsFeature(s.default.F.CATALOG)||Promise.reject(new Error("Catalog not supported")),this._findQuery(e)}},{key:"findCarouselCatalog",value:function(e){var i=this,r=this.get(e),o=(0,l.isString)(e)?(0,c.createWid)(e):e,a=(0,l.isString)(e)?e:e.toString({legacy:!0});return r&&r.set({index:0}),this._queryCatalog(r,o,a,void 0).then(function(e){return r&&r.markProductCollectionOld(),n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",i).call(i,e,{merge:!0})})}}]),t}();f.model=o.default,f.staleCollection=!0,t.default=new f},ejiicdbii:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BusinessProfileCollection=void 0;var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=p(i("bdiiahhjbe")),a=i("defecifdhg"),s=p(a),u=p(i("cgcgbfbffj")),c=p(i("ejegihaeh")),l=p(i("dhigahgdjb")),d=p(i("ccaaiecfib")),f=p(i("chajfbfiga")),h=i("bechdajic");function p(e){return e&&e.__esModule?e:{default:e}}var g=t.BusinessProfileCollection=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.default),n(t,[{key:"parseBusinessHours",value:function(e){var t=e.config,i={};return t.forEach(function(e){var t=e.day_of_week,r=e.mode;if(r===h.BUSINESS_HOUR_MODES.SPECIFIC_HOURS){var n=e.open_time,o=e.close_time;i[t]||(i[t]={mode:r,hours:[]}),n&&o&&i[t].hours&&i[t].hours.push([n,o])}else i[t]={mode:r}}),{config:i}}},{key:"_find",value:function(e){var t=this,i=this.gadd(e);return f.default.queryBusinessProfile([{wid:i.id,tag:i.tag}]).then(function(i){if(!Array.isArray(i))return o.default.error("Received invalid business profile response")(i),null;if(0===i.length)return o.default.info("Store:BusinessProfile:find No businessProfile found for "+String(e))(),{id:e};var r=i[0],n={id:r.wid,tag:r.tag},s=r.profile;if(s){var u=s.business_hours,f=s.catalog_status;u&&(s.business_hours=void 0,s.businessHours=t.parseBusinessHours(u)),d.default.supportsFeature(d.default.F.CATALOG)&&f&&"catalog_exists"===f&&(s.catalog_status=void 0,s.catalogStatus=f,c.default.findCarouselCatalog(e).then(function(t){var i=Array.isArray(t)?t[0]:t;l.default.assertGet(e).businessCatalog=i}).catch(function(e){return o.default.warn("Store:BusinessProfile:missing catalog")(e)})),Object.assign(n,a.DEFAULTS,s)}return n})}},{key:"onResume",value:function(){var e=this;this.filter(function(e){return e.stale&&e.hasObservers()}).map(function(t){return e.find(t.id)})}},{key:"handle",value:function(e){var t=r(e,1)[0];t&&t.tag||o.default.error("Store:BusinessProfile:handle Received invalid update from server")(t);var i=this.gadd(t.wid);t.tag!==i.tag&&i.markStale()}}]),t}();g.model=s.default,g.staleCollection=!0,t.default=new g},fagbfehid:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAGE_FETCH_STATE=t.PAGE_SIZE=void 0;var r=d(i("dfacahcafg")),n=d(i("ccjgiajgj")),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),s=d(i("cgcgbfbffj")),u=d(i("bdiiahhjbe")),c=d(i("cdaedfafjc")),l=d(i("chajfbfiga"));function d(e){return e&&e.__esModule?e:{default:e}}var f=t.PAGE_SIZE=9,h=t.PAGE_FETCH_STATE={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"},p=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.checksum=null,e._pageFetchPromises={},e.pageFetchStates={},e._handleChecksumChange=function(t){Object.keys(e.pageFetchStates).forEach(function(t){return e._resetFetchPageStateAndPromise(parseInt(t,10))}),e._resetRangeWithPlaceholders(0,e.length),e.fetchAt(0,!1,!0)},e.listenTo(e,"change:checksum",e._handleChecksumChange),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),a(t,[{key:"createPlaceholder",value:function(e){return t.createPlaceholder(e)}},{key:"fetchAt",value:function(e,t,i){this._fetchPageWithIndex(e,Boolean(t),Boolean(i))}},{key:"hasFetchedData",value:function(){var e=this;return Object.keys(this.pageFetchStates).some(function(t){return e.pageFetchStates[parseInt(t,10)]===h.SUCCESS})}},{key:"isFetchingData",value:function(){var e=this;return Object.keys(this.pageFetchStates).some(function(t){return e.pageFetchStates[parseInt(t,10)]===h.PENDING})}},{key:"pageWithIndex",value:function(e){return t.pageWithIndex(e)}},{key:"reset",value:function(){var e=this;return this.setChecksum(null,{silent:!0}),Object.keys(this.pageFetchStates).forEach(function(t){return e._resetFetchPageStateAndPromise(parseInt(t,10))}),function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this)}},{key:"sync",value:function(e){this.setChecksum(e)}},{key:"setChecksum",value:function(e,t){return this.checksum!==e&&(this.checksum=e,t&&t.silent||this.trigger("change:checksum",e),!0)}},{key:"_fetchPageWithIndex",value:function(e,t,i){var r=this.pageWithIndex(e);return this._fetchPage(r,t,i)}},{key:"_fetchPage",value:function(e,t,i){var r=this,n=this.pageFetchStates[e],o=void 0;if(t&&n!==h.PENDING&&(o=this._pageFetchPromises[e])&&(o.cancel(),delete this._pageFetchPromises[e]),o=this._pageFetchPromises[e])return o;var a=this.length;return this._insertPagePlaceholders(e),this._setFetchPageState(e,h.PENDING),this._pageFetchPromises[e]=l.default.queryStickerPacks(e,f).cancellable().then(function(t){var n=r._parseStickerPacksRes(e,t),o=i||r.setChecksum(t.checksum,{silent:!0}),s=(e-1)*f,u=(e+0)*f;r._resetRange(s,u,n),o&&(r._resetRangeWithPlaceholders(0,s),r._resetRangeWithPlaceholders(Math.min(s+n.length,u),t.count));var c=r.length;a!==c&&r.trigger("change:length",c),r._setFetchPageState(e,h.SUCCESS)}).catch(function(t){if(t instanceof Promise.CancellationError)return u.default.log("StickerPack page fetch promise cancelled: "+e)(),void r._unsetFetchPageStateAndPromise(e);r._setFetchPageState(e,h.ERROR)}),this._pageFetchPromises[e]}},{key:"_insertPagePlaceholders",value:function(e){var t=e-1;this._resetRangeWithPlaceholders(t*f,(t+1)*f)}},{key:"_parseStickerPacksRes",value:function(e,t){if(200!==t.status||!t.data)throw new Error("sticker packs query error");return t.data.map(function(t,i){return o({},(0,n.default)(t,["id","mimetype","name","url","mediaKey","filehash","directPath"]),{uploadhash:t.encFilehash,page:e,index:(e-1)*f+i})})}},{key:"_resetRangeWithPlaceholders",value:function(e,i){this._resetRange(e,i,(0,r.default)(i-e,function(i){return t.createPlaceholder(e+i)}))}},{key:"_resetRange",value:function(e,t,i){var r=this;this._forEachInRange(e,t,function(t,n){var o=i[n-e];if(t)if(o)t.id===o.id?(r.remove(t,{silent:!0}),r.add(o)):(r.remove(t),r.add(o));else for(var a=t;a;)r.remove(a),a=r.at(n);else o&&r.add(o)})}},{key:"_forEachInRange",value:function(e,t,i){for(var r=e;r<t;r++){i(this.at(r),r)}}},{key:"_resetFetchPageStateAndPromise",value:function(e){e in this.pageFetchStates&&(this.pageFetchStates[e]===h.PENDING?this._pageFetchPromises[e].cancel():this._unsetFetchPageStateAndPromise(e))}},{key:"_setFetchPageState",value:function(e,t){this.pageFetchStates[e]!==t&&(this.pageFetchStates[e]=t,this.trigger("change:pageFetchStates",e,t))}},{key:"_unsetFetchPageState",value:function(e){e in this.pageFetchStates&&(delete this.pageFetchStates[e],this.trigger("change:pageFetchStates",e))}},{key:"_unsetFetchPageStateAndPromise",value:function(e){delete this._pageFetchPromises[e],this._unsetFetchPageState(e)}}]),t}();p.model=c.default,p.comparator=function(e,t){return e.index<t.index?-1:e.index>t.index?1:0},p.createPlaceholder=function(e){return c.default.createPlaceholder({index:e,page:this.pageWithIndex(e)})},p.pageWithIndex=function(e){return Math.floor(e/f)+1},t.default=new p},fcedgihic:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=s(i("cccehdaiaf")),a=s(i("bdiiahhjbe"));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i.parent&&(r.parent=i.parent);var n=r.constructor,o=n.model,a=n.comparator;if(!o)throw new Error("Collection initialized without model!");return r._model=o,a&&(r._comparator=a),r._reset(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"add",value:function(e,t){var i=void 0;return i=Array.isArray(e)?e.slice():e?[e]:[],this.set(i,r({merge:!1,add:!0,remove:!1},t))}},{key:"set",value:function(e,t){if(!e)return a.default.error("collection:set called with no models")(),[];for(var i=r({add:!0,remove:!0,merge:!0},t),n=void 0,o=void 0,s=void 0,u=void 0,c=this._comparator&&!1!==i.sort,l=[],d=[],f={},h=i.add,p=i.at,g=i.merge,y=i.remove,v=!(c||!h||!y)&&[],b=0,_=e.length;b<_;b++)if(u=e[b],this.isModel(u)&&(o=u),n=u.id){if(s=this.get(n))y&&(f[s.id.toString()]=!0),g&&(u=o&&u===o?o.attributes:u,s.set(u,i)),e[b]=s;else if(h){if(!(o=e[b]=this._prepareModel(u,i)))continue;l.push(o),this._addReference(o)}(o=s||o)&&(!v||o.id&&f[o.id.toString()]||v.push(o),f[o.id.toString()]=!0)}else a.default.error("collection:set model has no id")();if(y){for(var m=0,O=this.length;m<O;m++)f[(o=this._models[m]).id.toString()]||d.push(o);d.length&&this.remove(d,i)}var P,E=void 0;if(l.length||v&&v.length)if(c&&(E=!0),"number"==typeof p)(P=this._models).splice.apply(P,[p,0].concat(l));else for(var j=v||l,T=0,M=j.length;T<M;T++)this._models.push(j[T]);if(E&&this.sort({silent:!0}),!i.silent){for(var S=0,C=l.length;S<C;S++)(o=l[S]).trigger?o.trigger("add",o,this,i):this.trigger("add",o,this,i);(E||v&&v.length)&&this.trigger("sort",this,i)}return e}},{key:"remove",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=void 0,r=void 0,n=void 0,o=void 0,a=Array.isArray(e)?e.slice():[e],s=[],u=0,c=a.length;u<c;u++)(o=a[u])&&(n=o instanceof this._model?o.id:o,(i=s[u]=this.get(n))&&(this._deIndex(i),r=this._models.indexOf(i),this._models.splice(r,1),t.silent||(t.index=r,i.trigger?i.trigger("remove",i,this,t):this.trigger("remove",i,this,t)),this._removeReference(i)));return s}},{key:"reset",value:function(){for(var e=0,t=this._models.length;e<t;e++)this._removeReference(this._models[e]);this._reset(),this.trigger("reset",this)}},{key:"sort",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._comparator)throw new Error("Cannot sort without comparator");return this._models.sort(this._comparator.bind(this)),e.silent||this.trigger("sort",this,e),this}},{key:"replaceId",value:function(e,t){var i=this.get(e);i&&(this._removeFromIndex(e),i.set({id:t}),this._addIndex(i))}},{key:"get",value:function(e){return this._index[e]}},{key:"assertGet",value:function(e){var t=this._index[e];if(!t){var i=this._model.prototype.Collection||"Unknown";a.default.assert(!1,i+"Collection:assertGet")()}return t}},{key:"at",value:function(e){return this._models[e]}},{key:"serialize",value:function(){return this.map(function(e){return e.toJSON()})}},{key:"toJSON",value:function(){return this.serialize()}},{key:"isModel",value:function(e){return e instanceof this._model}},{key:"includes",value:function(e,t){return this._models.includes(e,t)}},{key:"indexOf",value:function(e,t){return this._models.indexOf(e,t)}},{key:"lastIndexOf",value:function(e,t){return this._models.lastIndexOf(e,t)}},{key:"every",value:function(e){return this._models.every(e)}},{key:"some",value:function(e){return this._models.some(e)}},{key:"forEach",value:function(e){this._models.forEach(e)}},{key:"map",value:function(e){return this._models.map(e)}},{key:"filter",value:function(e){return this._models.filter(e)}},{key:"reduce",value:function(e,t){return this._models.reduce(e,t)}},{key:"slice",value:function(e,t){return this._models.slice(e,t)}},{key:"where",value:function(e){return this.filter(function(t){for(var i in e)if(e[i]!==t.get(i))return!1;return!0})}},{key:"head",value:function(){return this._models[0]}},{key:"last",value:function(){return this._models[this._models.length-1]}},{key:"toArray",value:function(){return this._models.slice()}},{key:"getModelsArray",value:function(){return this._models}},{key:"_reset",value:function(){this._models=[],this._index={}}},{key:"_prepareModel",value:function(e,t){if(this.isModel(e))return e.collection||(e.collection=this),e;var i=r({},t,{collection:this});try{return new this._model(e,i)}catch(e){return void a.default.error("collection:_prepareModel exception: ",e.stack)()}}},{key:"_addReference",value:function(e){this._addIndex(e),e.collection||(e.collection=this),e.on&&e.on("all",this._onModelEvent,this)}},{key:"_removeReference",value:function(e){this===e.collection&&delete e.collection,this._deIndex(e),e.off&&e.off("all",this._onModelEvent,this)}},{key:"_addIndex",value:function(e){this._index[e.id]=e}},{key:"_deIndex",value:function(e){delete this._index[e.id]}},{key:"_removeFromIndex",value:function(e){this.get(e)&&delete this._index[e]}},{key:"_onModelEvent",value:function(e,t,i,r){var n=e.indexOf(":"),o=-1===n?e:e.slice(0,n);("add"!==o&&"remove"!==o||i===this)&&("destroy"===o&&this.remove(t,r),this.trigger.apply(this,arguments))}},{key:"length",get:function(){return this._models.length}},{key:"isCollection",get:function(){return!0}},{key:"models",get:function(){return this._models}}]),t}();t.default=u},fcfchiagj:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i("dcaifjegcg"),o=g(n),a=g(i("bjigbaghc")),s=g(i("eadfaddcj")),u=g(i("dhigahgdjb")),c=g(i("ccaaiecfib")),l=g(i("bdiiahhjbe")),d=g(i("dfhgffbdig")),f=g(i("dhhbbaegif")),h=g(i("chajfbfiga")),p=g(i("jccfhaecf"));function g(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var v=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return i=r=y(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.participants=(0,n.collection)(d.default),r.pendingParticipants=(0,n.collection)(f.default),r.id=(0,n.prop)(),r.creation=(0,n.prop)(),r.owner=(0,n.prop)(),r.desc=(0,n.prop)(),r.descId=(0,n.prop)(),r.descTime=(0,n.prop)(),r.descOwner=(0,n.prop)(),r.restrict=(0,n.prop)(),r.announce=(0,n.prop)(),r.noFrequentlyForwarded=(0,n.prop)(),r.size=(0,n.prop)(),r.stale=(0,n.session)(!0),r.trusted=(0,n.session)(!0),r.inviteCode=(0,n.session)(),r.groupInviteCodePromise=(0,n.session)(),r.revokeGroupInvitePromise=(0,n.session)(),r.revokeGroupV4AddInvitePromise=(0,n.session)(),r.groupInviteLink=(0,n.derived)(r._groupInviteLink,["inviteCode"]),y(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"_groupInviteLink",value:function(){return this.inviteCode?""+s.default.GROUP_INVITE_LINK_URL+this.inviteCode:null}},{key:"delete",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.getCollection().remove(this.id),this.participants.delete()}},{key:"canSetSubject",value:function(){return!!this.participants.iAmMember()&&(!!this.participants.iAmAdmin()||(!c.default.supportsFeature(c.default.F.GROUPS_V_3)||!0!==this.restrict))}},{key:"canSetDescription",value:function(){return!!c.default.supportsFeature(c.default.F.GROUPS_V_3)&&!(!this.participants.iAmMember()||!this.participants.iAmAdmin()&&this.restrict)}},{key:"canSetGroupProperty",value:function(){return!!c.default.supportsFeature(c.default.F.GROUPS_V_3)&&!!this.participants.iAmAdmin()}},{key:"initialize",value:function(){o.default.prototype.initialize.call(this),this.listenTo(this.participants,"change:isAdmin change:isSuperAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this.participants,"add remove reset",this.triggerParticipantsChange),this.listenTo(this,"change:owner",this.isTrusted),this.isTrusted()}},{key:"triggerParticipantsChange",value:function(){this.trigger("change:participants")}},{key:"isTrusted",value:function(){if(this.stale)return this.trusted;if(!this.owner)return this.trusted=!1;if(p.default.equals(this.owner,a.default.me))return this.trusted=!0;var e=u.default.get(this.owner);if(e&&e.isMyContact)return this.trusted=!0;for(var t=this.participants.toArray(),i=0,r=t.length;i<r;++i){var n=t[i];if(n.isAdmin&&(!p.default.equals(n.id,a.default.me)&&n.contact.isMyContact))return this.trusted=!0}return this.trusted=!1}},{key:"revokeGroupV4AddInvite",value:function(e){var t=this;if(this.revokeGroupV4AddInvitePromise)return this.revokeGroupV4AddInvitePromise;var i=this.id.toString(),r=a.default.me.toString();return this.revokeGroupV4AddInvitePromise=h.default.revokeGroupV4Invite(e,i,r).then(function(e){return e.status}).catch(function(e){l.default.error("models:groupMetadata:participantCollection:revokeGroupV4AddInvite failed")(e)}).finally(function(){t.revokeGroupV4AddInvitePromise=null})}},{key:"queryGroupV4PendingInvite",value:function(){var e=this,t=a.default.me.toString(),i=this.id.toString();return h.default.findGroupPendingInvitesFromPhone(t,i).then(function(t){e.collection&&e.collection.add({id:e.id,pendingParticipants:t.participants},{merge:!0})})}}]),t}();v.Collection="GroupMetadata",v.Proxy="groupMetadata",v.idClass=p.default,t.default=(0,n.defineModel)(v)},gabccaieg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=u(i("bjigbaghc")),o=u(i("bjgdagjjci")),a=u(i("cgcgbfbffj")),s=u(i("ccicaaeiaa"));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.listenTo(e,"change:disabled",function(t){t.disabled&&e.removeParticipant(t)}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),r(t,[{key:"delete",value:function(){var e=this;this.forEach(function(t){return e.removeParticipant(t)})}},{key:"validLocations",value:function(){return this.filter(function(e){return e.valid})}},{key:"removeParticipant",value:function(e){this.remove(e),e.delete()}}]),t}();c.model=o.default,c.comparator=function(e,t){return e.contact.id.equals(n.default.me)?-1:t.contact.id.equals(n.default.me)?1:(0,s.default)(e.contact,t.contact)},t.default=c},gbbacfeci:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("cajijabhgb")),a=d(i("dieafdcbjb")),s=d(i("cgcgbfbffj")),u=i("dcbdjheea"),c=d(i("jccfhaecf")),l=i("bijjheifie");function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),n(t,[{key:"onResume",value:function(){var e=this;this.filter(function(e){return e.hasObservers()}).forEach(function(t){e.find(t.id).catch(o.WapDrop,function(){})})}},{key:"_find",value:function(e){var t=e instanceof c.default?e:(0,u.createWid)(e);return(0,l.getStatus)(t)}},{key:"handle",value:function(e){var t=r(e,1)[0],i=this.get(t.id);i&&(i.status=t.status,i.stale=!1)}}]),t}();f.model=a.default,f.idClass=c.default,f.staleCollection=!0,f.resumeOnAvailable=!0,t.default=new f},hgeacfdgi:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CALL_UI_STATES=t.CALL_TYPES=t.OUTPUT_DEVICES=void 0;var r,n=i("dcaifjegcg"),o=i("hfgahggjd"),a=i("bgdcgdigif"),s=(r=a)&&r.__esModule?r:{default:r},u=i("cgejjichfa");t.OUTPUT_DEVICES=o.OUTPUT_DEVICES,t.CALL_TYPES=a.CALL_TYPES,t.CALL_UI_STATES=u.CALL_UI_STATES;var c=(0,n.defineModel)(s.default);t.default=new c},iajeehcac:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i("dcaifjegcg"),o=u(n),a=u(i("dhigahgdjb")),s=u(i("jccfhaecf"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return i=r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.id=(0,n.prop)(),r.isAdmin=(0,n.prop)(),r.isSuperAdmin=(0,n.prop)(),r.contact=(0,n.session)(),r.hasSenderKey=(0,n.session)(!1),c(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"initialize",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.addChild("contact",a.default.gadd(this.id))}}]),t}();l.Proxy="participant",l.idClass=s.default,t.default=(0,n.defineModel)(l)},idbcfjbae:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i("dcaifjegcg"),o=c(n),a=c(i("bffjfbgbg")),s=c(i("biedfadfag")),u=i("daichdjff");function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return i=r=l(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.old=(0,n.session)(!1),r.id=(0,n.prop)(),r.catalogWid=(0,n.prop)(),r.additionalImageCdnUrl=(0,n.prop)(),r.imageCdnUrl=(0,n.prop)(),r.url=(0,n.prop)(),r.name=(0,n.prop)(),r.description=(0,n.prop)(),r.reviewStatus=(0,n.prop)(),r.currency=(0,n.prop)(),r.priceAmount1000=(0,n.prop)(),r.retailerId=(0,n.prop)(),r.productImageCollection=(0,n.session)(),r.imageCount=(0,n.prop)(),r.index=(0,n.prop)(),r.productMsgMediaData=(0,n.session)(),r.fetchedFromServer=(0,n.session)(),r.t=(0,n.prop)(),l(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),r(t,[{key:"initialize",value:function(){(function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.productImageCollection=new s.default,this.listenTo(this,"change:imageCdnUrl",this.triggerImageUpdate),this.triggerImageUpdate()}},{key:"triggerImageUpdate",value:function(){var e=this;if(this.markProductImagesOld(),this.fetchedFromServer||!this.productMsgMediaData)this.imageCdnUrl.productImageModel=this.productImageCollection.gadd({id:"_0",mediaUrl:this.imageCdnUrl.rawUrl,fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0}),this.additionalImageCdnUrl&&this.additionalImageCdnUrl.forEach(function(t,i){t.productImageModel=e.productImageCollection.gadd({id:"_"+(i+1),mediaUrl:t.rawUrl,fetchedFromServer:e.fetchedFromServer,old:!1},{merge:!0})});else{this.imageCdnUrl.productImageModel=this.productImageCollection.gadd({id:"_0",type:"product",mediaData:new a.default({mediaStage:u.STAGE.PREPARING}),fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0});for(var t=1;t<this.imageCount;t++)this.productImageCollection.gadd({id:"_"+t,type:"product",mediaData:new a.default({mediaStage:u.STAGE.PREPARING}),fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0})}}},{key:"markOld",value:function(){this.old=!0}},{key:"markProductImagesOld",value:function(){this.productImageCollection.forEach(function(e){return e.markOld()})}}]),t}();d.Collection="Product",d.Proxy="product",t.default=(0,n.defineModel)(d)},igdjeffe:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FALLBACK=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=p(i("bjigbaghc")),a=i("dcaifjegcg"),s=p(a),u=p(i("edbaidcaf")),c=p(i("jccfhaecf")),l=p(i("eadfaddcj")),d=p(i("bhggeigghg")),f=p(i("ccaaiecfib")),h=p(i("gcbhjhjhg"));function p(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var y=t.FALLBACK={SINGLE:"SINGLE",GROUP:"GROUP"},v=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),s=0;s<n;s++)o[s]=arguments[s];return i=r=g(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,a.prop)(),r.tag=(0,a.prop)(),r.raw=(0,a.prop)(),r.eurl=(0,a.prop)(),r.stale=(0,a.session)(!0),r.eurlStale=(0,a.session)(!1),r.pendingPic=(0,a.session)(),r.img=(0,a.derived)(r._img,["tag","raw","stale","eurl","eurlStale"]),r.imgFull=(0,a.derived)(r._imgFull,["tag","raw","stale","eurl","eurlStale"]),r.fallbackType=(0,a.derived)(r._fallbackType,["id"]),g(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),n(t,[{key:"_img",value:function(){return this.raw?"data:image/jpeg;base64,"+this.raw:!this.tag&&this.stale?null:this.tag?(f.default.supportsFeature(f.default.F.MD_BACKEND),this.generateUrl("s")):void 0}},{key:"_imgFull",value:function(){return!this.raw&&this.tag||!this.stale?!this.raw&&this.tag?(f.default.supportsFeature(f.default.F.MD_BACKEND),this.generateUrl("l")):void 0:null}},{key:"_fallbackType",value:function(){return c.default.isUser(this.id)?y.SINGLE:(c.default.isGroup(this.id),y.GROUP)}},{key:"markStale",value:function(e){this.stale=!0,e&&e.eurl&&(this.eurlStale=!0)}},{key:"validate",value:function(){(this.stale||this.eurlStale)&&this.update()}},{key:"generateUrl",value:function(e){var t={t:e,u:this.id.toString(),i:this.tag||""};return h.default.alive&&this.eurl&&!this.eurlStale&&(t=r({e:this.eurl},t)),u.default.build(l.default.PP_URL,t)}},{key:"canSet",value:function(){if(c.default.isGroup(this.id)){var e=d.default.Chat.get(this.id);return!(e&&e.groupMetadata&&e.groupMetadata.participants.iAmRestrictedMember())}return!!this.id.equals(o.default.me)}},{key:"canDelete",value:function(){if(c.default.isGroup(this.id)&&this.tag){var e=d.default.Chat.assertGet(this.id);return!(e&&e.groupMetadata&&e.groupMetadata.participants.iAmRestrictedMember())}return!(!this.id.equals(o.default.me)||!this.tag)}}]),t}();v.Collection="ProfilePicThumb",v.Proxy="profilePicThumb",v.idClass=c.default,t.default=(0,a.defineModel)(v)},igjghefdb:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Chatstate=void 0;var r=p(i("diibgbjaeh")),n=p(i("eaaagccfda")),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},s=p(i("bjebjijbfc")),u=i("dcaifjegcg"),c=p(u),l=p(i("dhigahgdjb")),d=p(i("cgcgbfbffj")),f=p(i("eadfaddcj")),h=p(i("jccfhaecf"));function p(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var b=function(e){function t(){var e,i,r;g(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=y(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,u.prop)(),r.type=(0,u.prop)(),r.t=(0,u.prop)(),r.deny=(0,u.prop)(),r.updateTime=(0,u.session)(),r._expireTimerId=(0,u.session)(),y(r,i)}return v(t,c.default),t}();b.Proxy="chatstate",b.idClass=h.default;var _=(0,u.defineModel)(b),m=function(e){function t(){return g(this,t),y(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return v(t,d.default),t}();m.model=_;var O=function(e){function t(){var e,i,r;g(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=y(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,u.prop)(),r.isOnline=(0,u.session)(!1),r.stale=(0,u.session)(!0),r.hasData=(0,u.session)(!1),r.isSubscribed=(0,u.session)(!1),r.withholdDisplay=(0,u.session)(!0),r.forceDisplay=(0,u.session)(!1),r.chatActive=(0,u.session)(!1),r.withholdDisplayTimer=(0,u.session)(),r.forceDisplayTimer=(0,u.session)(),r.chatstate=(0,u.session)(),r.chatstates=(0,u.collection)(m),r.isGroup=(0,u.derived)(r._isGroup),r.isUser=(0,u.derived)(r._isUser),y(r,i)}return v(t,c.default),o(t,[{key:"_isGroup",value:function(){return h.default.isGroup(this.id)}},{key:"_isUser",value:function(){return h.default.isUser(this.id)}},{key:"initialize",value:function(){var e=this;a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this);var i=this.isGroup?{id:"",type:"unavailable"}:{id:this.id};this.addChild("chatstate",new _(i)),this.isGroup?this.listenTo(this.chatstates,"add change",(0,n.default)(function(){var t=void 0,i=!1;e.chatstates.forEach(function(e){"composing"!==e.type&&"recording"!==e.type||t&&!(t.updateTime<e.updateTime)||(t=e),i=i||"unavailable"!==e.type}),e.set({isOnline:i}),e.chatstate.set({id:t?t.id:"",type:t?t.type:"unavailable"})})):this.listenTo(this.chatstate,"change:type",function(){e.isOnline="unavailable"!==e.chatstate.type}),this.listenTo(this,"change:chatActive",this.onChatActiveChange)}},{key:"delete",value:function(){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.getCollection().remove(this.id),this.chatstate.delete(),this.chatstates.forEach(function(e){return e.delete()})}},{key:"handle",value:function(e){var t=!1;void 0===e.type?e.type=this.chatstate.type||"unavailable":"paused"===e.type&&(t=!0,e.type="available"),this.isGroup&&"available"!==e.type&&(e.updateTime=Date.now());var i=void 0;if(this.isGroup){if(!e.participant)return;e.id=e.participant,e.participant=void 0,i=this.chatstates.gadd(e.id)}else i=this.chatstate;t&&"composing"!==i.type&&"recording"!==i.type||i.set(e),i._expireTimerId&&clearTimeout(i._expireTimerId),"composing"===i.type||"recording"===i.type?i._expireTimerId=(0,r.default)(this._expireComposing,f.default.PRESENCE_COMPOSING_TIMEOUT,i):i._expireTimerId=void 0;var n=this.forceDisplay||this.isOnline||this.isUser&&!this.chatstate.deny;this.set({hasData:!0,forceDisplay:n})}},{key:"_expireComposing",value:function(e){var t=e.type;"composing"!==t&&"recording"!==t||(e.type="available")}},{key:"reset",value:function(){this.hasData=!1,this.isGroup?this.chatstates.forEach(function(e){e.type="unavailable"}):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})}},{key:"isActive",value:function(){var e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)}},{key:"getFormattedString",value:function(){if(!this.hasData)return null;if(this.isGroup){var e=this.chatstate.id;if(!e)return null;var t=l.default.get(e);if(!t)return null;var i=t.formattedShortName;return"composing"===this.chatstate.type?l10n.t("web_conversation_name_is_composing",{participant:i}):l10n.t("web_conversation_name_is_recording",{participant:i})}if(!this.isUser)return null;var r=this.chatstate;switch(r.type){case"available":return l10n.t("web_conversation_contact_online");case"composing":return l10n.t("web_conversation_is_composing");case"recording":return l10n.t("web_conversation_is_recording");case"unavailable":return r.deny||!r.t?null:s.default.lastSeenStr(r.t)}}},{key:"onChatActiveChange",value:function(){var e=this;this.chatActive?(this.hasData?this.withholdDisplay=!1:this.withholdDisplayTimer=(0,r.default)(function(){e.set({withholdDisplay:!1,withholdDisplayTimer:void 0})},1500),this.forceDisplayTimer=(0,r.default)(function(){e.set({forceDisplay:!0,forceDisplayTimer:void 0})},2e3)):(this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=void 0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=void 0))}},{key:"subscribe",value:function(){return this.find()}}]),t}();O.Collection="Presence",O.Proxy="presence",O.idClass=h.default,t.default=(0,u.defineModel)(O),t.Chatstate=_},ijiafihgg:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(i("eaaagccfda")),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i("bdfbccfifg"),a=l(o),s=l(i("bfgbdiffgd")),u=l(i("ccaaiecfib")),c=l(i("eacidghfgh"));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i.id));return n._trigger=i.trigger||"all",n._saveToCache=(0,r.default)(n.saveToCache,0),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"saveToCache",value:function(){u.default.supportsFeature(u.default.F.MODEL_STORAGE)||c.default.hasSynced&&s.default.getWebRestoreFromCache()&&this.collection.saveToCache()}},{key:"enableCaching",value:function(){this.listenTo(this.collection,this._trigger,this._saveToCache)}},{key:"disableCaching",value:function(){this.stopListening(this.collection,this._trigger,this._saveToCache)}}]),t}();d.policy=o.CACHE_POLICY_TYPE.IMMEDIATE,t.default=d},jcfjeeiii:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=v(i("eabbadcaee")),n=v(i("dfaadfeedd")),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0},s=i("dcaifjegcg"),u=v(i("dhigahgdjb")),c=v(i("ccehadbeci")),l=v(i("eadfaddcj")),d=v(i("bdiiahhjbe")),f=v(i("chajfbfiga")),h=v(i("bjebjijbfc")),p=v(i("djheacfeif")),g=v(i("jccfhaecf")),y=i("dcjbdhhjge");function v(e){return e&&e.__esModule?e:{default:e}}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _(e){var t=(0,n.default)(e,function(e){return e.body&&e.mediaData&&(e.type===l.default.MSG_TYPE.IMAGE||e.type===l.default.MSG_TYPE.VIDEO)});return t&&t.mediaData.preview}var m=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=b(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.id=(0,s.prop)(),r.t=(0,s.prop)(),r.unreadCount=(0,s.prop)(0),r.totalCount=(0,s.prop)(0),r.score=(0,s.prop)(),r.pic=(0,s.prop)(),r._msgs=(0,s.prop)(function(){return[]}),r.readKeys=(0,s.session)(function(){return{}}),r.contact=(0,s.session)(),r.expireTimer=(0,s.session)(),r.expireTs=(0,s.session)(),r.hasUnread=(0,s.derived)(r._hasUnread,["unreadCount"]),r.readCount=(0,s.derived)(r._readCount,["unreadCount","totalCount"]),r.renderedThumbnail=(0,s.derived)(r._renderedThumbnail,["msgsChanged","pic","totalCount"]),r.lastStatus=(0,s.derived)(r._lastStatus,["msgsChanged","totalCount"]),b(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.default),o(t,[{key:"_hasUnread",value:function(){return this.unreadCount>0}},{key:"_readCount",value:function(){var e=this.totalCount-this.unreadCount;return(0,r.default)(e)?e:(d.default.error("Bad status v3 read count, "+this.totalCount+", "+this.unreadCount)(),0)}},{key:"_renderedThumbnail",value:function(){return this.msgs.length===this.totalCount?_(this.msgs.getModelsArray()):this.pic?this.pic:_(this.msgs.getModelsArray())}},{key:"_lastStatus",value:function(){return this.msgs.last()}},{key:"initialize",value:function(){var e=this;a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this),this.addChild("contact",u.default.gadd(this.id)),this.listenTo(this.msgs,"add bulk_add",function(){window.setTimeout(function(){e.setupStatusExpiration()})}),this.listenTo(this,"change:lastStatus",function(){e.lastStatus&&(e.t=e.lastStatus.t)})}},{key:"setupStatusExpiration",value:function(){var e=this,t=this.msgs.at(0);if(t&&!("number"==typeof this.expireTs&&this.expireTs<=t.t)){var i=t.t+86400+1;i<h.default.globalUnixTime()?window.setTimeout(function(){e.expireMsg()}):(this.expireTimer=p.default.setGlobalTimeout(this.expireMsg.bind(this),1e3*i,this.expireTimer),this.expireTs=t.t)}}},{key:"expireMsg",value:function(){for(var e=this.msgs;e.length>0;){var t=e.at(0);if(!t)break;if(t.t+86400>h.default.globalUnixTime())break;this.unreadCount>this.totalCount-1&&this.unreadCount--,this.totalCount--,e.remove(t),t.delete()}this.expireTs=void 0,this.expireTimer=void 0,0!==this.totalCount&&this.setupStatusExpiration()}},{key:"delete",value:function(){d.default.log("Status v3 deleted with total count: "+this.totalCount)(),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"delete",this).call(this),this.expireTimer&&p.default.clearTimeout(this.expireTimer),this.expireTs&&(this.expireTs=void 0),this.getCollection().remove(this.id)}},{key:"onEmptyMRM",value:function(){var e=this;d.default.log("Status V3 onEmptyMRM with total count: "+this.totalCount+", noEarlierMsgs: "+(this.msgs.msgLoadState.noEarlierMsgs?"true":"false"))(),this.msgs.msgLoadState.noEarlierMsgs&&0===this.totalCount?this.delete():this.totalCount>0&&this.loadMore().catch(function(){}).finally(function(){e.msgs.length||e.delete()})}},{key:"loadMore",value:function(e){var t=this;if(this.msgs.msgLoadState.noEarlierMsgs)return Promise.resolve();if(this.msgs.msgLoadState.isLoadingEarlierMsgs)return this.msgs.loadEarlierPromise;var i=e||l.default.PAGE_SIZE;return this.getCollection().loadMore(this.id,i,this.msgs.last()).then(function(e){return Array.isArray(e)&&e.length<i&&(t.msgs.msgLoadState.noEarlierMsgs=!0),e}).catch(function(e){return 404===e&&t.delete(),Promise.reject(e)})}},{key:"handleReadStatus",value:function(e){this.readKeys[e]||(this.readKeys[e]=!0,this.unreadCount>0&&this.unreadCount--)}},{key:"sendReadStatus",value:function(e,t){var i=this;return f.default.sendStatusSeen(e,t).then(function(t){200===t.status&&i.handleReadStatus(e)})}},{key:"sendMute",value:function(e){var t=this;return f.default.sendStatusMute(this.id,e).then(function(i){if(200===i.status){var r={statusMute:e};(0,y.updateLocal)(t.contact.id,r).then(function(){t.contact.set(r)})}})}}]),t}();m.Collection="StatusV3",m.Proxy="statusV3",m.idClass=g.default,t.default=(0,s.defineModel)(m)},jdigiabic:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RECENT_STICKERS_LIMIT=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=l(i("cgcgbfbffj")),a=l(i("ccaaiecfib")),s=l(i("cgfidiajgj")),u=l(i("chajfbfiga")),c=l(i("bdiiahhjbe"));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=t.RECENT_STICKERS_LIMIT=32,h=function(e){function t(){var e,i,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return i=r=d(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r._checksum="",r._syncStatus="NONE",d(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"_findQuery",value:function(){var e=this;return a.default.supportsFeature(a.default.F.RECENT_STICKERS)?u.default.queryRecentStickers().then(function(t){var i=t.checksum,n=t.stickers;return e.setChecksum(i),n.map(function(e,t){return r({},e,{index:t})})}):Promise.reject(new Error("gk recent sticker sync unsupported"))}},{key:"enqueue",value:function(e){var t=this;if(a.default.supportsFeature(a.default.F.RECENT_STICKERS)){this.forEach(function(e,t){e.index=f+t});var i=new Set(e.map(function(e){return e.id}));e.reduce(function(e,t){return i.has(t.id)?(i.delete(t.id),[t].concat(e)):e},[]).slice(0,f).forEach(function(e,i){var r=t.get(e.id);r?r.index=i:t.add({id:e.id,clientUrl:e.clientUrl,directPath:e.directPath,filehash:e.filehash,uploadhash:e.uploadhash,mediaKey:e.mediaKey,width:e.width,height:e.height,size:e.size,mimetype:e.mimetype,type:e.type,index:i})}),this.sort(),this.remove(this.slice(f))}}},{key:"setChecksum",value:function(e){this._checksum=e}},{key:"sync",value:function(e){e!==this._checksum&&(this.setChecksum(e),this._sync())}},{key:"syncOnce",value:function(){return"SUCCESS"===this._syncStatus||"FAILURE"===this._syncStatus?Promise.resolve():this._sync()}},{key:"_sync",value:function(){var e=this;return"INPROGRESS"===this._syncStatus?Promise.resolve():(this._syncStatus="INPROGRESS",this.findQuery({},{set:!0}).then(function(){e.sort(),e._syncStatus="SUCCESS"}).catch(function(t){c.default.error("collection:recent_sticker:_sync error ")(t),e._syncStatus="FAILURE"}))}},{key:"isSynced",value:function(){return"SUCCESS"===this._syncStatus||"FAILURE"===this._syncStatus}},{key:"reset",value:function(){return this._syncStatus="NONE",function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this)}}]),t}();h.model=s.default,h.comparator=function(e,t){return e.index>t.index?1:-1},t.default=new h},jjbajibff:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();t.genMirrorMask=function(e){var t={},i=0,r=function(e){t["change:"+e]=i++};e.props&&Object.keys(e.props).forEach(r);e.session&&Object.keys(e.session).forEach(r);e.derived&&Object.keys(e.derived).forEach(r);return t},t.genBitMask=function(e,t){for(var i=[0,0,0],r=0;r<t.length;r++){var n=e["change:"+t[r]],o=Math.floor(n/c),a=n%c;i[o]|=1<<a}return i};var o,a=i("bdiiahhjbe"),s=(o=a)&&o.__esModule?o:{default:o};var u="change",c=32,l={};function d(e,t){var i=l[e];i||(i=l[e]={_TotalEvents_:0}),t!==u&&(i._TotalEvents_+=1),i[t]=1+(0|i[t])}s.default.exportToWindow("GEC",l);var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=t}return n(e,[{key:"destructor",value:function(){this.state.off("all",this.onGatherEvent,this)}},{key:"initListener",value:function(){this.state.on("all",this.onGatherEvent,this),this.masks=[],this.listeners=[],this.changeEvents=[0,0,0]}},{key:"onGatherEvent",value:function(e){if(e===u){var t=this.changeEvents;if(!t[0]&&!t[1]&&!t[2])return;this.onChange(),d(this.state.Collection,e),t[0]=0,t[1]=0,t[2]=0}else{var i=this.state.mirrorMask[e];if(void 0===i)return;var r=i/c|0,n=i%c|0;this.changeEvents[r]|=1<<n,d(this.state.Collection,e)}}},{key:"onChange",value:function(){for(var e=this.state,t=r(this.changeEvents,3),i=t[0],n=t[1],o=t[2],a=this.masks,s=this.listeners,u=0;u<a.length;u++){var c=r(a[u],3);if(i&c[0]|n&c[1]|o&c[2]){var l=r(s[u],2);(0,l[0])(l[1],e)}}}},{key:"addListener",value:function(e,t,i){this.listeners||this.initListener(),this.masks.push(t),this.listeners.push([e,i])}},{key:"removeListener",value:function(e){for(var t=this.listeners,i=0;i<t.length;i++)t[i][0]===e&&(h(this.masks,i),h(t,i))}}]),e}();function h(e,t){e[t]=e[e.length-1],e.pop()}t.default=f}});